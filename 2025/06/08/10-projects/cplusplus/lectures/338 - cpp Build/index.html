<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>338 - cpp Build | Bear's dream</title><meta name="description" content="338 - cpp Build"><meta name="keywords" content="Cpp,Coding,Development,Software,Compiler"><meta name="author" content="supersheepbear"><meta name="copyright" content="supersheepbear"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon_1.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="p43hXBn3_dLvbyxUzx0eo5eYmj9OVYOV52pdrhBa2sw"><meta name="baidu-site-verification" content="EXLlfLv2pV"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="338 - cpp Build"><meta name="twitter:description" content="338 - cpp Build"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><meta property="og:type" content="article"><meta property="og:title" content="338 - cpp Build"><meta property="og:url" content="https://yxiong.org/2025/06/08/10-projects/cplusplus/lectures/338%20-%20cpp%20Build/"><meta property="og:site_name" content="Bear's dream"><meta property="og:description" content="338 - cpp Build"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://yxiong.org/2025/06/08/10-projects/cplusplus/lectures/338%20-%20cpp%20Build/"><link rel="prev" title="334 - cpp Nested" href="https://yxiong.org/2025/06/08/10-projects/cplusplus/lectures/334%20-%20cpp%20Nested/"><link rel="next" title="339 - cpp 声明与定义" href="https://yxiong.org/2025/06/08/10-projects/cplusplus/lectures/339%20-%20cpp%20%E5%A3%B0%E6%98%8E%E4%B8%8E%E5%AE%9A%E4%B9%89/"><link rel="stylesheet" href="hfttps://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Bear's dream" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Bear's dream</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 音乐照片</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 学习计划</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200520153141.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">152</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">151</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">20</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 音乐照片</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 学习计划</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#338-C-Build"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">338 - C++ Build</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#🧑‍💻-User"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">🧑‍💻 User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#🤖-Assistant"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">🤖 Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#C-编译模型深度解析：理解编译与链接"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">C++编译模型深度解析：理解编译与链接</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-C-程序构建流程：从源代码到可执行文件"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">1. C++程序构建流程：从源代码到可执行文件</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-实际代码示例：分步编译与链接"><span class="toc_mobile_items-number">1.5.</span> <span class="toc_mobile_items-text">2. 实际代码示例：分步编译与链接</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-1-一步到位：编译与链接一次完成"><span class="toc_mobile_items-number">1.5.1.</span> <span class="toc_mobile_items-text">2.1 一步到位：编译与链接一次完成</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-2-分步进行：先编译，后链接"><span class="toc_mobile_items-number">1.5.2.</span> <span class="toc_mobile_items-text">2.2 分步进行：先编译，后链接</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-常见误解与错误（以及非代码示例）"><span class="toc_mobile_items-number">1.6.</span> <span class="toc_mobile_items-text">3. 常见误解与错误（以及非代码示例）</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-1-误解：编译就是生成最终的可执行文件"><span class="toc_mobile_items-number">1.6.1.</span> <span class="toc_mobile_items-text">3.1 误解：编译就是生成最终的可执行文件</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-2-误解：所有错误都是编译错误"><span class="toc_mobile_items-number">1.6.2.</span> <span class="toc_mobile_items-text">3.2 误解：所有错误都是编译错误</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-3-忘记链接所有必要的目标文件或库"><span class="toc_mobile_items-number">1.6.3.</span> <span class="toc_mobile_items-text">3.3 忘记链接所有必要的目标文件或库</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-QA-闪存卡（Flash-Cards）"><span class="toc_mobile_items-number">1.7.</span> <span class="toc_mobile_items-text">4. QA 闪存卡（Flash Cards）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5-编码练习：修复未定义引用"><span class="toc_mobile_items-number">1.8.</span> <span class="toc_mobile_items-text">5. 编码练习：修复未定义引用</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#338-C-Build"><span class="toc-number">1.</span> <span class="toc-text">338 - C++ Build</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#🧑‍💻-User"><span class="toc-number">1.1.</span> <span class="toc-text">🧑‍💻 User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#🤖-Assistant"><span class="toc-number">1.2.</span> <span class="toc-text">🤖 Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-编译模型深度解析：理解编译与链接"><span class="toc-number">1.3.</span> <span class="toc-text">C++编译模型深度解析：理解编译与链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-C-程序构建流程：从源代码到可执行文件"><span class="toc-number">1.4.</span> <span class="toc-text">1. C++程序构建流程：从源代码到可执行文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-实际代码示例：分步编译与链接"><span class="toc-number">1.5.</span> <span class="toc-text">2. 实际代码示例：分步编译与链接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-一步到位：编译与链接一次完成"><span class="toc-number">1.5.1.</span> <span class="toc-text">2.1 一步到位：编译与链接一次完成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-分步进行：先编译，后链接"><span class="toc-number">1.5.2.</span> <span class="toc-text">2.2 分步进行：先编译，后链接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-常见误解与错误（以及非代码示例）"><span class="toc-number">1.6.</span> <span class="toc-text">3. 常见误解与错误（以及非代码示例）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-误解：编译就是生成最终的可执行文件"><span class="toc-number">1.6.1.</span> <span class="toc-text">3.1 误解：编译就是生成最终的可执行文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-误解：所有错误都是编译错误"><span class="toc-number">1.6.2.</span> <span class="toc-text">3.2 误解：所有错误都是编译错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-忘记链接所有必要的目标文件或库"><span class="toc-number">1.6.3.</span> <span class="toc-text">3.3 忘记链接所有必要的目标文件或库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-QA-闪存卡（Flash-Cards）"><span class="toc-number">1.7.</span> <span class="toc-text">4. QA 闪存卡（Flash Cards）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-编码练习：修复未定义引用"><span class="toc-number">1.8.</span> <span class="toc-text">5. 编码练习：修复未定义引用</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png)"><div id="post-info"><div id="post-title"><div class="posttitle">338 - cpp Build</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2025-06-08<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2025-06-08</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/10-projects/">10-projects</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/10-projects/cplusplus/">cplusplus</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/10-projects/cplusplus/lectures/">lectures</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2025/06/08/10-projects/cplusplus/lectures/338%20-%20cpp%20Build/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2025/06/08/10-projects/cplusplus/lectures/338%20-%20cpp%20Build/" itemprop="commentCount"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="338-C-Build"><a href="#338-C-Build" class="headerlink" title="338 - C++ Build"></a>338 - C++ Build</h1><h2 id="🧑‍💻-User"><a href="#🧑‍💻-User" class="headerlink" title="🧑‍💻 User"></a>🧑‍💻 User</h2><p>In this lecture, we’re going to revisit our C plus plus compilation model.Along the way, we’re going to see that we can split our compilation process in two steps, and thatis compilation and linking.And we’re going to see that that’s going to be very important for the topics we’re going to talk aboutin this chapter.We already know that to compile our program, we’re going to pass that through the compiler.So what we usually do, we issue a compilation command or program is passed through the compiler.The compiler is going to do its magic and it is going to generate the binary that we can run to do things.But we want to zoom in on this compilation process and see what is happening behind the curtains.So when we compile our program, the first thing that is going to happen is pre-processing and our sourcecode is going to be passed through the preprocessor and the things like include statements and otherthings are going to be processed to be put in our translation unit or CPP files in our C plus plus program.After pre-processing, we have a version of our code which is really not what we typed and we’re goingto pass that through the compiler again to generate object files.So after compilation we’re going to get object files and these are going to be binary representationsof our source code.After that, we’re going to do what we call linking.And in this process we’re going to stitch together all the object files we have in our program, andat the end result is going to be one binary executable that we can run on our system.So what we want to do in this lecture is try this out.We’re going to compile our program in steps and see our object files and really get a feel of what thesethings really are.Okay, So now our compilation model has been updated.We have three steps, we have pre-processing, we have compilation, we have linking.But in this lecture, what we’re going to be looking at is really compilation and linking because pre-processingis really not that important for what we’re going to talk about in this chapter.To compile our program, we’ll be doing our thing on the terminal, so we will be using a terminal likethis.But you can really use any terminal.As long as it works, there is no problem.And you should know that Ides or editors like Visual Studio Code actually call compilers using the sametechniques we’re going to use here.They just provide a more convenient way to do this.So this should be a good lecture to also get a feel of what is happening behind the scenes.As your editor or IDE is doing its thing, We’re going to see how to do this using GCC because it isour main compiler in the course, but the same concepts apply to any other C plus plus compiler youmay be using in your career as a C plus plus developer.You may be using the compiler from Microsoft MVC, you may be using Clang.Any C plus plus compiler can really do this.It is a matter of searching and finding out how to do this thing.We will be using a simple program which is going to be split into three files.We’re going to have a utilities header file.We’re going to have a utilities CPP file, which is going to contain some functions that we want tocall and we will have a main CPP file which is going to contain our main function here.So if we want to compile our program, we can do it in one go, as you see here.And the command to do this is what you see here.We’re going to call GCC, which is our compiler.We’re going to pass a flag, which is going to mean that we want to compile and link.We’re going to specify the output file, which is going to be our program router dot exe.And we’re going to specify the source files.If we hit enter with this command, this is going to compile and link the program and the output ofthis is going to be an executable that we can run directly, but we can also do this in two steps.Remember, we want to break this into compilation and linking so that we can see the object files thatthe compiler generates.And it is really crucial to understand this.So what we want to do is to break this in two steps.We’re going to compile only and the output of compilation is going to be a pair of object files.The command to do that is what you see here.We’re going to call the compiler.We’re going to pass a C flag and then we’re going to specify our input files.The output of this is going to be a pair of object files.Now that we have the object files, we can really do anything we want with them.For example, we can open them and see what is inside.We’re going to do that in a minute, but the ultimate goal is really to stitch these object files togetherand get the final binary file and the command to do that is what you see here.We’re going to link up the object files or stitch them together to get the output file.And what we’re going to do is.Say G plus plus, we’re going to specify all and then we’re going to specify input to the compiler.The input is going to be a pair of object files, and our object files will be the files that we gotfrom the last step when we compiled our program only.And if you do this, you’re going to be able to split your compilation in two steps.The first one is going to be compilation, which is going to generate object files.The second one is going to be the linking stage, which is going to take object files as input and itis going to generate a final binary file that you can run in your system as a word of caution to beable to do what we are about to do.Your compiler should be in your path, so you should be able to call it from anywhere on your terminal.And if it is in your path, you’re going to have no problem with what we are about to do in this coursehere.Now that you know this, we’re going to head over to Visual Studio code and play with this a littlemore.Okay.So here we are in our working folder.The current project is compiling and linking and compilation model here.We’re going to grab our template files and we’re going to copy them.We’re going to put them in place and we are going to open this little guy in Visual Studio code.We are going to set up our project so we have the main file here.Let’s clean up whatever we don’t need and we’re going to add a pair of utilities or functions that aregoing to be living in a separate file.So we’re going to add a utilities header file.Let’s do that.And we are going to add a CPP file for this.The header file is going to contain a pair of functions.So we’re going to be adding up and multiplying stuff and we’re going to put implementations of theseguys in the CPP file.Okay, so let’s do that.We have the implementation for the Add function and an implementation for the multiply function here.We’re going to head over to the main function and include our utilities, file the header.That’s what we want and we are going to head over in the main function and try to use these functionshere.So we’re going to set up a result variable which is going to be of double type and it’s going to addup maybe ten and 20.Why not?And after we do this, we’re going to print the result out.We’re going to say Stdcout, we’re going to say result, and we’re going to print the result out here.Now the program is working.If we build it with Visual Studio Code or wherever it is going to work.But what we really want is to see how to do these things on the terminal and eventually be able to breakour compilation in two steps.The first step is going to be compilation, and the second step is going to be linking and we want tosee the object files that are generated after we compile and generate those object files here.So let’s do this.We’re going to bring up a terminal.Okay, so this terminal is working and this current directory, if we do LS, we’re going to find ourfiles on windows.You can also do dir to see what is inside your folder.We’re going to see that we have the main CPP file.We have our utilities file, the header and the CPP file and we can compile them to be able to compilewith GCC, you need to be able to do G plus plus here and do version.If we do this, we’re going to see our G plus plus compiler.And if you see a message like this, you can call the compiler and do what we are about to do here.If you can’t call your compiler, please make sure you have this in your environment variables.So if we do EMF on our start menu here and hit edit system environment variables, we’re going to chooseenvironment variables here.If you go to your path, you should be able to find the path to the bin directory where g plus plusis installed.If I go in my C drive, let’s do that.I am going to bring up a window and we’re going to go to my C drive.I am going to go in a main GW if I can find it, can I find it?We have it here.Main GW 64.I am going to go and I am going to go in the same directory that I have here in my environment variable.And if I go in this folder you’re going to see that I have my G plus plus compiler right here.So you should have the same setup here to be able to call this little guy from a terminal.So make sure you have this in and you will be able to do what we are about to do.We have seen that it is possible to compile and link our program in one go using the command we seehere.So we’re going to head over to the terminal and do this.So what we’re going to do is call G plus plus we’re going to say G plus plus.We’re going to specify the O flag to mean that we want to compile and link.We’re going to specify the output file, which is going to be rooster dot exe.Then we’re going to specify our input files.We’re going to have the main.File.We have that n and we have our utilities file.If we hit enter, this is going to compile our program.If we do LS, we’re going to find a rooster dot exe file.And if we run it, we’re going to see that this is going to run.It is going to say result is 30.And in our main CPP file, this is what we are doing.We are adding up ten and 20 and the result is going to be 30.Let’s change the input here and make sure that we are really running this program here.We’re going to say 20.8 here and we’re going to compile and link again.So let’s bring this command up again and we’re going to compile and link if we do.LS You’re going to see our rooster exe file.If we run it, we’re going to get a different result.So our program is working here.We can compile and link it on the terminal in one go.Now let’s do a less and we’re going to remove Rooster dot exe here and we want now to compile and linkin two steps.The first step is going to be compilation.The second step is going to be linking the command to compile only is what you see here.So we’re going to say G plus plus specify a C flag and then we’re going to say our input as our mainCPP file and utilities CPP file.Let’s head back over to Visual Studio code and do that.We’re going to say G plus plus specify our C flag and then we’re going to say main CPP file and utilitiesCPP file.If we hit enter, this is going to run.If we do.LS Now we see that we have a main dot o file and a utilities dot o file.If we open this up in our file system, let’s do that.We’re going to find in Explorer and then we’re going to find our main dot o file.We can try and open it with an editor and you’re going to see that it’s some gibberish because thisis a binary file.It is meant to be processed by computers.It is not meant to be read in editors like this.So this is really cool.We are able to generate an object file.Now what we want is to use this object files and generate a binary file and the command to do that iswhat you see here.We’re going to link up our object files.We’re going to call the compiler, we’re going to specify our flag, we’re going to specify the outputfile, and then we’re going to specify our input files to be main dot o and utilities that oh, let’shead over to Visual Studio code and do this.Okay, So we are back in Visual Studio code.We’re going to say G plus plus and we’re going to specify our O flag.We’re going to specify the output to be rooster dot x and our input is going to be main dot o and utilitiesdot o, which are our object files.If we run enter, we’re going to see that this is going to run.If we do LS we’re going to see that we have a rooster dot x file and we were able to generate this fromour object files.If we run Rooster, we’re going to see that we get the exact same result we got before.So this is really how you can compile and link in two steps using the G plus plus compiler that comeswith GCC.Hopefully this is going to shed light on how some things are done and you have to note that functioncalls are resolved at link time.For example, if we try to call this function here and we don’t have a function definition here, competitionis going to work because the compiler is really interested in declarations and our declarations willbe brought in by the enclosure that we are doing here.So the compilation is going to work, but linking is going to fail.Let’s try and do that.We’re going to comment out our implementations.Let’s do that so that they are disabled and we’re going to try and compile this program.Again, we’re going to clear and notice that we are calling the Add function in main.This is what is going to cause problems here.If we try to compile the program and let’s go up and see if we can find our compilation command, let’sdo LS and remove all the clutter that was generated.We’re going to remove main dot O, We’re going to remove the utilities that O file and we’re going toremove rooster dot exe.We’re going to clear and run LS and we’re going to see that we have our source code here.This is really cool.So we’re going to go up and find our compilation command.We want to compile this program and generate our object files.If we do this, you’re going to see that compilation is going to work and we’re going to generate ourobject files here.But if we try to link them, we’re going to get a problem.Let’s try and do that.We’re going to bring back.The command to link.I think we have it in our history here.We have that here.If we run this, you’re going to see that we have a problem undefined reference to add.This is something you can understand now because function calls are resolved at link stage and the compilerdoesn’t really care that we don’t have definitions and the compiler is just happy.Looking at the declarations here.And this is something I wanted you to see in this lecture, this is really all I had to share in thislecture, showing you that you can compile your program on the terminal and break things in two steps.The first step is compilation, the second one is linking.And now you know that function calls are resolved at the link stage.And if you don’t have your definitions and you’re going to have undefined references, as we see here,we’re going to stop here in this lecture.And the next one, we’re going to shed some light on declarations and definitions and learn a littlemore about these important concepts in C plus plus.Go ahead and finish up here and meet me there.</p>
<hr>
<h2 id="🤖-Assistant"><a href="#🤖-Assistant" class="headerlink" title="🤖 Assistant"></a>🤖 Assistant</h2><p>好的，很高兴能为您揭开C++编译过程的神秘面纱！作为您的C++导师，我将尽力用最清晰、最易懂的方式来讲解这些核心概念。</p>
<hr>
<h2 id="C-编译模型深度解析：理解编译与链接"><a href="#C-编译模型深度解析：理解编译与链接" class="headerlink" title="C++编译模型深度解析：理解编译与链接"></a>C++编译模型深度解析：理解编译与链接</h2><p><strong>摘要</strong>: 本讲将深入探讨C++程序从源代码到可执行文件的转换过程，重点聚焦于编译（Compilation）和链接（Linking）这两个关键阶段。通过分步操作和实际代码示例，您将亲身体验生成目标文件（Object Files）并最终链接成可执行文件的全过程，从而彻底理解“未定义引用”（Undefined Reference）等常见链接错误的原因。</p>
<hr>
<h2 id="1-C-程序构建流程：从源代码到可执行文件"><a href="#1-C-程序构建流程：从源代码到可执行文件" class="headerlink" title="1. C++程序构建流程：从源代码到可执行文件"></a>1. C++程序构建流程：从源代码到可执行文件</h2><p>要运行您编写的C++程序，计算机需要将其转换为它能理解的二进制指令。这个转换过程就是<strong>编译模型</strong>（Compilation Model）。通常，我们运行一个命令，编译器（Compiler）会“施展魔法”，直接生成一个可运行的二进制文件。但今天，我们将“放大”这个过程，看看幕后究竟发生了什么。</p>
<p>一个完整的C++程序构建过程通常包括三个主要步骤：</p>
<ol>
<li><p><strong>预处理（Pre-processing）</strong>：</p>
<ul>
<li><strong>作用</strong>: 这是编译过程的第一步。预处理器（Preprocessor）会处理源代码中以<code>#</code>开头的指令，例如<code>#include</code>（包含头文件）、<code>#define</code>（定义宏）等。</li>
<li><strong>细节</strong>: 当您使用<code>#include &lt;iostream&gt;</code>时，预处理器会找到<code>iostream</code>头文件的内容，并将其完整地粘贴到您的源代码文件中。同样，如果您定义了宏，预处理器会用宏的定义替换所有宏的使用。</li>
<li><strong>输出</strong>: 预处理的输出是一个<strong>翻译单元</strong>（Translation Unit），这是一个纯C++代码文件，不再包含任何预处理指令，但包含了所有被<code>#include</code>进来的代码和宏展开后的内容。这个文件通常很大，因为它包含了所有依赖的头文件内容。</li>
<li><strong>重要性</strong>: 虽然预处理非常重要，但本次课程我们将更侧重于编译和链接，因为它们与我们在大型项目中组织代码的方式以及解决“未定义引用”问题更为相关。</li>
</ul>
</li>
<li><p><strong>编译（Compilation）</strong>：</p>
<ul>
<li><strong>作用</strong>: 编译器（Compiler）将预处理后的翻译单元转换为机器语言指令。但请注意，此时生成的代码还不是一个完整的可执行程序。</li>
<li><strong>细节</strong>: 编译器会检查您的C++代码的语法（Syntax）和语义（Semantics）是否正确。它会将您的C++代码翻译成汇编语言（Assembly Language），然后再将汇编语言翻译成机器码。在这个阶段，编译器主要关注<strong>声明</strong>（Declarations），即某个函数或变量“存在”的承诺。如果它看到一个函数调用，只要这个函数被声明了（例如在头文件中），编译器就会认为这是有效的，并为这个调用生成相应的机器码。然而，它并不知道这个函数的具体实现（<strong>定义</strong>，Definitions）在哪里。</li>
<li><strong>输出</strong>: 编译的输出是<strong>目标文件</strong>（Object Files），通常以<code>.o</code>（在Linux/macOS上）或<code>.obj</code>（在Windows上）作为文件扩展名。目标文件是二进制文件，包含了您的源代码编译后的机器码，但它们是<strong>不完整的</strong>，因为它们可能包含对其他文件中定义的函数或变量的引用（Call/Reference），这些引用需要在后续阶段才能被解析。</li>
</ul>
</li>
<li><p><strong>链接（Linking）</strong>：</p>
<ul>
<li><strong>作用</strong>: 链接器（Linker）将所有编译生成的目标文件，以及任何所需的库文件（Libraries），“缝合”在一起，形成一个完整的、可运行的程序。</li>
<li><strong>细节</strong>: 这是解决“未定义引用”问题的关键阶段。当编译器生成目标文件时，它知道您调用了一个函数，但不知道这个函数的具体实现代码在哪里。链接器的工作就是找到这些缺失的函数或变量的<strong>定义</strong>。它会在所有目标文件和您指定的库文件中寻找这些定义，并将它们连接起来。如果链接器找不到某个函数或变量的定义，就会报错，通常是“Undefined Reference”（未定义引用）。</li>
<li><strong>输出</strong>: 链接的最终输出是一个<strong>可执行文件</strong>（Executable File），或者是一个动态/静态库文件。这个文件可以直接在您的操作系统上运行。</li>
</ul>
</li>
</ol>
<p><strong>IDE（集成开发环境）与终端</strong>：<br>像Visual Studio Code、Visual Studio、CLion等IDE，实际上是自动化了上述在终端（Terminal）中进行的编译和链接命令。它们提供了一个更便捷、图形化的界面来管理项目和执行这些操作，但底层调用的原理和命令是相同的。学习如何在终端操作，能让您对IDE幕后发生的事情有更深入的理解。</p>
<p><strong>编译器选择</strong>：<br>本课程将使用GCC（GNU Compiler Collection）中的G++编译器作为示例。GCC是一个非常流行的开源编译器，在Linux、macOS和Windows（通过MinGW或Cygwin）上都广泛使用。但请注意，无论您使用Microsoft的MSVC编译器（通常与Visual Studio集成）还是Clang编译器，其核心编译和链接的概念都是一致的，只是具体的命令参数可能有所不同。</p>
<p><strong>环境配置（PATH变量）</strong>:<br>要在终端中直接调用<code>g++</code>命令，您需要确保编译器的安装路径已添加到系统的<strong>PATH环境变量</strong>（Environment Variables）中。<code>PATH</code>变量告诉操作系统在哪里可以找到可执行程序。如果<code>g++</code>不在<code>PATH</code>中，系统将无法识别该命令。您可以通过在终端输入<code>g++ --version</code>来检查它是否已正确配置。</p>
<h2 id="2-实际代码示例：分步编译与链接"><a href="#2-实际代码示例：分步编译与链接" class="headerlink" title="2. 实际代码示例：分步编译与链接"></a>2. 实际代码示例：分步编译与链接</h2><p>我们将使用一个简单的C++程序，它被拆分成三个文件：</p>
<ul>
<li><code>utilities.h</code>：头文件，包含函数声明。</li>
<li><code>utilities.cpp</code>：源文件，包含函数定义。</li>
<li><code>main.cpp</code>：主程序文件，包含<code>main</code>函数并调用<code>utilities</code>中的函数。</li>
</ul>
<p><strong>程序代码</strong>:</p>
<p><code>utilities.h</code>:<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> UTILITIES_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UTILITIES_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明 (Function Declarations)</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">add</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">multiply</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// UTILITIES_H</span></span></span><br></pre></td></tr></table></figure></div></p>
<p><code>utilities.cpp</code>:<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"utilities.h"</span> <span class="comment">// 包含头文件，获取函数声明</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数定义 (Function Definitions)</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">add</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">multiply</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p><code>main.cpp</code>:<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"utilities.h"</span> <span class="comment">// 包含我们自己的头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> num1 = <span class="number">10.0</span>;</span><br><span class="line">    <span class="keyword">double</span> num2 = <span class="number">20.8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用 utilities.cpp 中定义的函数</span></span><br><span class="line">    <span class="keyword">double</span> sum_result = add(num1, num2);</span><br><span class="line">    <span class="keyword">double</span> product_result = multiply(num1, num2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Sum: "</span> &lt;&lt; sum_result &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Product: "</span> &lt;&lt; product_result &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>现在，我们来看如何在终端中进行编译和链接。</p>
<h3 id="2-1-一步到位：编译与链接一次完成"><a href="#2-1-一步到位：编译与链接一次完成" class="headerlink" title="2.1 一步到位：编译与链接一次完成"></a>2.1 一步到位：编译与链接一次完成</h3><p>这是我们最常见的方式。编译器会自动处理预处理、编译和链接所有源文件：</p>
<p><strong>命令</strong>:<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ main.cpp utilities.cpp -o my_program.exe</span><br></pre></td></tr></table></figure></div></p>
<ul>
<li><code>g++</code>: 调用G++编译器。</li>
<li><code>main.cpp utilities.cpp</code>: 指定需要编译的源文件。</li>
<li><code>-o my_program.exe</code>: <code>-o</code> 标志用于指定输出文件的名称。在这里，输出将是一个名为<code>my_program.exe</code>的可执行文件（在Linux/macOS上通常没有<code>.exe</code>扩展名，直接是<code>my_program</code>）。</li>
</ul>
<p><strong>执行结果</strong>:<br>执行此命令后，如果没有错误，您的目录下会生成<code>my_program.exe</code>文件。运行它，您将看到计算结果：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./my_program.exe</span><br><span class="line">Sum: 30.8</span><br><span class="line">Product: 208</span><br></pre></td></tr></table></figure></div></p>
<h3 id="2-2-分步进行：先编译，后链接"><a href="#2-2-分步进行：先编译，后链接" class="headerlink" title="2.2 分步进行：先编译，后链接"></a>2.2 分步进行：先编译，后链接</h3><p>为了更好地理解目标文件和链接过程，我们可以将上述一步操作拆分为两步。</p>
<p><strong>步骤一：仅编译（生成目标文件）</strong></p>
<p>我们分别编译<code>main.cpp</code>和<code>utilities.cpp</code>，各自生成一个目标文件：</p>
<p><strong>命令</strong>:<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -c main.cpp</span><br><span class="line">g++ -c utilities.cpp</span><br></pre></td></tr></table></figure></div></p>
<ul>
<li><code>-c</code>: 这个标志告诉编译器“只编译，不链接”。这意味着它会生成目标文件，但不会尝试创建可执行文件。</li>
</ul>
<p><strong>执行结果</strong>:<br>执行这些命令后，您的目录下会生成两个新的文件：</p>
<ul>
<li><code>main.o</code> (或 <code>main.obj</code>)</li>
<li><code>utilities.o</code> (或 <code>utilities.obj</code>)</li>
</ul>
<p>这些就是我们说的<strong>目标文件</strong>。如果您尝试用文本编辑器打开它们，会发现它们是乱码（”gibberish”），因为它们是机器码的二进制表示，不是给人阅读的。它们包含了您的函数和变量的机器码，但可能还包含对其他目标文件中定义的函数（如<code>add</code>和<code>multiply</code>在<code>main.o</code>中对<code>utilities.o</code>中函数的引用）的<strong>未解析引用</strong>。</p>
<p><strong>步骤二：仅链接（将目标文件“缝合”成可执行文件）</strong></p>
<p>现在我们有了目标文件，我们可以使用链接器将它们组合起来，创建最终的可执行文件：</p>
<p><strong>命令</strong>:<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ main.o utilities.o -o my_program.exe</span><br></pre></td></tr></table></figure></div></p>
<ul>
<li><code>g++</code>: 再次调用G++，但这次它主要作为链接器使用（因为它没有<code>-c</code>标志，并且输入是<code>.o</code>文件）。</li>
<li><code>main.o utilities.o</code>: 指定作为链接器输入的<strong>目标文件</strong>。</li>
<li><code>-o my_program.exe</code>: 指定输出的可执行文件名称。</li>
</ul>
<p><strong>执行结果</strong>:<br>执行此命令后，链接器会将<code>main.o</code>和<code>utilities.o</code>中的机器码拼接在一起，解析所有内部引用，最终生成<code>my_program.exe</code>。运行结果与一步到位时相同。</p>
<p>通过这个分步过程，您可以看到<code>main.o</code>和<code>utilities.o</code>是如何产生的，以及它们在链接阶段被组合成一个完整程序的。</p>
<h2 id="3-常见误解与错误（以及非代码示例）"><a href="#3-常见误解与错误（以及非代码示例）" class="headerlink" title="3. 常见误解与错误（以及非代码示例）"></a>3. 常见误解与错误（以及非代码示例）</h2><h3 id="3-1-误解：编译就是生成最终的可执行文件"><a href="#3-1-误解：编译就是生成最终的可执行文件" class="headerlink" title="3.1 误解：编译就是生成最终的可执行文件"></a>3.1 误解：编译就是生成最终的可执行文件</h3><ul>
<li><strong>澄清</strong>: 正如我们所见，编译仅仅是将源代码转换为目标文件。这些目标文件是中间产物，它们还不能独立运行。只有经过链接阶段，才能生成最终的可执行文件。</li>
<li><strong>非代码示例</strong>：想象您要制作一个复杂的乐高城堡。<ul>
<li><strong>预处理</strong>：打开所有乐高零件包，清点并分类零件。</li>
<li><strong>编译</strong>：根据图纸，您会分别搭建城堡的各个独立部分：一个塔楼、一段城墙、一个大门。这些独立搭建好的部分，就像是编译阶段生成的<strong>目标文件</strong>。每个部分都是独立的，但它们本身还不是完整的城堡。</li>
<li><strong>链接</strong>：最后，您将所有这些独立搭建好的塔楼、城墙、大门等部分（目标文件）<strong>连接</strong>起来，按照总图纸将其组合成一个完整的、可玩的乐高城堡。这个最终的城堡，就是<strong>可执行文件</strong>。如果某个部分在设计时需要连接到另一个“理论上存在”但你还没建好的部分，那在连接时就会出问题（链接错误）。</li>
</ul>
</li>
</ul>
<h3 id="3-2-误解：所有错误都是编译错误"><a href="#3-2-误解：所有错误都是编译错误" class="headerlink" title="3.2 误解：所有错误都是编译错误"></a>3.2 误解：所有错误都是编译错误</h3><ul>
<li><p><strong>澄清</strong>: C++程序中会遇到两种主要的错误：</p>
<ul>
<li><strong>编译错误</strong>：通常是语法错误（如缺少分号、拼写错误）、类型不匹配、未声明的变量或函数（因为编译器在编译时找不到其声明）。这些错误会在<code>g++ -c</code>阶段或一步到位的<code>g++</code>命令的编译阶段被检测到。</li>
<li><strong>链接错误</strong>：最典型的就是“<code>undefined reference</code>”（未定义引用）。这发生在<strong>链接阶段</strong>，意味着编译器在编译时看到了某个函数或变量的<strong>声明</strong>（知道它应该存在），但链接器在所有目标文件和库中都找不到它的<strong>定义</strong>（实际的实现代码）。</li>
</ul>
</li>
<li><p><strong>案例分析：<code>undefined reference</code></strong></p>
<ul>
<li><strong>情景重现</strong>: 假设在<code>utilities.cpp</code>中，我们注释掉了<code>add</code>函数的实现（定义），但在<code>main.cpp</code>中仍然调用了<code>add</code>函数。</li>
<li><strong>编译阶段</strong>：<ul>
<li><code>g++ -c main.cpp</code>：会成功。因为<code>main.cpp</code>包含了<code>utilities.h</code>，其中有<code>add</code>函数的声明，所以编译器知道<code>add</code>函数存在。它会生成<code>main.o</code>。</li>
<li><code>g++ -c utilities.cpp</code>：也会成功。即使<code>add</code>函数没有实现，编译器也只是编译<code>utilities.cpp</code>中<strong>有效</strong>的代码。它会生成<code>utilities.o</code>。</li>
</ul>
</li>
<li><strong>链接阶段</strong>：<ul>
<li><code>g++ main.o utilities.o -o my_program.exe</code>：此时会报错！链接器在处理<code>main.o</code>时发现它引用了<code>add</code>函数，然后它会在<code>utilities.o</code>和其他默认库中寻找<code>add</code>函数的<strong>定义</strong>，但因为<code>utilities.cpp</code>中的<code>add</code>定义被注释掉了，所以链接器找不到，从而报出<code>undefined reference to &#39;add(double, double)&#39;</code>这样的错误。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>这个例子清楚地说明了编译器只关心声明，而链接器关心定义的重要性。</p>
<h3 id="3-3-忘记链接所有必要的目标文件或库"><a href="#3-3-忘记链接所有必要的目标文件或库" class="headerlink" title="3.3 忘记链接所有必要的目标文件或库"></a>3.3 忘记链接所有必要的目标文件或库</h3><ul>
<li><strong>常见错误</strong>: 有时候，当我们项目文件很多时，可能会忘记在链接命令中包含所有编译生成的目标文件。</li>
<li><strong>后果</strong>: 如果你只链接了<code>main.o</code>，而<code>main.o</code>调用了<code>utilities.o</code>中的函数，你仍然会得到<code>undefined reference</code>错误，因为链接器找不到<code>utilities.o</code>中那些函数的定义。</li>
<li><strong>解决方案</strong>: 确保在链接命令中包含了所有您的项目所需的目标文件，以及任何外部库文件（例如，如果您的程序使用了数学函数，可能需要链接到数学库，如<code>-lm</code>）。</li>
</ul>
<h2 id="4-QA-闪存卡（Flash-Cards）"><a href="#4-QA-闪存卡（Flash-Cards）" class="headerlink" title="4. QA 闪存卡（Flash Cards）"></a>4. QA 闪存卡（Flash Cards）</h2><ol>
<li><p><strong>Q</strong>: C++程序从源代码到可执行文件通常要经过哪三个主要步骤？<br><strong>A</strong>: 预处理（Pre-processing）、编译（Compilation）、链接（Linking）。</p>
</li>
<li><p><strong>Q</strong>: <code>g++ -c</code> 命令的作用是什么？它会生成什么文件？<br><strong>A</strong>: <code>-c</code> 标志表示“只编译，不链接”。它会将源代码文件编译成<strong>目标文件</strong>（Object Files，如<code>.o</code>或<code>.obj</code>），这些文件是二进制的中间产物，不能直接运行。</p>
</li>
<li><p><strong>Q</strong>: 编译阶段和链接阶段分别关注什么？<br><strong>A</strong>:</p>
<ul>
<li><strong>编译阶段</strong>主要关注代码的语法和<strong>声明</strong>（Declarations）的正确性。</li>
<li><strong>链接阶段</strong>主要关注解析所有<strong>定义</strong>（Definitions）的引用，将不同的目标文件和库文件组合成一个完整的可执行程序。</li>
</ul>
</li>
<li><p><strong>Q</strong>: 当您看到“<code>undefined reference</code>”错误时，这意味着什么？它发生在哪个阶段？<br><strong>A</strong>: 这意味着链接器找不到某个函数或变量的<strong>定义</strong>（实现）。它发生在<strong>链接阶段</strong>。通常是因为对应的源文件没有被编译，或者编译后的目标文件没有被包含到链接命令中，或者该定义确实不存在。</p>
</li>
<li><p><strong>Q</strong>: 为什么IDE（如Visual Studio Code）能直接“运行”C++代码而无需手动输入<code>g++</code>命令？<br><strong>A</strong>: IDE在幕后自动化了编译和链接过程。它们会根据您的项目配置，自动调用相应的编译器（如<code>g++</code>）并传递正确的参数来完成编译和链接，然后运行生成的可执行文件。</p>
</li>
</ol>
<h2 id="5-编码练习：修复未定义引用"><a href="#5-编码练习：修复未定义引用" class="headerlink" title="5. 编码练习：修复未定义引用"></a>5. 编码练习：修复未定义引用</h2><p>现在，请您完成下面的C++代码。您的任务是修复一个常见的错误：<strong>未定义引用</strong>。</p>
<p><strong>背景</strong>:<br>我们有一个<code>calculator.h</code>头文件，声明了一个<code>subtract</code>函数。<code>main.cpp</code>试图调用这个函数。</p>
<p><strong>文件结构</strong>:</p>
<ul>
<li><code>calculator.h</code> (已提供)</li>
<li><code>main.cpp</code> (已提供，但会出错)</li>
<li><code>calculator.cpp</code> (<strong>需要您创建并实现 <code>subtract</code> 函数</strong>)</li>
</ul>
<p><strong><code>calculator.h</code></strong>:<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CALCULATOR_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALCULATOR_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">subtract</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// CALCULATOR_H</span></span></span><br></pre></td></tr></table></figure></div></p>
<p><strong><code>main.cpp</code></strong>:<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"calculator.h"</span> <span class="comment">// 包含函数声明</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> val1 = <span class="number">100.0</span>;</span><br><span class="line">    <span class="keyword">double</span> val2 = <span class="number">35.5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 尝试调用 subtract 函数</span></span><br><span class="line">    <span class="keyword">double</span> diff = subtract(val1, val2); <span class="comment">// 这一行会导致问题！</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Difference: "</span> &lt;&lt; diff &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p><strong>您的任务</strong>:</p>
<ol>
<li><strong>创建 <code>calculator.cpp</code> 文件。</strong></li>
<li><strong>在 <code>calculator.cpp</code> 中实现 <code>subtract</code> 函数。</strong> 该函数应该接受两个<code>double</code>类型的参数，并返回它们的差。</li>
<li><strong>使用 <code>g++</code> 命令编译和链接这些文件，使其能够成功运行。</strong> 您可以选择一步到位或分步进行。</li>
</ol>
<p><strong>请在您的回复中提供 <code>calculator.cpp</code> 的完整代码，以及您使用的 <code>g++</code> 编译命令。</strong></p>
<hr>
</div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Cpp/">Cpp    </a><a class="post-meta__tags" href="/tags/Coding/">Coding    </a><a class="post-meta__tags" href="/tags/Development/">Development    </a><a class="post-meta__tags" href="/tags/Software/">Software    </a><a class="post-meta__tags" href="/tags/Compiler/">Compiler    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2025/06/08/10-projects/cplusplus/lectures/334%20-%20cpp%20Nested/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>334 - cpp Nested</span></div></a></div><div class="next-post pull_right"><a href="/2025/06/08/10-projects/cplusplus/lectures/339%20-%20cpp%20%E5%A3%B0%E6%98%8E%E4%B8%8E%E5%AE%9A%E4%B9%89/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>339 - cpp 声明与定义</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/notes/diff between constexpr and define/" title="diff between constexpr and define"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">diff between constexpr and define</div></div></a></div><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/notes/c plus plus template declaration best practice/" title="c plus plus template declaration best practice"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">c plus plus template declaration best practice</div></div></a></div><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/notes/Cpp 默认构造函数创建对象/" title="Cpp 默认构造函数创建对象"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">Cpp 默认构造函数创建对象</div></div></a></div><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/notes/静态成员访问控制/" title="静态成员访问控制"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">静态成员访问控制</div></div></a></div><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/lectures/257 - cpp Default template arguments/" title="257 - cpp Default template arguments"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">257 - cpp Default template arguments</div></div></a></div><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/lectures/258 - Non type template parameters/" title="258 - Non type template parameters"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">258 - Non type template parameters</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = true == true ? true : false;
var verify = true == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'xvMxbws16Erd8WUfqxkvHmb5-gzGzoHsz',
  appKey:'4U0Vo7NQIUL0eJzHdkPzdCDr',
  placeholder:'不说话的人会疯掉吗?',
  avatar:'retro',
  guest_info:guest_info,
  pageSize:'10',
  lang:'en',
  recordIP: true
});</script></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2025 By supersheepbear</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="external nofollow noopener noreferrer"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="external nofollow noopener noreferrer"><span>Butterfly</span></a></div><div class="footer_custom_text">外向孤独者患者</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script id="canvas_nest" color="255,240,245" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-nest.js"></script><script src="https://cdn.jsdelivr.net/npm/activate-power-mode/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false; 
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="external nofollow noopener noreferrer" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body></html>