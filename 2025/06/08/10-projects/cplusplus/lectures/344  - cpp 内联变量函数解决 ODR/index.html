<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>344  - cpp å†…è”å˜é‡å‡½æ•°è§£å†³ ODR | Bear's dream</title><meta name="description" content="344  - cpp å†…è”å˜é‡å‡½æ•°è§£å†³ ODR"><meta name="keywords" content="Coding,Cpp,Function,Developer,Variable"><meta name="author" content="supersheepbear"><meta name="copyright" content="supersheepbear"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon_1.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="p43hXBn3_dLvbyxUzx0eo5eYmj9OVYOV52pdrhBa2sw"><meta name="baidu-site-verification" content="EXLlfLv2pV"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="344  - cpp å†…è”å˜é‡å‡½æ•°è§£å†³ ODR"><meta name="twitter:description" content="344  - cpp å†…è”å˜é‡å‡½æ•°è§£å†³ ODR"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><meta property="og:type" content="article"><meta property="og:title" content="344  - cpp å†…è”å˜é‡å‡½æ•°è§£å†³ ODR"><meta property="og:url" content="https://yxiong.org/2025/06/08/10-projects/cplusplus/lectures/344%20%20-%20cpp%20%E5%86%85%E8%81%94%E5%8F%98%E9%87%8F%E5%87%BD%E6%95%B0%E8%A7%A3%E5%86%B3%20ODR/"><meta property="og:site_name" content="Bear's dream"><meta property="og:description" content="344  - cpp å†…è”å˜é‡å‡½æ•°è§£å†³ ODR"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://yxiong.org/2025/06/08/10-projects/cplusplus/lectures/344%20%20-%20cpp%20%E5%86%85%E8%81%94%E5%8F%98%E9%87%8F%E5%87%BD%E6%95%B0%E8%A7%A3%E5%86%B3%20ODR/"><link rel="prev" title="340 - ODR Cpp" href="https://yxiong.org/2025/06/08/10-projects/cplusplus/lectures/340%20-%20ODR%20Cpp/"><link rel="next" title="Pandas_Basic_Command_Quick_Check_Table" href="https://yxiong.org/2025/06/08/30-resources/coding/python/Pandas_Basic_Command_Quick_Check_Table/"><link rel="stylesheet" href="hfttps://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'æŒ‰',
    message_next: 'é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾'
  },
  runtime_unit: 'å¤©',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Bear's dream" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Bear's dream</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> éŸ³ä¹ç…§ç‰‡</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fa fa-picture-o"></i><span> ç…§ç‰‡</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> å­¦ä¹ è®¡åˆ’</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> æœç´¢</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200520153141.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length_num">150</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length_num">151</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length_num">18</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> éŸ³ä¹ç…§ç‰‡</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fa fa-picture-o"></i><span> ç…§ç‰‡</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> å­¦ä¹ è®¡åˆ’</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">ç›®å½•</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#344-Cpp-å†…è”å˜é‡å‡½æ•°è§£å†³-ODR"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">344 - Cpp å†…è”å˜é‡å‡½æ•°è§£å†³ ODR</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-å¼•è¨€ï¼šå•ä¸€å®šä¹‰è§„åˆ™-ODR"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">1. å¼•è¨€ï¼šå•ä¸€å®šä¹‰è§„åˆ™ (ODR)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-å†…è”-inline-ç™»åœºï¼šODR-çš„â€œä¾‹å¤–â€"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">2. å†…è” (inline) ç™»åœºï¼šODR çš„â€œä¾‹å¤–â€</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-å†…è”å˜é‡"><span class="toc_mobile_items-number">1.5.</span> <span class="toc_mobile_items-text">3. å†…è”å˜é‡</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-å†…è”å‡½æ•°"><span class="toc_mobile_items-number">1.6.</span> <span class="toc_mobile_items-text">4. å†…è”å‡½æ•°</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5-inline-çš„é‡è¦ç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹"><span class="toc_mobile_items-number">1.7.</span> <span class="toc_mobile_items-text">5. inline çš„é‡è¦ç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#6-ä»£ç ç¤ºä¾‹"><span class="toc_mobile_items-number">1.8.</span> <span class="toc_mobile_items-text">6. ä»£ç ç¤ºä¾‹</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-QA-é—ªå¡-QA-Flash-Cards"><span class="toc_mobile_items-number">1.9.</span> <span class="toc_mobile_items-text">7. QA é—ªå¡ (QA Flash Cards)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#8-å¸¸è§è¯¯è§£ä¸é”™è¯¯"><span class="toc_mobile_items-number">1.10.</span> <span class="toc_mobile_items-text">8. å¸¸è§è¯¯è§£ä¸é”™è¯¯</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#9-ç¼–ç¨‹ç»ƒä¹ "><span class="toc_mobile_items-number">1.11.</span> <span class="toc_mobile_items-text">9. ç¼–ç¨‹ç»ƒä¹ </span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User-1"><span class="toc_mobile_items-number">1.12.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant-1"><span class="toc_mobile_items-number">1.13.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User-2"><span class="toc_mobile_items-number">1.14.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant-2"><span class="toc_mobile_items-number">1.15.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User-3"><span class="toc_mobile_items-number">1.16.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant-3"><span class="toc_mobile_items-number">1.17.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#å…³äº-inline-åœ¨-C-ä¸­çš„ä¼˜åŒ–ä½œç”¨"><span class="toc_mobile_items-number">1.18.</span> <span class="toc_mobile_items-text">å…³äº inline åœ¨ C++ ä¸­çš„ä¼˜åŒ–ä½œç”¨</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#å…³äº-C-è¯­è¨€ä¸­çš„-inline"><span class="toc_mobile_items-number">1.19.</span> <span class="toc_mobile_items-text">å…³äº C è¯­è¨€ä¸­çš„ inline</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User-4"><span class="toc_mobile_items-number">1.20.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant-4"><span class="toc_mobile_items-number">1.21.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User-5"><span class="toc_mobile_items-number">1.22.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant-5"><span class="toc_mobile_items-number">1.23.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#C-inline-ä¸-ODRï¼šç»Ÿä¸€ï¼ˆUnificationï¼‰"><span class="toc_mobile_items-number">1.24.</span> <span class="toc_mobile_items-text">C++ inline ä¸ ODRï¼šç»Ÿä¸€ï¼ˆUnificationï¼‰</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#C-è¯­è¨€-inline-ä¸-ODRï¼šå…è®¸ç‹¬ç«‹å‰¯æœ¬ï¼ˆPermitting-Separate-Copiesï¼‰"><span class="toc_mobile_items-number">1.25.</span> <span class="toc_mobile_items-text">C è¯­è¨€ inline ä¸ ODRï¼šå…è®¸ç‹¬ç«‹å‰¯æœ¬ï¼ˆPermitting Separate Copiesï¼‰</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User-6"><span class="toc_mobile_items-number">1.26.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant-6"><span class="toc_mobile_items-number">1.27.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-C-ä¸­-inline-å‡½æ•°åœ¨-Header-ä¸­çš„æƒ…å†µï¼š"><span class="toc_mobile_items-number">1.28.</span> <span class="toc_mobile_items-text">1. C++ ä¸­ inline å‡½æ•°åœ¨ Header ä¸­çš„æƒ…å†µï¼š</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-C-è¯­è¨€ä¸­-inline-å‡½æ•°åœ¨-Header-ä¸­çš„æƒ…å†µï¼š"><span class="toc_mobile_items-number">1.29.</span> <span class="toc_mobile_items-text">2. C è¯­è¨€ä¸­ inline å‡½æ•°åœ¨ Header ä¸­çš„æƒ…å†µï¼š</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User-7"><span class="toc_mobile_items-number">1.30.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant-7"><span class="toc_mobile_items-number">1.31.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User-8"><span class="toc_mobile_items-number">1.32.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant-8"><span class="toc_mobile_items-number">1.33.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-C-ä¸­é€‚åˆè®¾ç½®æˆ-inline-æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°"><span class="toc_mobile_items-number">1.34.</span> <span class="toc_mobile_items-text">1. C++ ä¸­é€‚åˆè®¾ç½®æˆ inline æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-C-è¯­è¨€ä¸­é€‚åˆè®¾ç½®æˆ-inline-æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°"><span class="toc_mobile_items-number">1.35.</span> <span class="toc_mobile_items-text">2. C è¯­è¨€ä¸­é€‚åˆè®¾ç½®æˆ inline æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User-9"><span class="toc_mobile_items-number">1.36.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant-9"><span class="toc_mobile_items-number">1.37.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#C-ä¸­çš„-static-inline"><span class="toc_mobile_items-number">1.38.</span> <span class="toc_mobile_items-text">C++ ä¸­çš„ static inline</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#C-static-inline-ä¸-C-static-inline-çš„æ ¸å¿ƒåŒºåˆ«"><span class="toc_mobile_items-number">1.39.</span> <span class="toc_mobile_items-text">C++ static inline ä¸ C static inline çš„æ ¸å¿ƒåŒºåˆ«</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ä¸ºä»€ä¹ˆ-C-ä¸­-static-inline-å…¨å±€å‡½æ•°ä¸å¸¸è§ï¼Ÿ"><span class="toc_mobile_items-number">1.40.</span> <span class="toc_mobile_items-text">ä¸ºä»€ä¹ˆ C++ ä¸­ static inline å…¨å±€å‡½æ•°ä¸å¸¸è§ï¼Ÿ</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ç»“è®º"><span class="toc_mobile_items-number">1.41.</span> <span class="toc_mobile_items-text">ç»“è®º</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User-10"><span class="toc_mobile_items-number">1.42.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant-10"><span class="toc_mobile_items-number">1.43.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#C-ä¸­å°†å°å‹å·¥å…·å‡½æ•°æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„æ–¹æ³•"><span class="toc_mobile_items-number">1.44.</span> <span class="toc_mobile_items-text">C++ ä¸­å°†å°å‹å·¥å…·å‡½æ•°æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„æ–¹æ³•</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-æœ€å¸¸ç”¨ä¸”æ¨èçš„æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨-inline-å…³é”®å­—"><span class="toc_mobile_items-number">1.44.1.</span> <span class="toc_mobile_items-text">1. æœ€å¸¸ç”¨ä¸”æ¨èçš„æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨ inline å…³é”®å­—</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-å¦‚æœç¡®å®éœ€è¦-C-è¯­è¨€-static-inline-é‚£ç§â€œæ¯ä¸ªç¿»è¯‘å•å…ƒä¸€ä»½ç‹¬ç«‹å‰¯æœ¬â€çš„è¯­ä¹‰ï¼šä½¿ç”¨åŒ¿åå‘½åç©ºé—´"><span class="toc_mobile_items-number">1.44.2.</span> <span class="toc_mobile_items-text">2. å¦‚æœç¡®å®éœ€è¦ C è¯­è¨€ static inline é‚£ç§â€œæ¯ä¸ªç¿»è¯‘å•å…ƒä¸€ä»½ç‹¬ç«‹å‰¯æœ¬â€çš„è¯­ä¹‰ï¼šä½¿ç”¨åŒ¿åå‘½åç©ºé—´</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#æ€»ç»“"><span class="toc_mobile_items-number">1.45.</span> <span class="toc_mobile_items-text">æ€»ç»“</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ§‘â€ğŸ’»-User-11"><span class="toc_mobile_items-number">1.46.</span> <span class="toc_mobile_items-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ğŸ¤–-Assistant-11"><span class="toc_mobile_items-number">1.47.</span> <span class="toc_mobile_items-text">ğŸ¤– Assistant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#C-inline-æœºåˆ¶çš„ä¼˜åŠ¿-ä¸-C-å¯¹æ¯”"><span class="toc_mobile_items-number">1.48.</span> <span class="toc_mobile_items-text">C++ inline æœºåˆ¶çš„ä¼˜åŠ¿ (ä¸ C å¯¹æ¯”)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#æ€»ç»“-1"><span class="toc_mobile_items-number">1.49.</span> <span class="toc_mobile_items-text">æ€»ç»“</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#344-Cpp-å†…è”å˜é‡å‡½æ•°è§£å†³-ODR"><span class="toc-number">1.</span> <span class="toc-text">344 - Cpp å†…è”å˜é‡å‡½æ•°è§£å†³ ODR</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User"><span class="toc-number">1.1.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant"><span class="toc-number">1.2.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-å¼•è¨€ï¼šå•ä¸€å®šä¹‰è§„åˆ™-ODR"><span class="toc-number">1.3.</span> <span class="toc-text">1. å¼•è¨€ï¼šå•ä¸€å®šä¹‰è§„åˆ™ (ODR)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-å†…è”-inline-ç™»åœºï¼šODR-çš„â€œä¾‹å¤–â€"><span class="toc-number">1.4.</span> <span class="toc-text">2. å†…è” (inline) ç™»åœºï¼šODR çš„â€œä¾‹å¤–â€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-å†…è”å˜é‡"><span class="toc-number">1.5.</span> <span class="toc-text">3. å†…è”å˜é‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-å†…è”å‡½æ•°"><span class="toc-number">1.6.</span> <span class="toc-text">4. å†…è”å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-inline-çš„é‡è¦ç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹"><span class="toc-number">1.7.</span> <span class="toc-text">5. inline çš„é‡è¦ç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-ä»£ç ç¤ºä¾‹"><span class="toc-number">1.8.</span> <span class="toc-text">6. ä»£ç ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-QA-é—ªå¡-QA-Flash-Cards"><span class="toc-number">1.9.</span> <span class="toc-text">7. QA é—ªå¡ (QA Flash Cards)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-å¸¸è§è¯¯è§£ä¸é”™è¯¯"><span class="toc-number">1.10.</span> <span class="toc-text">8. å¸¸è§è¯¯è§£ä¸é”™è¯¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-ç¼–ç¨‹ç»ƒä¹ "><span class="toc-number">1.11.</span> <span class="toc-text">9. ç¼–ç¨‹ç»ƒä¹ </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User-1"><span class="toc-number">1.12.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant-1"><span class="toc-number">1.13.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User-2"><span class="toc-number">1.14.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant-2"><span class="toc-number">1.15.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User-3"><span class="toc-number">1.16.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant-3"><span class="toc-number">1.17.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…³äº-inline-åœ¨-C-ä¸­çš„ä¼˜åŒ–ä½œç”¨"><span class="toc-number">1.18.</span> <span class="toc-text">å…³äº inline åœ¨ C++ ä¸­çš„ä¼˜åŒ–ä½œç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…³äº-C-è¯­è¨€ä¸­çš„-inline"><span class="toc-number">1.19.</span> <span class="toc-text">å…³äº C è¯­è¨€ä¸­çš„ inline</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User-4"><span class="toc-number">1.20.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant-4"><span class="toc-number">1.21.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User-5"><span class="toc-number">1.22.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant-5"><span class="toc-number">1.23.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-inline-ä¸-ODRï¼šç»Ÿä¸€ï¼ˆUnificationï¼‰"><span class="toc-number">1.24.</span> <span class="toc-text">C++ inline ä¸ ODRï¼šç»Ÿä¸€ï¼ˆUnificationï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-è¯­è¨€-inline-ä¸-ODRï¼šå…è®¸ç‹¬ç«‹å‰¯æœ¬ï¼ˆPermitting-Separate-Copiesï¼‰"><span class="toc-number">1.25.</span> <span class="toc-text">C è¯­è¨€ inline ä¸ ODRï¼šå…è®¸ç‹¬ç«‹å‰¯æœ¬ï¼ˆPermitting Separate Copiesï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User-6"><span class="toc-number">1.26.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant-6"><span class="toc-number">1.27.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-C-ä¸­-inline-å‡½æ•°åœ¨-Header-ä¸­çš„æƒ…å†µï¼š"><span class="toc-number">1.28.</span> <span class="toc-text">1. C++ ä¸­ inline å‡½æ•°åœ¨ Header ä¸­çš„æƒ…å†µï¼š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-C-è¯­è¨€ä¸­-inline-å‡½æ•°åœ¨-Header-ä¸­çš„æƒ…å†µï¼š"><span class="toc-number">1.29.</span> <span class="toc-text">2. C è¯­è¨€ä¸­ inline å‡½æ•°åœ¨ Header ä¸­çš„æƒ…å†µï¼š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User-7"><span class="toc-number">1.30.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant-7"><span class="toc-number">1.31.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User-8"><span class="toc-number">1.32.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant-8"><span class="toc-number">1.33.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-C-ä¸­é€‚åˆè®¾ç½®æˆ-inline-æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°"><span class="toc-number">1.34.</span> <span class="toc-text">1. C++ ä¸­é€‚åˆè®¾ç½®æˆ inline æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-C-è¯­è¨€ä¸­é€‚åˆè®¾ç½®æˆ-inline-æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°"><span class="toc-number">1.35.</span> <span class="toc-text">2. C è¯­è¨€ä¸­é€‚åˆè®¾ç½®æˆ inline æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User-9"><span class="toc-number">1.36.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant-9"><span class="toc-number">1.37.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-ä¸­çš„-static-inline"><span class="toc-number">1.38.</span> <span class="toc-text">C++ ä¸­çš„ static inline</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-static-inline-ä¸-C-static-inline-çš„æ ¸å¿ƒåŒºåˆ«"><span class="toc-number">1.39.</span> <span class="toc-text">C++ static inline ä¸ C static inline çš„æ ¸å¿ƒåŒºåˆ«</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸ºä»€ä¹ˆ-C-ä¸­-static-inline-å…¨å±€å‡½æ•°ä¸å¸¸è§ï¼Ÿ"><span class="toc-number">1.40.</span> <span class="toc-text">ä¸ºä»€ä¹ˆ C++ ä¸­ static inline å…¨å±€å‡½æ•°ä¸å¸¸è§ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç»“è®º"><span class="toc-number">1.41.</span> <span class="toc-text">ç»“è®º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User-10"><span class="toc-number">1.42.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant-10"><span class="toc-number">1.43.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-ä¸­å°†å°å‹å·¥å…·å‡½æ•°æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„æ–¹æ³•"><span class="toc-number">1.44.</span> <span class="toc-text">C++ ä¸­å°†å°å‹å·¥å…·å‡½æ•°æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-æœ€å¸¸ç”¨ä¸”æ¨èçš„æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨-inline-å…³é”®å­—"><span class="toc-number">1.44.1.</span> <span class="toc-text">1. æœ€å¸¸ç”¨ä¸”æ¨èçš„æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨ inline å…³é”®å­—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-å¦‚æœç¡®å®éœ€è¦-C-è¯­è¨€-static-inline-é‚£ç§â€œæ¯ä¸ªç¿»è¯‘å•å…ƒä¸€ä»½ç‹¬ç«‹å‰¯æœ¬â€çš„è¯­ä¹‰ï¼šä½¿ç”¨åŒ¿åå‘½åç©ºé—´"><span class="toc-number">1.44.2.</span> <span class="toc-text">2. å¦‚æœç¡®å®éœ€è¦ C è¯­è¨€ static inline é‚£ç§â€œæ¯ä¸ªç¿»è¯‘å•å…ƒä¸€ä»½ç‹¬ç«‹å‰¯æœ¬â€çš„è¯­ä¹‰ï¼šä½¿ç”¨åŒ¿åå‘½åç©ºé—´</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">1.45.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ§‘â€ğŸ’»-User-11"><span class="toc-number">1.46.</span> <span class="toc-text">ğŸ§‘â€ğŸ’» User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤–-Assistant-11"><span class="toc-number">1.47.</span> <span class="toc-text">ğŸ¤– Assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-inline-æœºåˆ¶çš„ä¼˜åŠ¿-ä¸-C-å¯¹æ¯”"><span class="toc-number">1.48.</span> <span class="toc-text">C++ inline æœºåˆ¶çš„ä¼˜åŠ¿ (ä¸ C å¯¹æ¯”)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“-1"><span class="toc-number">1.49.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png)"><div id="post-info"><div id="post-title"><div class="posttitle">344  - cpp å†…è”å˜é‡å‡½æ•°è§£å†³ ODR</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> å‘è¡¨äº 2025-06-08<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> æ›´æ–°äº 2025-06-08</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/10-projects/">10-projects</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/10-projects/cplusplus/">cplusplus</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/10-projects/cplusplus/lectures/">lectures</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>è¯„è®ºæ•°:</span><a href="/2025/06/08/10-projects/cplusplus/lectures/344%20%20-%20cpp%20%E5%86%85%E8%81%94%E5%8F%98%E9%87%8F%E5%87%BD%E6%95%B0%E8%A7%A3%E5%86%B3%20ODR/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2025/06/08/10-projects/cplusplus/lectures/344%20%20-%20cpp%20%E5%86%85%E8%81%94%E5%8F%98%E9%87%8F%E5%87%BD%E6%95%B0%E8%A7%A3%E5%86%B3%20ODR/" itemprop="commentCount"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="344-Cpp-å†…è”å˜é‡å‡½æ•°è§£å†³-ODR"><a href="#344-Cpp-å†…è”å˜é‡å‡½æ•°è§£å†³-ODR" class="headerlink" title="344 - Cpp å†…è”å˜é‡å‡½æ•°è§£å†³ ODR"></a>344 - Cpp å†…è”å˜é‡å‡½æ•°è§£å†³ ODR</h1><h2 id="ğŸ§‘â€ğŸ’»-User"><a href="#ğŸ§‘â€ğŸ’»-User" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>In this lecture, weâ€™re going to learn about inline variables and functions.And this is a facility we have in the C plus plus programming language to be able to violate the onedefinition rule.If you remember, we have said that it isnâ€™t possible to have two definitions for the same name in asame file or even across different files or translation unit.If you do this, youâ€™re going to get redefinition errors, be it a compiler error or a wrinkle error.But sometimes you really want to do this.Suppose we have a setup like this.We have a variable age and we have a function, some function, and we want these guys to show up indifferent translation units just like this.And we want, for example, the values we have in the age variable here to be the same.I know some of you are asking why on earth would I want to do something like this?But letâ€™s first look at how we can achieve this.Then Iâ€™m going to show you why you would need to do something like this to be able to do this withouta problem.You can mark these names as in line.For example, we can mark the age here as in line, and we can mark some function here as in line anddo the same thing for utility to here.And these names are now going to be confined to the translation units within the show up.So age and utility one is only going to be usable in utility one and age and utility two is going tobe only usable in utility two, and thatâ€™s going to avoid the one definition rule.And we will still be able to use these names without a problem.So we achieved this by marking these guys as inline.We can achieve this by marking these guys as inline in utility one, we have age as inline.We have our function here as inline and we do the same things in utility two.And this is going to allow us to use these guys across translation units without a problem.Okay?So once we mark these guys as inline, the compiler is going to do something really cool behind thescenes.The compiler is going to unify these guys into one.For example, this age is going to be a single variable in the eyes of the compiler, and this functionhere is going to be the same function, but we will be able to manipulate it across different translationunits.And this is something you need to keep in mind.For example, if we were able to set up a function like this to print the age here through the printage function here, we would be able to see that the age variable we have here is the same across translationunits, but we canâ€™t use the age across translation units.Each age is going to be confined to its own translation unit.I know this may be confusing, but bear with me.Weâ€™re going to head over to Visual Studio code in a minute and youâ€™re going to see that this is reallycool.Okay.So now that we know how we can mark our functions or variables as inline, letâ€™s address the questionof why we would want to do something like this.Suppose you have a utility file, a utility header file here and inside we have a variable and a functionand we want this to live in a header file so that we can include this in multiple files.So remember, including a header is just going to copy the contents of the header.And if we did this without inlining this variable and function, we would be violating order or theone definition rule because this functions and variable, the definitions for them would be showingup in multiple translation units and that would be bad.We would get compiler errors.So marking these guys as inline allows us to set up header files like this.And this is really important for people building header only libraries where everything is going tobe living in the header file.We can mark everything as inline and then we will be able to include that header in whatever CPP filethat we want and thatâ€™s going to be really cool.Now that you know this, weâ€™re going to head over to Visual Studio code and play with this a littlemore.Okay.So here we are in our working folder.The current project is in line variables and functions.Weâ€™re going to grab our template files pretty quick.Weâ€™re going to put them in place and we are going to open this in Visual Studio code.Letâ€™s do that by dragging and dropping here.This is going to give us our main CPP file so we can clean up a little bit and weâ€™re going to set upthe same scenario we had in the slides.So weâ€™re going to set up two files.Weâ€™re going to have utility one dot CPP and weâ€™re going to have utility two dot CPP inside utility one,weâ€™re going to have the code we had exactly in the slides.We have an age variable, we have some function which is going to print our age and print its address.But.We want to have exactly the same thing in utility too.So if we try and compile this program, this is not going to go well because now we have the definitionof this variable and this function twice in this program.So letâ€™s try and even compile this without using it in main and see if we get a problem.So letâ€™s world with GCC and weâ€™re going to see that we have a problem.And the problem is going to be that we have multiple definitions for our function, which is some function.We also have multiple definitions for our age variable.If we hunt this down through this output, weâ€™re going to see that we have multiple definitions forage and this is bad.So if you want to be able to do something like this, you would mark these guys as inline and it isreally easy.You go in front of each variable or function, you say inline and weâ€™re going to do the same thing.We do this in utility one.Weâ€™re going to also do the same thing in utility.Two, letâ€™s do the same for our function here and now.If we compile our program, weâ€™re going to see that it is going to work.Letâ€™s do this.Weâ€™re going to build with GCC.Now, the compiler knows that even if these guys are showing up twice in our program, each one is goingto be confined to its own translation unit.So h here is confined to utility one.Some function here is confined to utility one, and the same thing is true for utility.Two This age is confined to utility two and this function here is confined to utility two here and theyare not going to conflict with each other.So one thing you should know is that for this to work, this variable and this functions have to haveexactly the same signature.For example, for the function here, we canâ€™t be returning double and in utility one to be returningvoid, they have to be the same for this kind of inlining to work.And this requirement is in place because the compiler is going to unify these guys.So this age we have in utility one is going to be exactly the same as the age we have in utility two.And if we try to print their addresses, weâ€™re going to see that they are exactly the same addresses.So letâ€™s go and our utility one and put in a function that is going to call some function here becausewe canâ€™t really call this function from the outside.And letâ€™s show you this.Letâ€™s go in main and try and call it.Weâ€™re going to go there and say void some function.Weâ€™re going to declare it.And if we go in main and call it, weâ€™re going to say some function.Weâ€™re going to see that the compiler is going to say, this function is undefined.I donâ€™t know what this thing is because functions in utility one and utility two are inaccessible forany other translation unit.So we are trying to use these guys from the main translation unit and these functions are confined boundto the translation units utility one and utility two.So we canâ€™t use them from main here and weâ€™re going to get a compiler error.Letâ€™s do that.Weâ€™re going to build with GCC and weâ€™re going to see build finished with errors and weâ€™re going to seeundefined reference to some function here because this function is inaccessible from the main translationunit.So you should really know this, but we can still go in there and set up other functions.Weâ€™re going to say print H, utility one, letâ€™s do that.And this is going to call some function.We can do this because this function is going to be accessible from the outside, but because it isin this translation unit, it can call things that are internal to this translation unit.So to make this super clear, we are going to head over in this print edge utility function, say thatwe are printing from utility one.Weâ€™re going to do that.This is going to make things super clear and weâ€™re going to go down and say Stdcout to give ourselvessome space.Weâ€™re going to go in the utility to file and do the same thing.So weâ€™re going to put up a function which is going to call some function, but this is going to be printage from utility two.So weâ€™re going to say that here and weâ€™re going to say that right here and weâ€™re going to see that thecompiler is going to unify this.Some function calls.Again, the implementations for these things have to be the same.Something you inline, it has to be exactly the same from utility one and utility two.And we can see that they are the same.What we have in utility one is exactly the same thing we have in utility two.So this is a strong requirement because the compiler is going to unify these two guys.So they have to be exactly the same.Now that we have this, we can head over to the main function and delete whatever we had in there weâ€™regoing to grab our definition for.Print edge utility function here.Letâ€™s grab it.Weâ€™re going to use it in a minute.Weâ€™re going to delete the declaration here because it is useless at this point.And weâ€™re going to put a declaration here for utility one.Weâ€™re going to grab this and copy and paste it to have utility two.And we can call this function.Now we can say print H from utility one and print H from utility two.Thatâ€™s what we want here.And if we build and run this program, weâ€™re going to see that the build is going to be good.Letâ€™s do this.You see build finished successfully.We can clear and run Rooster.Now we see that if we print from utility one, weâ€™re going to see H 12 and the H variable is going tobe leaving at this address ending in 0E0.Weâ€™re going to see that what we have in utility two is exactly the same.So the compiler has really unified these definitions that we have in utility one and utility two andvariables and functions we have in this translation unit, for example, H and some function here arethe same thing from the perspective of how things are represented in memory.So this is the benefit of inlining your variables and functions.They are going to be unified and in memory youâ€™re going to be basically manipulating the same thing.But from the perspective of your code, each definition is going to be confined to its own translationunit, and this can come in handy in many situations.Now that we know this, weâ€™re going to see why we would need something like this.What weâ€™re going to do is set up another utility file.I think I should close this thing.Open editors, because this is confusing me.I am going to add another file.I am going to call it utility dot H, and inside I am going to put in a piece of code I have preparedbefore.So this is going to have an inline variable called threshold and the function is going to add up a condition.So if A and B are greater than our threshold, weâ€™re going to return the sum.Else weâ€™re going to return our threshold here.Suppose this is something meaningful for your application and you want this code to live in a headerfile so that you can include it in other translation units.So what we would have here is a problem.For example, if these guys are not in line, weâ€™re going to remove this keyword here.And for example, we want in the main function and included utility one or utility, you can do that.And weâ€™re going to go, for example, in our utility one translation unit and also include utility andtry to compile our code.We can do this.Weâ€™re going to try and word this with GCC like we always do.Weâ€™re going to have a problem.So you see, we have a problem here and it is saying read multiple definitions for the Add functionand where is this coming from?Well, we have a function here and we have a variable.We have the Add function.We have this variable.This is a definition.You have to remember this.And what we have down here is also a definition.But we are including this file in multiple translation units.So what we have in our utility header is going to show up in whichever translation unit where we includethat.So in our main CPP file, weâ€™re going to have our variable and function.And in utility one dot CPP weâ€™re going to have the exact same thing.So these things are going to be included in multiple translation units and this is going to violatethe one definition rule and we can solve this problem by marking them as inline.And this is really cool.So we can make this thing usable and still have the flexibility of implementing our things in a headerfile.This is really important for header file only libraries and this is really cool.So now that these guys are in line, we can build our program and youâ€™re going to see that it is goingto work.And this is really cool.For example, you can head over in the main function and use the add function here if you wanted.If you wanted to use that in utility one, you could use it and this wonâ€™t be a problem.This is how inlining your variables and function can really come in handy.This is really all I wanted you to see in this lecture.I hope you found it interesting.We are going to stop here in this lecture and the next one weâ€™re going to try and compare the inliningwe just learned about in this lecture to things that have internal linkage.Think about a function that you have prefixed with the static keyword or a function that has been wrappedinside an anonymous namespace like we have seen before.For.And we are going to compare these things and see how they are different.So go ahead and finish up here and meet me in the next lecture.</p>
<hr>
<h2 id="ğŸ¤–-Assistant"><a href="#ğŸ¤–-Assistant" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>C++ å†…è”å˜é‡ä¸å‡½æ•°ï¼šæ·±å…¥ç†è§£ One Definition Rule (ODR) ä¸ä»£ç å¤ç”¨</p>
<p><strong>è¯¾ç¨‹æ¦‚è¿°ï¼š</strong><br>æœ¬è¯¾ç¨‹å°†æ·±å…¥æ¢è®¨ C++ ä¸­çš„å†…è” [inline] å˜é‡ [variables] å’Œå†…è”å‡½æ•° [functions]ã€‚æˆ‘ä»¬å°†äº†è§£å®ƒä»¬å¦‚ä½•å¸®åŠ©æˆ‘ä»¬åº”å¯¹ C++ çš„â€œå•ä¸€å®šä¹‰è§„åˆ™â€ [One Definition Rule (ODR)]ï¼Œä»è€Œå…è®¸åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒ [translation units] ä¸­æ”¾ç½®ç›¸åŒçš„å®šä¹‰ï¼ŒåŒæ—¶é¿å…é“¾æ¥é”™è¯¯ [linker errors]ã€‚</p>
<hr>
<h2 id="1-å¼•è¨€ï¼šå•ä¸€å®šä¹‰è§„åˆ™-ODR"><a href="#1-å¼•è¨€ï¼šå•ä¸€å®šä¹‰è§„åˆ™-ODR" class="headerlink" title="1. å¼•è¨€ï¼šå•ä¸€å®šä¹‰è§„åˆ™ (ODR)"></a>1. å¼•è¨€ï¼šå•ä¸€å®šä¹‰è§„åˆ™ (ODR)</h2><p>åœ¨æ·±å…¥äº†è§£ <code>inline</code> ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£ C++ ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„è§„åˆ™ï¼š<strong>å•ä¸€å®šä¹‰è§„åˆ™ (One Definition Rule, ODR)</strong>ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯ ODRï¼Ÿ</strong><br>ODR è§„å®šï¼šåœ¨ C++ ç¨‹åºä¸­ï¼Œä»»ä½•å˜é‡ã€å‡½æ•°ã€ç±»æˆ–æšä¸¾ç±»å‹éƒ½å¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ªå®šä¹‰ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªç¨‹åºä¸­ï¼Œæ— è®ºæ˜¯åŒä¸€ä¸ªæ–‡ä»¶å†…è¿˜æ˜¯è·¨å¤šä¸ªæ–‡ä»¶ï¼Œä¸ºåŒä¸€ä¸ªåå­—æä¾›äº†ä¸¤ä¸ªæˆ–æ›´å¤šå®šä¹‰ï¼Œä½ å°±ä¼šè¿å ODRã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆ ODR å¦‚æ­¤é‡è¦ï¼Ÿ</strong><br>ODR æ˜¯ C++ ç¼–è¯‘å’Œé“¾æ¥æ¨¡å‹çš„åŸºç¡€ã€‚å®ƒç¡®ä¿äº†ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨åœ¨æ„å»ºæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œä¸ä¼šå› ä¸ºå¯¹åŒä¸€ä¸ªå®ä½“ï¼ˆæ¯”å¦‚ä¸€ä¸ªå˜é‡æˆ–ä¸€ä¸ªå‡½æ•°ï¼‰å­˜åœ¨å¤šä»½ä¸åŒçš„å®šä¹‰è€Œæ„Ÿåˆ°å›°æƒ‘ã€‚å¦‚æœå…è®¸éšæ„æœ‰å¤šä¸ªå®šä¹‰ï¼Œé‚£ä¹ˆå½“ç¨‹åºè¿è¡Œæ—¶ï¼Œå®ƒå°†ä¸çŸ¥é“åº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªï¼Œè¿™ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºç”šè‡³å´©æºƒã€‚</p>
<p><strong>è¿å ODR ä¼šå¯¼è‡´ä»€ä¹ˆï¼Ÿ</strong><br>è¿å ODR é€šå¸¸ä¼šå¯¼è‡´ä¸¤ç§é”™è¯¯ï¼š</p>
<ol>
<li><strong>ç¼–è¯‘é”™è¯¯ [Compiler Error]</strong>ï¼šå¦‚æœä½ åœ¨åŒä¸€ä¸ªç¿»è¯‘å•å…ƒï¼ˆå³åŒä¸€ä¸ª <code>.cpp</code> æ–‡ä»¶æˆ–è¢«è¯¥ <code>.cpp</code> æ–‡ä»¶åŒ…å«çš„å¤´æ–‡ä»¶åœ¨å±•å¼€åï¼‰ä¸­å¤šæ¬¡å®šä¹‰äº†åŒä¸€ä¸ªå®ä½“ï¼Œç¼–è¯‘å™¨ä¼šç«‹å³æŠ¥é”™ã€‚</li>
<li><strong>é“¾æ¥é”™è¯¯ [Linker Error]</strong>ï¼šå¦‚æœä½ åœ¨ä¸åŒçš„ç¿»è¯‘å•å…ƒä¸­å®šä¹‰äº†åŒä¸€ä¸ªå…·æœ‰å¤–éƒ¨é“¾æ¥ [external linkage] çš„å®ä½“ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¸ä¼šæŠ¥é”™ï¼Œä½†å½“é“¾æ¥å™¨ [linker] è¯•å›¾å°†è¿™äº›ç¿»è¯‘å•å…ƒåˆå¹¶æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå®ƒä¼šå‘ç°åŒä¸€ä¸ªåå­—æœ‰å¤šä¸ªå®šä¹‰ï¼Œä»è€ŒæŠ¥å‘Šâ€œå¤šé‡å®šä¹‰é”™è¯¯â€ [multiple definition error]ã€‚</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼šODR è¿è§„</strong><br>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæºæ–‡ä»¶ï¼š<code>utility1.cpp</code> å’Œ <code>utility2.cpp</code>ï¼Œå®ƒä»¬éƒ½å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>age</code> çš„å˜é‡å’Œä¸€ä¸ªåä¸º <code>some_function</code> çš„å‡½æ•°ï¼š</p>
<p><strong><code>utility1.cpp</code>:</strong><br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utility1.cpp</span></span><br><span class="line"><span class="keyword">int</span> age = <span class="number">10</span>; <span class="comment">// å®šä¹‰å˜é‡ age</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">some_function</span><span class="params">()</span> </span>&#123; <span class="comment">// å®šä¹‰å‡½æ•° some_function</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p><strong><code>utility2.cpp</code>:</strong><br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utility2.cpp</span></span><br><span class="line"><span class="keyword">int</span> age = <span class="number">20</span>; <span class="comment">// å†æ¬¡å®šä¹‰å˜é‡ age</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">some_function</span><span class="params">()</span> </span>&#123; <span class="comment">// å†æ¬¡å®šä¹‰å‡½æ•° some_function</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>å½“ç¼–è¯‘å™¨åˆ†åˆ«ç¼–è¯‘ <code>utility1.cpp</code> å’Œ <code>utility2.cpp</code> æ—¶ï¼Œå®ƒä»¬ä¼šå„è‡ªç”Ÿæˆä¸€ä¸ªå¯¹è±¡æ–‡ä»¶ï¼ˆ<code>.o</code> æˆ– <code>.obj</code>ï¼‰ã€‚è¿™äº›å¯¹è±¡æ–‡ä»¶ä¸­éƒ½ä¼šåŒ…å« <code>age</code> å’Œ <code>some_function</code> çš„å®šä¹‰ã€‚ç„¶åï¼Œå½“é“¾æ¥å™¨å°è¯•å°†è¿™äº›å¯¹è±¡æ–‡ä»¶è¿æ¥æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå®ƒä¼šå‘ç° <code>age</code> å’Œ <code>some_function</code> è¢«å®šä¹‰äº†ä¸¤æ¬¡ï¼Œè¿™è¿åäº† ODRï¼Œä»è€Œå¯¼è‡´é“¾æ¥é”™è¯¯ã€‚</p>
<h2 id="2-å†…è”-inline-ç™»åœºï¼šODR-çš„â€œä¾‹å¤–â€"><a href="#2-å†…è”-inline-ç™»åœºï¼šODR-çš„â€œä¾‹å¤–â€" class="headerlink" title="2. å†…è” (inline) ç™»åœºï¼šODR çš„â€œä¾‹å¤–â€"></a>2. å†…è” (inline) ç™»åœºï¼šODR çš„â€œä¾‹å¤–â€</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä»‹ç» <code>inline</code> å…³é”®å­—ã€‚å®ƒåœ¨ C++ ä¸­æ‰®æ¼”ç€ä¸€ä¸ªç‰¹æ®Šè§’è‰²ï¼Œå…è®¸æˆ‘ä»¬â€œæ”¾æ¾â€ ODR çš„é™åˆ¶ï¼Œä½†å¹¶éå®Œå…¨æ— è§†å®ƒã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯ <code>inline</code> å…³é”®å­—ï¼Ÿ</strong><br><code>inline</code> æ˜¯ C++ ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œå¯ä»¥ç”¨äºå‡½æ•°å’Œå˜é‡ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ï¼šå³ä½¿åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­å‡ºç°äº†åŒä¸€ä¸ªå‡½æ•°æˆ–å˜é‡çš„å®šä¹‰ï¼Œå®ƒä»¬ä¹Ÿåº”è¯¥è¢«è§†ä¸ºåŒä¸€ä¸ªå®ä½“ï¼Œå¹¶ä¸”æœ€ç»ˆåªç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„è¿è¡Œæ—¶å®ä¾‹ã€‚</p>
<p><strong><code>inline</code> å…³é”®å­—å¦‚ä½•ç”¨äºå˜é‡å’Œå‡½æ•°ï¼Ÿ</strong><br>éå¸¸ç®€å•ï¼Œä½ åªéœ€è¦åœ¨å˜é‡æˆ–å‡½æ•°å®šä¹‰å‰åŠ ä¸Š <code>inline</code> å…³é”®å­—å³å¯ï¼š</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†…è”å˜é‡</span></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">int</span> my_inline_variable = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…è”å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">my_inline_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å‡½æ•°ä½“</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p><strong><code>inline</code> çš„æ ¸å¿ƒä½œç”¨ï¼š</strong><br>å½“ä¸€ä¸ªå˜é‡æˆ–å‡½æ•°è¢«æ ‡è®°ä¸º <code>inline</code> åï¼ŒC++ æ ‡å‡†å…è®¸å®ƒçš„å®šä¹‰å‡ºç°åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­ï¼Œè€Œä¸ä¼šè¿å ODRã€‚ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ä¼šååŒå·¥ä½œï¼Œç¡®ä¿æ‰€æœ‰è¿™äº›å®šä¹‰æœ€ç»ˆéƒ½â€œæŠ˜å â€æˆä¸€ä¸ªå•ä¸€çš„ã€åœ¨å†…å­˜ä¸­ç‹¬ä¸€æ— äºŒçš„å®ä½“ã€‚è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>æ‰€æœ‰å¯¹ <code>inline</code> å˜é‡çš„å¼•ç”¨éƒ½æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä¸ªå˜é‡ã€‚</li>
<li>æ‰€æœ‰å¯¹ <code>inline</code> å‡½æ•°çš„è°ƒç”¨éƒ½æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä¸ªå‡½æ•°å®ç°ã€‚</li>
</ul>
<p><strong>é‡è¦æç¤ºï¼š<code>inline</code> ä¸åªæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ä¼˜åŒ–æç¤º</strong><br>è™½ç„¶ <code>inline</code> è¿™ä¸ªè¯å¬èµ·æ¥åƒæ˜¯è®©ç¼–è¯‘å™¨æŠŠå‡½æ•°ä½“ç›´æ¥æ›¿æ¢åˆ°è°ƒç”¨ç‚¹ï¼ˆè¿™ç§è¡Œä¸ºå«åšå‡½æ•°å†…è”å±•å¼€ [function inlining]ï¼‰ï¼Œå¹¶ä¸”å¯¹äºå‡½æ•°æ¥è¯´ï¼Œå®ƒç¡®å®å¯ä»¥ä½œä¸ºç¼–è¯‘å™¨è¿›è¡Œå†…è”å±•å¼€çš„â€œæç¤ºâ€æˆ–â€œå»ºè®®â€ï¼Œä½†å®ƒçš„<strong>ä¸»è¦ä½œç”¨</strong>åœ¨ C++11 ä»¥åæ˜¯è§£å†³ ODR é—®é¢˜ï¼Œå…è®¸åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­æ”¾ç½®ç›¸åŒçš„å®šä¹‰ã€‚å¯¹äºå˜é‡ï¼Œ<code>inline</code> æ›´æ˜¯ä¸å†…è”å±•å¼€å®Œå…¨æ— å…³ï¼Œå®ƒçº¯ç²¹æ˜¯ä¸ºäº† ODRã€‚ç¼–è¯‘å™¨æ˜¯å¦çœŸæ­£è¿›è¡Œå†…è”å±•å¼€ï¼Œå–å†³äºå®ƒçš„ä¼˜åŒ–ç­–ç•¥ï¼Œå³ä½¿æ²¡æœ‰ <code>inline</code> å…³é”®å­—ï¼Œç¼–è¯‘å™¨ä¹Ÿå¯èƒ½è¿›è¡Œå†…è”å±•å¼€ã€‚</p>
<h2 id="3-å†…è”å˜é‡"><a href="#3-å†…è”å˜é‡" class="headerlink" title="3. å†…è”å˜é‡"></a>3. å†…è”å˜é‡</h2><p>C++17 å¼•å…¥äº† <code>inline</code> å˜é‡ï¼Œè¿™ä½¿å¾—åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰å…·æœ‰å¤–éƒ¨é“¾æ¥çš„å˜é‡å˜å¾—å®‰å…¨ã€‚</p>
<ul>
<li><strong>è¯­æ³•</strong>ï¼šåœ¨å˜é‡å®šä¹‰å‰åŠ ä¸Š <code>inline</code> å…³é”®å­—ã€‚<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡è®¾åœ¨ my_globals.h å¤´æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">int</span> global_counter = <span class="number">0</span>;</span><br></pre></td></tr></table></figure></div></li>
<li><strong>ä½œç”¨</strong>ï¼šå½“ä½ å°† <code>inline int global_counter = 0;</code> æ”¾åœ¨ä¸€ä¸ªå¤´æ–‡ä»¶ä¸­ï¼Œç„¶åè¿™ä¸ªå¤´æ–‡ä»¶è¢«å¤šä¸ª <code>.cpp</code> æ–‡ä»¶åŒ…å«æ—¶ï¼Œæ¯ä¸ª <code>.cpp</code> æ–‡ä»¶éƒ½ä¼šçœ‹åˆ° <code>global_counter</code> çš„å®šä¹‰ã€‚å¦‚æœæ²¡æœ‰ <code>inline</code>ï¼Œè¿™ä¼šç«‹å³å¯¼è‡´é“¾æ¥å™¨é”™è¯¯ã€‚ä½†æœ‰äº† <code>inline</code>ï¼Œé“¾æ¥å™¨ä¼šçŸ¥é“æ‰€æœ‰è¿™äº›å®šä¹‰éƒ½æŒ‡çš„æ˜¯åŒä¸€ä¸ª <code>global_counter</code> å˜é‡ï¼Œå¹¶ç¡®ä¿åœ¨æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­åªæœ‰ä¸€ä¸ª <code>global_counter</code> å®ä¾‹ï¼Œæ‰€æœ‰å¯¹å®ƒçš„è¯»å†™æ“ä½œéƒ½ä½œç”¨äºåŒä¸€ä¸ªå†…å­˜åœ°å€ã€‚</li>
<li><strong>ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</strong> åœ¨ C++17 ä¹‹å‰ï¼Œå¦‚æœä½ æƒ³åœ¨å¤šä¸ªæºæ–‡ä»¶ä¸­å…±äº«ä¸€ä¸ªå¯ä¿®æ”¹çš„å…¨å±€å˜é‡ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åœ¨ä¸€ä¸ª <code>.cpp</code> æ–‡ä»¶ä¸­å®šä¹‰å®ƒï¼Œå¹¶åœ¨å¤´æ–‡ä»¶ä¸­ä½¿ç”¨ <code>extern</code> å…³é”®å­—å£°æ˜å®ƒã€‚<code>inline</code> å˜é‡æä¾›äº†ä¸€ç§æ›´ç®€æ´çš„æ–¹å¼ï¼Œå…è®¸ä½ åœ¨å¤´æ–‡ä»¶ä¸­ç›´æ¥å®šä¹‰å®ƒï¼Œå°¤å…¶é€‚ç”¨äºé‚£äº›å¸Œæœ›æ„å»ºâ€œä»…å¤´æ–‡ä»¶åº“â€ [header-only libraries] çš„åœºæ™¯ã€‚</li>
</ul>
<h2 id="4-å†…è”å‡½æ•°"><a href="#4-å†…è”å‡½æ•°" class="headerlink" title="4. å†…è”å‡½æ•°"></a>4. å†…è”å‡½æ•°</h2><p>å†…è”å‡½æ•°æ˜¯ C++ ä¸­æ›´æ—©å¼•å…¥çš„ <code>inline</code> æœºåˆ¶ã€‚</p>
<ul>
<li><strong>è¯­æ³•</strong>ï¼šåœ¨å‡½æ•°å®šä¹‰å‰åŠ ä¸Š <code>inline</code> å…³é”®å­—ã€‚<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡è®¾åœ¨ my_utils.h å¤´æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">print_message</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* msg)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; msg &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li><strong>ä½œç”¨</strong>ï¼šä¸å†…è”å˜é‡ç±»ä¼¼ï¼Œå½“ä½ å°† <code>inline void print_message(...) { ... }</code> æ”¾åœ¨ä¸€ä¸ªå¤´æ–‡ä»¶ä¸­ï¼Œç„¶åè¿™ä¸ªå¤´æ–‡ä»¶è¢«å¤šä¸ª <code>.cpp</code> æ–‡ä»¶åŒ…å«æ—¶ï¼Œæ¯ä¸ª <code>.cpp</code> æ–‡ä»¶éƒ½ä¼šçœ‹åˆ° <code>print_message</code> çš„å®šä¹‰ã€‚å¦‚æœæ²¡æœ‰ <code>inline</code>ï¼Œè¿™å°†å¯¼è‡´é“¾æ¥å™¨é”™è¯¯ã€‚æœ‰äº† <code>inline</code>ï¼Œé“¾æ¥å™¨ä¼šç¡®ä¿æ‰€æœ‰è¿™äº›å®šä¹‰éƒ½æŒ‡çš„æ˜¯åŒä¸€ä¸ª <code>print_message</code> å‡½æ•°ï¼Œå¹¶ç¡®ä¿åœ¨æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­åªæœ‰ä¸€ä¸ª <code>print_message</code> å‡½æ•°çš„å®ç°ã€‚</li>
<li><strong>ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</strong> ä¸»è¦ç”¨äºå°†å°å‹ã€å¸¸ç”¨çš„å‡½æ•°å®šä¹‰ç›´æ¥æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ã€‚è¿™å¯¹äºæ¨¡æ¿å‡½æ•° [template functions] æ¥è¯´æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œå› ä¸ºæ¨¡æ¿å‡½æ•°å¿…é¡»åœ¨è¢«ä½¿ç”¨çš„ç¿»è¯‘å•å…ƒä¸­å¯è§å…¶å®Œæ•´å®šä¹‰ã€‚å¯¹äºéæ¨¡æ¿å‡½æ•°ï¼Œ<code>inline</code> å…è®¸ä½ å°†å‡½æ•°å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œè€Œä¸ä¼šå¼•èµ· ODR é—®é¢˜ã€‚</li>
</ul>
<h2 id="5-inline-çš„é‡è¦ç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹"><a href="#5-inline-çš„é‡è¦ç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹" class="headerlink" title="5. inline çš„é‡è¦ç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹"></a>5. <code>inline</code> çš„é‡è¦ç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹</h2><p>ä¸ºäº†æ­£ç¡®ä½¿ç”¨ <code>inline</code>ï¼Œä½ éœ€è¦ç‰¢è®°ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li><p><strong>å®šä¹‰å¿…é¡»å®Œå…¨ä¸€è‡´ [Identical Definitions]</strong>ï¼š<br>è¿™æ˜¯ <code>inline</code> å·¥ä½œçš„æ ¸å¿ƒå‰æã€‚å¦‚æœåœ¨ä¸åŒçš„ç¿»è¯‘å•å…ƒä¸­ï¼ŒåŒä¸€ä¸ª <code>inline</code> å˜é‡æˆ–å‡½æ•°çš„å®šä¹‰å†…å®¹ä¸å®Œå…¨ç›¸åŒï¼Œç¨‹åºçš„è¡Œä¸ºå°†æ˜¯æœªå®šä¹‰ [undefined behavior] çš„ã€‚è¿™æ„å‘³ç€ä½ å¯èƒ½ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œç”šè‡³ç¨‹åºå´©æºƒã€‚ç¼–è¯‘å™¨é€šå¸¸ä¸ä¼šå¯¹æ­¤å‘å‡ºè­¦å‘Šæˆ–é”™è¯¯ï¼Œå› ä¸ºå®ƒä»¬å‡è®¾ä½ ä¼šéµå¾ªè¿™æ¡è§„åˆ™ã€‚</p>
</li>
<li><p><strong>å¤–éƒ¨é“¾æ¥ [External Linkage]</strong>ï¼š<br><code>inline</code> å˜é‡å’Œå‡½æ•°é»˜è®¤å…·æœ‰å¤–éƒ¨é“¾æ¥ï¼ˆä¸æ™®é€šå…¨å±€å˜é‡å’Œå‡½æ•°ä¸€æ ·ï¼‰ã€‚è¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥åœ¨ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹ï¼ˆé€šè¿‡é€‚å½“çš„å£°æ˜ï¼‰è¢«è®¿é—®ã€‚è¿™ä¸å…·æœ‰å†…éƒ¨é“¾æ¥ [internal linkage] çš„ <code>static</code> å˜é‡æˆ–å‡½æ•°ä¸åŒï¼ˆ<code>static</code> ä¼šåœ¨æ¯ä¸ªç¿»è¯‘å•å…ƒä¸­åˆ›å»ºç‹¬ç«‹çš„å‰¯æœ¬ï¼‰ã€‚</p>
<ul>
<li><strong>æ¾„æ¸…åŸæ–‡æœ¬çš„æ··æ·†ç‚¹</strong>ï¼šåŸæ–‡æœ¬ä¸­æåˆ°â€œage and utility one is only going to be usable in utility oneâ€ï¼Œè¿™å¯èƒ½è®©äººè¯¯è§£ <code>inline</code> èµ‹äºˆäº†å†…éƒ¨é“¾æ¥ã€‚<strong>è¿™æ˜¯ä¸å‡†ç¡®çš„ã€‚</strong> è¿™ç§â€œ confined (å±€é™) â€çš„ç°è±¡ï¼Œä»…ä»…æ˜¯å› ä¸ºä½ åœ¨ <code>utility1.cpp</code> æˆ– <code>utility2.cpp</code> ä¸­å®šä¹‰äº†è¿™äº› <code>inline</code> å®ä½“ï¼Œä½†å¹¶æ²¡æœ‰åœ¨å…¶ä»–åœ°æ–¹ï¼ˆä¾‹å¦‚å…±äº«çš„å¤´æ–‡ä»¶ï¼‰å£°æ˜å®ƒä»¬ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°ï¼ˆå³ä½¿æ˜¯ <code>inline</code> çš„ï¼‰åªåœ¨æŸä¸ª <code>.cpp</code> æ–‡ä»¶ä¸­å®šä¹‰è€Œæ²¡æœ‰åœ¨å…¶ä»–åœ°æ–¹å£°æ˜ï¼Œé‚£ä¹ˆå…¶ä»– <code>.cpp</code> æ–‡ä»¶è‡ªç„¶æ— æ³•ç›´æ¥è°ƒç”¨å®ƒã€‚<code>inline</code> è§£å†³çš„æ˜¯â€œå¤šé‡å®šä¹‰â€çš„é“¾æ¥é”™è¯¯ï¼Œè€Œä¸æ˜¯æ”¹å˜å¤–éƒ¨é“¾æ¥å±æ€§ã€‚å¦‚æœä½ æƒ³åœ¨ <code>main.cpp</code> ä¸­è°ƒç”¨ <code>utility1.cpp</code> ä¸­å®šä¹‰çš„ <code>inline some_function</code>ï¼Œä½ éœ€è¦ç¡®ä¿åœ¨ <code>main.cpp</code> ä¸­èƒ½çœ‹åˆ° <code>some_function</code> çš„å£°æ˜ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡åŒ…å«ä¸€ä¸ªå£°æ˜äº† <code>some_function</code> çš„å¤´æ–‡ä»¶ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>ç»Ÿä¸€æ€§ [Unification]</strong>ï¼š<br>å¦‚å‰æ‰€è¿°ï¼Œç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ä¼šç¡®ä¿æ‰€æœ‰ <code>inline</code> å®šä¹‰æœ€ç»ˆåªç”Ÿæˆä¸€ä¸ªè¿è¡Œæ—¶å®ä½“ã€‚ä½ å¯ä»¥é€šè¿‡æ‰“å° <code>inline</code> å˜é‡çš„åœ°å€æˆ– <code>inline</code> å‡½æ•°çš„åœ°å€æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œä½ ä¼šå‘ç°å®ƒä»¬åœ¨æ‰€æœ‰ç¿»è¯‘å•å…ƒä¸­éƒ½æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ã€‚</p>
</li>
<li><p><strong>æ”¾ç½®ä½ç½®</strong>ï¼š<br><code>inline</code> å˜é‡å’Œå‡½æ•°æœ€å¸¸è¢«å®šä¹‰åœ¨å¤´æ–‡ä»¶ [header files] ä¸­ï¼Œå› ä¸ºè¿™æ ·å®ƒä»¬å¯ä»¥è¢«å¤šä¸ªæºæ–‡ä»¶å®‰å…¨åœ°åŒ…å«å’Œä½¿ç”¨ï¼Œè€Œä¸ä¼šè§¦å‘ ODR é”™è¯¯ã€‚</p>
</li>
</ol>
<h2 id="6-ä»£ç ç¤ºä¾‹"><a href="#6-ä»£ç ç¤ºä¾‹" class="headerlink" title="6. ä»£ç ç¤ºä¾‹"></a>6. ä»£ç ç¤ºä¾‹</h2><p>è®©æˆ‘ä»¬é€šè¿‡å®é™…ä»£ç æ¥ç†è§£ <code>inline</code> çš„ä½œç”¨ã€‚</p>
<p><strong>åœºæ™¯ä¸€ï¼šè¿å ODR (æ—  <code>inline</code>)</strong></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸ä½¿ç”¨ <code>inline</code> çš„ä¾‹å­ï¼Œå®ƒä¼šå¼•å‘é“¾æ¥é”™è¯¯ã€‚</p>
<p><strong><code>my_variable_and_function.h</code></strong><br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_variable_and_function.h</span></span><br><span class="line"><span class="comment">// è­¦å‘Šï¼šè¿™é‡Œæ”¾ç½®å®šä¹‰æ˜¯é”™è¯¯çš„ï¼Œä¼šå¯¼è‡´ ODR è¿è§„ï¼</span></span><br><span class="line"><span class="keyword">int</span> global_data = <span class="number">100</span>; <span class="comment">// å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">greet</span><span class="params">()</span> </span>&#123;          <span class="comment">// å®šä¹‰ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello from greet! Global data: "</span> &lt;&lt; global_data &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p><strong><code>source1.cpp</code></strong><br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// source1.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"my_variable_and_function.h"</span> <span class="comment">// åŒ…å«å®šä¹‰</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_something_in_source1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"In source1: "</span>;</span><br><span class="line">    greet();</span><br><span class="line">    global_data++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p><strong><code>source2.cpp</code></strong><br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// source2.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"my_variable_and_function.h"</span> <span class="comment">// å†æ¬¡åŒ…å«å®šä¹‰</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_something_in_source2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"In source2: "</span>;</span><br><span class="line">    greet();</span><br><span class="line">    global_data += <span class="number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p><strong><code>main.cpp</code></strong><br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"my_variable_and_function.h"</span> <span class="comment">// å†æ¬¡åŒ…å«å®šä¹‰</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜å¤–éƒ¨å‡½æ•°ï¼Œä½¿å¾— main å¯ä»¥è°ƒç”¨å®ƒä»¬</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_something_in_source1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_something_in_source2</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Initial global_data: "</span> &lt;&lt; global_data &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    do_something_in_source1();</span><br><span class="line">    do_something_in_source2();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Final global_data: "</span> &lt;&lt; global_data &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p><strong>ç¼–è¯‘å‘½ä»¤ (ä¾‹å¦‚ä½¿ç”¨ g++)ï¼š</strong><br><code>g++ main.cpp source1.cpp source2.cpp -o my_program</code></p>
<p><strong>é¢„æœŸç»“æœï¼š</strong><br>ä½ ä¼šå¾—åˆ°ä¸€ä¸ªé“¾æ¥é”™è¯¯ï¼Œç±»ä¼¼ <code>multiple definition of &#39;global_data&#39;</code> å’Œ <code>multiple definition of &#39;greet()&#39;</code>ã€‚è¿™æ˜¯å› ä¸º <code>global_data</code> å’Œ <code>greet()</code> çš„å®šä¹‰è¢«åŒ…å«è¿›äº† <code>main.cpp</code>ã€<code>source1.cpp</code> å’Œ <code>source2.cpp</code> è¿™ä¸‰ä¸ªä¸åŒçš„ç¿»è¯‘å•å…ƒã€‚</p>
<hr>
<p><strong>åœºæ™¯äºŒï¼šä½¿ç”¨ <code>inline</code> è§£å†³ ODR è¿è§„</strong></p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¿®æ”¹ <code>my_variable_and_function.h</code>ï¼Œæ·»åŠ  <code>inline</code> å…³é”®å­—ã€‚</p>
<p><strong><code>my_variable_and_function.h</code> (å·²ä¿®æ”¹)</strong><br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_variable_and_function.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ inline å…³é”®å­—ï¼Œå…è®¸åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­å®šä¹‰</span></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">int</span> global_data = <span class="number">100</span>; <span class="comment">// å†…è”å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">()</span> </span>&#123;          <span class="comment">// å†…è”å‡½æ•°</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello from greet! Global data: "</span> &lt;&lt; global_data &lt;&lt; <span class="string">" (Address: "</span> &lt;&lt; &amp;global_data &lt;&lt; <span class="string">")"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><br><code>source1.cpp</code>, <code>source2.cpp</code>, <code>main.cpp</code> ä¿æŒä¸å˜ã€‚</p>
<p><strong>ç¼–è¯‘å‘½ä»¤ï¼š</strong><br><code>g++ main.cpp source1.cpp source2.cpp -o my_program</code></p>
<p><strong>é¢„æœŸç»“æœï¼š</strong><br>è¿™æ¬¡ï¼Œç¨‹åºä¼šæˆåŠŸç¼–è¯‘å’Œé“¾æ¥ï¼è¿è¡Œ <code>my_program</code>ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Initial global_data: 100</span><br><span class="line">In source1: Hello from greet! Global data: 100 (Address: 0x...)</span><br><span class="line">In source2: Hello from greet! Global data: 101 (Address: 0x...)</span><br><span class="line">Final global_data: 106</span><br></pre></td></tr></table></figure></div>
<p><strong>è§‚å¯Ÿä¸åˆ†æï¼š</strong></p>
<ul>
<li>ç¨‹åºæˆåŠŸç¼–è¯‘å’Œè¿è¡Œï¼Œè¯æ˜ <code>inline</code> å…³é”®å­—è§£å†³äº† ODR è¿è§„é—®é¢˜ã€‚</li>
<li>æ¯æ¬¡è°ƒç”¨ <code>greet()</code> æ—¶ï¼Œå®ƒä¼šæ‰“å° <code>global_data</code> çš„å½“å‰å€¼ã€‚</li>
<li>æœ€é‡è¦çš„æ˜¯ï¼Œ<code>global_data</code> çš„åœ°å€åœ¨æ‰€æœ‰è¾“å‡ºä¸­éƒ½æ˜¯ç›¸åŒçš„ (<code>0x...</code>)ã€‚è¿™è¯æ˜äº†å³ä½¿ <code>global_data</code> çš„å®šä¹‰å‡ºç°åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­ï¼Œå®ƒä»¬ä¹Ÿæœ€ç»ˆç»Ÿä¸€æˆäº†å†…å­˜ä¸­çš„åŒä¸€ä¸ªå˜é‡ã€‚å¯¹ <code>global_data</code> çš„ä¿®æ”¹ï¼ˆ<code>global_data++</code> å’Œ <code>global_data += 5</code>ï¼‰æ˜¯ç´¯ç§¯çš„ï¼Œè¿™è¿›ä¸€æ­¥å°è¯äº†å®ƒä»¬æŒ‡å‘åŒä¸€ä¸ªå®ä½“ã€‚</li>
</ul>
<h2 id="7-QA-é—ªå¡-QA-Flash-Cards"><a href="#7-QA-é—ªå¡-QA-Flash-Cards" class="headerlink" title="7. QA é—ªå¡ (QA Flash Cards)"></a>7. QA é—ªå¡ (QA Flash Cards)</h2><ol>
<li><p><strong>Q:</strong> C++ ä¸­çš„å•ä¸€å®šä¹‰è§„åˆ™ (ODR) æ˜¯ä»€ä¹ˆï¼Ÿ<br><strong>A:</strong> ODR è§„å®šï¼Œåœ¨ C++ ç¨‹åºä¸­ï¼Œä»»ä½•å˜é‡ã€å‡½æ•°ã€ç±»æˆ–æšä¸¾ç±»å‹éƒ½å¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ªå®šä¹‰ã€‚</p>
</li>
<li><p><strong>Q:</strong> è¿å ODR ä¼šå¯¼è‡´ä»€ä¹ˆç±»å‹çš„é”™è¯¯ï¼Ÿ<br><strong>A:</strong> é€šå¸¸ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼ˆåœ¨åŒä¸€ä¸ªç¿»è¯‘å•å…ƒå†…å¤šé‡å®šä¹‰ï¼‰æˆ–é“¾æ¥é”™è¯¯ï¼ˆåœ¨ä¸åŒç¿»è¯‘å•å…ƒå†…å¤šé‡å®šä¹‰ï¼‰ã€‚</p>
</li>
<li><p><strong>Q:</strong> <code>inline</code> å…³é”®å­—çš„ä¸»è¦ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ<br><strong>A:</strong> å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯æ”¾æ¾ ODRï¼Œå…è®¸åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­æ‹¥æœ‰ç›¸åŒçš„å˜é‡æˆ–å‡½æ•°çš„å®šä¹‰ï¼ŒåŒæ—¶ç¡®ä¿åœ¨æœ€ç»ˆç¨‹åºä¸­å®ƒä»¬ç»Ÿä¸€ä¸ºå•ä¸ªå®ä½“ã€‚</p>
</li>
<li><p><strong>Q:</strong> <code>inline</code> å…³é”®å­—å¯¹äºå‡½æ•°æ¥è¯´ï¼Œæ˜¯å¦å¼ºåˆ¶ç¼–è¯‘å™¨è¿›è¡Œå‡½æ•°å†…è”å±•å¼€ï¼Ÿ<br><strong>A:</strong> ä¸ï¼Œ<code>inline</code> ä»…ä»…æ˜¯å‘ç¼–è¯‘å™¨å‘å‡ºçš„ä¸€ä¸ªâ€œæç¤ºâ€æˆ–â€œå»ºè®®â€ï¼Œæ˜¯å¦çœŸæ­£è¿›è¡Œå†…è”å±•å¼€ç”±ç¼–è¯‘å™¨å†³å®šã€‚å®ƒæ›´ä¸»è¦çš„ä½œç”¨æ˜¯è§£å†³ ODRã€‚</p>
</li>
<li><p><strong>Q:</strong> å¦‚æœåœ¨ä¸åŒçš„ç¿»è¯‘å•å…ƒä¸­ï¼ŒåŒä¸€ä¸ª <code>inline</code> å‡½æ•°æˆ–å˜é‡çš„å®šä¹‰ä¸ä¸€è‡´ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ<br><strong>A:</strong> ç¨‹åºçš„è¡Œä¸ºå°†æ˜¯æœªå®šä¹‰ (Undefined Behavior)ã€‚è¿™æ„å‘³ç€ä½ å¯èƒ½ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œç”šè‡³ç¨‹åºå´©æºƒã€‚</p>
</li>
<li><p><strong>Q:</strong> <code>inline</code> å˜é‡æˆ–å‡½æ•°æ˜¯å¦å…·æœ‰å†…éƒ¨é“¾æ¥ [internal linkage]ï¼Ÿ<br><strong>A:</strong> ä¸ï¼Œ<code>inline</code> å˜é‡å’Œå‡½æ•°é€šå¸¸å…·æœ‰å¤–éƒ¨é“¾æ¥ [external linkage]ã€‚å®ƒä»¬å¯ä»¥è¢«ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹ï¼ˆé€šè¿‡é€‚å½“çš„å£°æ˜ï¼‰è®¿é—®ã€‚</p>
</li>
<li><p><strong>Q:</strong> ä¸ºä»€ä¹ˆ <code>inline</code> å˜é‡å’Œå‡½æ•°å¸¸å¸¸å®šä¹‰åœ¨å¤´æ–‡ä»¶ [header files] ä¸­ï¼Ÿ<br><strong>A:</strong> å› ä¸ºå°†å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿å¾—å¤šä¸ªæºæ–‡ä»¶å®‰å…¨åœ°åŒ…å«å’Œä½¿ç”¨è¿™äº›å®šä¹‰ï¼Œè€Œä¸ä¼šè§¦å‘ ODR é”™è¯¯ã€‚è¿™å¯¹äºæ„å»ºâ€œä»…å¤´æ–‡ä»¶åº“â€ [header-only libraries] éå¸¸é‡è¦ã€‚</p>
</li>
</ol>
<h2 id="8-å¸¸è§è¯¯è§£ä¸é”™è¯¯"><a href="#8-å¸¸è§è¯¯è§£ä¸é”™è¯¯" class="headerlink" title="8. å¸¸è§è¯¯è§£ä¸é”™è¯¯"></a>8. å¸¸è§è¯¯è§£ä¸é”™è¯¯</h2><ol>
<li><p><strong>è¯¯è§£ï¼š<code>inline</code> æ€»æ˜¯æ„å‘³ç€å‡½æ•°ä¼šè¢«ç¼–è¯‘å™¨å†…è”å±•å¼€ã€‚</strong><br><strong>çº æ­£ï¼š</strong> è¿™æ˜¯æœ€å¸¸è§çš„è¯¯è§£ã€‚<code>inline</code> çš„ä¸»è¦è¯­ä¹‰æ˜¯è§£å†³ ODRï¼Œå³å…è®¸åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­æ”¾ç½®ç›¸åŒçš„å®šä¹‰ã€‚å¯¹äºå‡½æ•°è€Œè¨€ï¼Œå®ƒç¡®å®ç»™ç¼–è¯‘å™¨ä¸€ä¸ªå†…è”å±•å¼€çš„â€œæç¤ºâ€ï¼Œä½†ç¼–è¯‘å™¨æœ‰æƒå¿½ç•¥è¿™ä¸ªæç¤ºï¼Œæ˜¯å¦å†…è”å±•å¼€æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–å†³å®šçš„ã€‚è€Œå¯¹äºå˜é‡ï¼Œ<code>inline</code> ä¸å†…è”å±•å¼€æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚</p>
</li>
<li><p><strong>è¯¯è§£ï¼š<code>inline</code> ä¼šèµ‹äºˆå˜é‡æˆ–å‡½æ•°å†…éƒ¨é“¾æ¥ã€‚</strong><br><strong>çº æ­£ï¼š</strong> è¿™æ˜¯å¦ä¸€ä¸ªå¸¸è§çš„è¯¯è§£ã€‚<code>inline</code> å˜é‡å’Œå‡½æ•°é»˜è®¤å…·æœ‰å¤–éƒ¨é“¾æ¥ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥è¢«ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹ï¼ˆé€šè¿‡é€‚å½“çš„å£°æ˜ï¼‰è®¿é—®ã€‚è¿™ä¸ <code>static</code> å…³é”®å­—ä¸åŒï¼Œ<code>static</code> æ‰æ˜¯èµ‹äºˆå†…éƒ¨é“¾æ¥ï¼Œå¯¼è‡´æ¯ä¸ªç¿»è¯‘å•å…ƒéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å‰¯æœ¬ã€‚<code>inline</code> çš„ç›®æ ‡æ˜¯ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä½“ã€‚</p>
</li>
<li><p><strong>è¯¯è§£ï¼šä¸åŒç¿»è¯‘å•å…ƒä¸­çš„ <code>inline</code> å®šä¹‰å¯ä»¥ä¸ä¸€è‡´ã€‚</strong><br><strong>çº æ­£ï¼š</strong> è¿™æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„é”™è¯¯ï¼C++ æ ‡å‡†æ˜ç¡®è§„å®šï¼ŒåŒä¸€ä¸ª <code>inline</code> å˜é‡æˆ–å‡½æ•°åœ¨æ‰€æœ‰ç¿»è¯‘å•å…ƒä¸­çš„å®šä¹‰å¿…é¡»æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚å¦‚æœå®ƒä»¬ä¸ä¸€è‡´ï¼Œç¨‹åºè¡Œä¸ºæ˜¯æœªå®šä¹‰ [undefined behavior] çš„ã€‚è¿™æ„å‘³ç€ä½ å¯èƒ½ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œç¨‹åºå´©æºƒï¼Œæˆ–è€…åœ¨æŸäº›å¹³å°ä¸Šèƒ½è¿è¡Œä½†æ¢ä¸ªå¹³å°å°±ä¸è¡Œã€‚</p>
</li>
<li><p><strong>è¯¯è§£ï¼šåªè¦å‡½æ•°æˆ–å˜é‡è¢«æ ‡è®°ä¸º <code>inline</code>ï¼Œå®ƒå°±èƒ½åœ¨ä»»ä½•åœ°æ–¹è¢«ç›´æ¥ä½¿ç”¨ã€‚</strong><br><strong>çº æ­£ï¼š</strong> <code>inline</code> è§£å†³äº† ODR é—®é¢˜ï¼Œä½†å®ƒä¸æ”¹å˜ C++ çš„åŸºæœ¬ä½œç”¨åŸŸå’Œå£°æ˜è§„åˆ™ã€‚å¦‚æœä½ åœ¨ <code>utility.cpp</code> ä¸­å®šä¹‰äº†ä¸€ä¸ª <code>inline</code> å‡½æ•°æˆ–å˜é‡ï¼Œä½†æ²¡æœ‰åœ¨ <code>utility.h</code> æˆ–å…¶ä»–å…±äº«å¤´æ–‡ä»¶ä¸­å£°æ˜å®ƒï¼Œé‚£ä¹ˆå…¶ä»– <code>.cpp</code> æ–‡ä»¶ä»ç„¶æ— æ³•â€œçœ‹åˆ°â€æˆ–ç›´æ¥ä½¿ç”¨å®ƒï¼ˆé™¤éå®ƒä»¬é€šè¿‡æŸç§æ–¹å¼åŒ…å«äº† <code>utility.cpp</code>ï¼Œè¿™é€šå¸¸ä¸æ˜¯å¥½åšæ³•ï¼‰ã€‚è¦è®© <code>inline</code> å®ä½“åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­å¯ç”¨ï¼Œå®ƒä»¬é€šå¸¸éœ€è¦è¢«æ”¾ç½®åœ¨ä¸€ä¸ªå¤´æ–‡ä»¶ä¸­ï¼Œç„¶åè¯¥å¤´æ–‡ä»¶è¢«æ‰€æœ‰éœ€è¦ä½¿ç”¨å®ƒä»¬çš„ <code>.cpp</code> æ–‡ä»¶åŒ…å«ã€‚</p>
</li>
</ol>
<h2 id="9-ç¼–ç¨‹ç»ƒä¹ "><a href="#9-ç¼–ç¨‹ç»ƒä¹ " class="headerlink" title="9. ç¼–ç¨‹ç»ƒä¹ "></a>9. ç¼–ç¨‹ç»ƒä¹ </h2><p><strong>ç»ƒä¹ ç›®æ ‡ï¼š</strong> ç†è§£ <code>inline</code> å˜é‡å’Œå‡½æ•°åœ¨å¤´æ–‡ä»¶ä¸­çš„åº”ç”¨ï¼Œå¹¶éªŒè¯å®ƒä»¬çš„ç»Ÿä¸€æ€§ã€‚</p>
<p><strong>ä»»åŠ¡æè¿°ï¼š</strong></p>
<p>ä½ æœ‰ä¸€ä¸ªåä¸º <code>common_settings.h</code> çš„å¤´æ–‡ä»¶ï¼Œå®ƒå°†åŒ…å«åº”ç”¨ç¨‹åºçš„å…¨å±€è®¾ç½®ã€‚ä½ éœ€è¦åœ¨è¿™ä¸ªå¤´æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªå†…è”å˜é‡å’Œä¸€ä¸ªå†…è”å‡½æ•°ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥åœ¨ <code>main.cpp</code> å’Œ <code>feature.cpp</code> ä¸­å®‰å…¨åœ°ä½¿ç”¨ï¼Œå¹¶éªŒè¯å®ƒä»¬ç¡®å®æ˜¯åŒä¸€ä¸ªå®ä½“ã€‚</p>
<p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>
<ul>
<li><code>common_settings.h</code></li>
<li><code>main.cpp</code></li>
<li><code>feature.cpp</code></li>
</ul>
<p><strong>è¯·å¡«å……ä»¥ä¸‹ä»£ç ä¸­çš„ <code>TODO</code> éƒ¨åˆ†ï¼Œå®Œæˆç»ƒä¹ ï¼š</strong></p>
<p><strong><code>common_settings.h</code></strong><br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once <span class="comment">// é˜²æ­¢å¤´æ–‡ä»¶è¢«é‡å¤åŒ…å«</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO 1: åœ¨æ­¤å¤„å®šä¹‰ä¸€ä¸ªåä¸º `APP_VERSION` çš„å†…è”å¸¸é‡å­—ç¬¦ä¸²å˜é‡ï¼Œåˆå§‹å€¼ä¸º "1.0.0"ã€‚</span></span><br><span class="line"><span class="comment">// ç¡®ä¿å®ƒå¯ä»¥åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­å®‰å…¨åœ°è¢«å®šä¹‰å’Œä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment">// æç¤ºï¼šC++17 åçš„ inline å˜é‡è¯­æ³•ã€‚</span></span><br><span class="line"><span class="comment">// ä¾‹å¦‚ï¼šinline const std::string APP_VERSION = "1.0.0";</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO 2: åœ¨æ­¤å¤„å®šä¹‰ä¸€ä¸ªåä¸º `log_message` çš„å†…è”å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">// è¯¥å‡½æ•°æ¥å—ä¸€ä¸ª const std::string&amp; å‚æ•° `message`ï¼Œå¹¶æ‰“å°å®ƒã€‚</span></span><br><span class="line"><span class="comment">// ç¡®ä¿è¯¥å‡½æ•°å¯ä»¥åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­å®‰å…¨åœ°è¢«å®šä¹‰å’Œä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment">// æç¤ºï¼šinline å‡½æ•°è¯­æ³•ã€‚</span></span><br><span class="line"><span class="comment">// ä¾‹å¦‚ï¼šinline void log_message(const std::string&amp; message) &#123; /* ... */ &#125;</span></span><br></pre></td></tr></table></figure></div></p>
<p><strong><code>feature.cpp</code></strong><br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"common_settings.h"</span> <span class="comment">// åŒ…å«å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">activate_feature</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// TODO 3: åœ¨è¿™é‡Œä½¿ç”¨ common_settings.h ä¸­å®šä¹‰çš„ log_message å‡½æ•°æ‰“å°ä¸€æ¡æ¶ˆæ¯ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ¶ˆæ¯å†…å®¹ä¸ºï¼šâ€œFeature activated. Using version: â€ åŠ ä¸Š APP_VERSIONã€‚</span></span><br><span class="line">    <span class="comment">// å¹¶ä¸”æ‰“å° APP_VERSION å˜é‡çš„å†…å­˜åœ°å€ï¼Œä»¥éªŒè¯å…¶ç»Ÿä¸€æ€§ã€‚</span></span><br><span class="line">    <span class="comment">// ä¾‹å¦‚ï¼šlog_message("...");</span></span><br><span class="line">    <span class="comment">//      std::cout &lt;&lt; "APP_VERSION address in feature.cpp: " &lt;&lt; &amp;APP_VERSION &lt;&lt; std::endl;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p><strong><code>main.cpp</code></strong><br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"common_settings.h"</span> <span class="comment">// åŒ…å«å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜å¤–éƒ¨å‡½æ•°ï¼Œä½¿å¾— main å¯ä»¥è°ƒç”¨å®ƒ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">activate_feature</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// TODO 4: åœ¨ main å‡½æ•°ä¸­ï¼Œé¦–å…ˆæ‰“å° APP_VERSION çš„å½“å‰å€¼å’Œå†…å­˜åœ°å€ã€‚</span></span><br><span class="line">    <span class="comment">// ç„¶åè°ƒç”¨ activate_feature() å‡½æ•°ã€‚</span></span><br><span class="line">    <span class="comment">// å†æ¬¡æ‰“å° APP_VERSION çš„å½“å‰å€¼å’Œå†…å­˜åœ°å€ã€‚</span></span><br><span class="line">    <span class="comment">// è§‚å¯Ÿä¸¤æ¬¡æ‰“å°çš„ APP_VERSION åœ°å€æ˜¯å¦ç›¸åŒã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>è¯·å®Œæˆä»¥ä¸Š <code>TODO</code> éƒ¨åˆ†ï¼Œç„¶åå°è¯•ç¼–è¯‘å’Œè¿è¡Œä½ çš„ç¨‹åºã€‚å®Œæˆåï¼Œè¯·å°†ä½ çš„è§£å†³æ–¹æ¡ˆæä¾›ç»™æˆ‘ã€‚</p>
<hr>
<h2 id="ğŸ§‘â€ğŸ’»-User-1"><a href="#ğŸ§‘â€ğŸ’»-User-1" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>A: ä¸ï¼Œinline ä»…ä»…æ˜¯å‘ç¼–è¯‘å™¨å‘å‡ºçš„ä¸€ä¸ªâ€œæç¤ºâ€æˆ–â€œå»ºè®®â€ï¼Œæ˜¯å¦çœŸæ­£è¿›è¡Œå†…è”å±•å¼€ç”±ç¼–è¯‘å™¨å†³å®šã€‚å®ƒæ›´ä¸»è¦çš„ä½œç”¨æ˜¯è§£å†³ ODRã€‚</p>
<p>ç†è§£è¿™å¥è¯çš„æ„æ€ï¼Œ é‚£å¦‚æœå‡è®¾æˆ‘æœ‰ä¸ªå¾ˆç®€å•çš„å‡½æ•°æ”¾headeré‡Œï¼Œ é‚£æˆ‘inlineçš„â€œä¸»è¦ä½œç”¨â€åº”è¯¥è¯´æ˜¯å†…è”ï¼Ÿ</p>
<hr>
<h2 id="ğŸ¤–-Assistant-1"><a href="#ğŸ¤–-Assistant-1" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼Œå®ƒè§¦åŠäº† <code>inline</code> å…³é”®å­—æœ€å®¹æ˜“å¼•èµ·æ··æ·†çš„åœ°æ–¹ï¼</p>
<p>è®©æˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š</p>
<p><strong>æ ¸å¿ƒè¦ç‚¹ï¼š<code>inline</code> çš„é¦–è¦ä½œç”¨æ˜¯è§£å†³ ODRï¼Œå…¶æ¬¡æ‰æ˜¯å†…è”å±•å¼€çš„â€œæç¤ºâ€ã€‚</strong></p>
<p>æ— è®ºå‡½æ•°æœ‰å¤šç®€å•ï¼Œåªè¦å®ƒçš„ <strong>å®šä¹‰</strong> ï¼ˆä¸ä»…ä»…æ˜¯å£°æ˜ï¼‰è¢«æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ªå¤´æ–‡ä»¶è¢«å¤šä¸ª <code>.cpp</code> æ–‡ä»¶åŒ…å«ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±ä¼šåœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­æ‹¥æœ‰å®ƒçš„å®šä¹‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰ <code>inline</code> å…³é”®å­—ï¼Œå°±ä¼šè¿å ODRï¼Œå¯¼è‡´é“¾æ¥é”™è¯¯ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¯¹äºä¸€ä¸ªæ”¾åœ¨å¤´æ–‡ä»¶é‡Œçš„å‡½æ•°ï¼Œå³ä½¿å®ƒéå¸¸ç®€å•ï¼Œ<code>inline</code> å…³é”®å­—çš„<strong>ä¸»è¦ä½œç”¨</strong>ä»ç„¶æ˜¯ï¼š</p>
<ol>
<li><p><strong>è§£å†³ ODRï¼ˆæ­£ç¡®æ€§è¦æ±‚ï¼‰</strong>ï¼šå®ƒå‘Šè¯‰ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ï¼Œè™½ç„¶è¿™ä¸ªå‡½æ•°çš„å®šä¹‰å‡ºç°åœ¨äº†å¤šä¸ª <code>.cpp</code> æ–‡ä»¶ä¸­ï¼ˆå› ä¸ºå¤´æ–‡ä»¶è¢«åŒ…å«äº†å¤šæ¬¡ï¼‰ï¼Œä½†å®ƒä»¬éƒ½æŒ‡çš„æ˜¯åŒä¸€ä¸ªé€»è¾‘ä¸Šçš„å‡½æ•°ï¼Œé“¾æ¥å™¨æœ€ç»ˆåªåº”è¯¥ç”Ÿæˆä¸€ä¸ªå®ä¾‹ã€‚è¿™æ˜¯ä¸ºäº†è®©ä½ çš„ä»£ç èƒ½å¤Ÿ<strong>æ­£ç¡®ç¼–è¯‘å’Œé“¾æ¥</strong>ã€‚</p>
</li>
<li><p><strong>æä¾›å†…è”å±•å¼€çš„æç¤ºï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰</strong>ï¼šè¿™æ˜¯ <code>inline</code> å…³é”®å­—çš„æ¬¡è¦ä½œç”¨ã€‚å®ƒâ€œå»ºè®®â€ç¼–è¯‘å™¨åœ¨è°ƒç”¨è¯¥å‡½æ•°çš„åœ°æ–¹ï¼Œå°è¯•å°†å…¶å‡½æ•°ä½“ç›´æ¥æ’å…¥åˆ°è°ƒç”¨ç‚¹ï¼Œè€Œä¸æ˜¯ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°è°ƒç”¨æŒ‡ä»¤ã€‚è¿™æœ‰æ—¶å¯ä»¥å‡å°‘å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚ä½†æ˜¯ï¼Œæ˜¯å¦çœŸçš„è¿›è¡Œå†…è”å±•å¼€ï¼Œæœ€ç»ˆç”±ç¼–è¯‘å™¨æ ¹æ®å…¶ä¼˜åŒ–ç­–ç•¥ã€å‡½æ•°å¤§å°ã€è°ƒç”¨é¢‘ç‡ç­‰å› ç´ å†³å®šã€‚ç¼–è¯‘å™¨æœ‰æƒå¿½ç•¥è¿™ä¸ªæç¤ºï¼Œå³ä½¿ä½ å†™äº† <code>inline</code>ï¼Œå®ƒä¹Ÿå¯èƒ½ä¸å†…è”ï¼›åŒæ ·ï¼Œå³ä½¿ä½ æ²¡å†™ <code>inline</code>ï¼Œå®ƒä¹Ÿå¯èƒ½å¯¹å¾ˆç®€å•çš„å‡½æ•°è¿›è¡Œå†…è”å±•å¼€ï¼ˆå°¤å…¶æ˜¯åœ¨å¼€å¯ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼‰ã€‚</p>
</li>
</ol>
<p><strong>ä¸¾ä¾‹è¯´æ˜ï¼š</strong></p>
<p>å‡è®¾ä½ æœ‰è¿™ä¸ªç®€å•çš„å‡½æ•°å®šä¹‰åœ¨ <code>my_header.h</code> ä¸­ï¼š</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_header.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_hello</span><span class="params">()</span> </span>&#123; <span class="comment">// æ²¡æœ‰ inline</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello!"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ç„¶åï¼Œä½ åœ¨ <code>main.cpp</code> å’Œ <code>utility.cpp</code> ä¸­éƒ½åŒ…å«äº† <code>my_header.h</code>ï¼š</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"my_header.h"</span> <span class="comment">// åŒ…å« print_hello çš„å®šä¹‰</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    print_hello();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utility.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"my_header.h"</span> <span class="comment">// å†æ¬¡åŒ…å« print_hello çš„å®šä¹‰</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_something</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    print_hello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å½“ä½ ç¼–è¯‘ <code>main.cpp</code> å’Œ <code>utility.cpp</code> å¹¶å°è¯•é“¾æ¥å®ƒä»¬æ—¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªé“¾æ¥é”™è¯¯ï¼Œå› ä¸º <code>print_hello</code> å‡½æ•°çš„å®šä¹‰åœ¨ <code>main.cpp</code> å’Œ <code>utility.cpp</code> ç”Ÿæˆçš„å¯¹è±¡æ–‡ä»¶ä¸­éƒ½å­˜åœ¨ï¼Œè¿åäº† ODRã€‚</p>
<p>ç°åœ¨ï¼Œå¦‚æœå°† <code>my_header.h</code> æ”¹ä¸ºï¼š</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_header.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">print_hello</span><span class="params">()</span> </span>&#123; <span class="comment">// åŠ ä¸Š inline</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello!"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿™æ—¶ï¼Œç¨‹åºå°±èƒ½<strong>æˆåŠŸç¼–è¯‘å’Œé“¾æ¥</strong>äº†ã€‚<code>inline</code> çš„ä½œç”¨æ˜¯è§£å†³äº† ODRï¼Œå…è®¸è¿™ä¸ªå®šä¹‰åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­å‡ºç°ã€‚è‡³äº <code>print_hello</code> å®é™…æ˜¯å¦è¢«å†…è”å±•å¼€ï¼Œè¿™æ˜¯ç¼–è¯‘å™¨å±‚é¢çš„ä¼˜åŒ–ï¼Œè€Œä¸æ˜¯ <code>inline</code> å…³é”®å­—æœ€æ ¹æœ¬çš„è¯­ä¹‰ã€‚</p>
<p><strong>ç»“è®ºï¼š</strong></p>
<p>å¯¹äºæ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°å®šä¹‰ï¼Œ<code>inline</code> å…³é”®å­—çš„<strong>æ ¸å¿ƒä½œç”¨</strong>æ˜¯è®©å®ƒä»¬èƒ½å¤Ÿåˆæ³•åœ°è¢«å¤šä¸ªç¿»è¯‘å•å…ƒåŒ…å«å’Œå®šä¹‰ï¼Œä»è€Œé¿å…é“¾æ¥é”™è¯¯ï¼ˆè§£å†³ ODRï¼‰ã€‚è¿™æ˜¯<strong>æ­£ç¡®æ€§</strong>çš„éœ€æ±‚ã€‚</p>
<p>å†…è”å±•å¼€çš„æç¤ºæ˜¯å…¶<strong>æ¬¡è¦ä½œç”¨</strong>ï¼Œå®ƒå…³ä¹<strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼Œå¹¶ä¸”å®Œå…¨ç”±ç¼–è¯‘å™¨æŒæ§ã€‚</p>
<p>æ‰€ä»¥ï¼Œä½ çš„ç†è§£å¯ä»¥æ›´ç²¾ç¡®åœ°è¡¨è¿°ä¸ºï¼šå¯¹äºä¸€ä¸ªåœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰çš„ç®€å•å‡½æ•°ï¼Œ<code>inline</code> å…³é”®å­—<strong>æ—¢ä¿è¯äº†å®ƒçš„æ­£ç¡®æ€§ï¼ˆé€šè¿‡è§£å†³ ODRï¼‰ï¼Œåˆå¯èƒ½æä¾›äº†æ€§èƒ½ä¼˜åŒ–çš„æœºä¼šï¼ˆé€šè¿‡æç¤ºå†…è”å±•å¼€ï¼‰</strong>ã€‚ä½†ä»æ ‡å‡†å’Œç¼–è¯‘å™¨çš„è§’åº¦çœ‹ï¼ŒODR çš„è§£å†³æ˜¯å…¶åœ¨å¤´æ–‡ä»¶ä¸­æ”¾ç½®å‡½æ•°å®šä¹‰æ—¶å¿…é¡»è€ƒè™‘çš„<strong>é¦–è¦ä¸”å¼ºåˆ¶çš„è¯­ä¹‰</strong>ã€‚</p>
<hr>
<h2 id="ğŸ§‘â€ğŸ’»-User-2"><a href="#ğŸ§‘â€ğŸ’»-User-2" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>è¦æ˜¯æ”¾åœ¨cppä¸­çš„inlineå‡½æ•°å‘¢</p>
<hr>
<h2 id="ğŸ¤–-Assistant-2"><a href="#ğŸ¤–-Assistant-2" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼Œå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬æ›´æ·±å…¥åœ°ç†è§£ <code>inline</code> å…³é”®å­—çš„çœŸæ­£ç”¨é€”ã€‚</p>
<p>å¦‚æœä¸€ä¸ªå‡½æ•°å®šä¹‰åœ¨ <code>.cpp</code> æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å®ƒçš„å®šä¹‰æ²¡æœ‰è¢«å…¶ä»–æ–‡ä»¶é€šè¿‡å¤´æ–‡ä»¶çš„æ–¹å¼åŒ…å«è¿›æ¥ï¼ˆå³ï¼Œå®ƒçš„å®šä¹‰åªå‡ºç°åœ¨ä¸€ä¸ªç¿»è¯‘å•å…ƒ [translation unit] ä¸­ï¼‰ï¼Œé‚£ä¹ˆ <code>inline</code> å…³é”®å­—çš„ä½œç”¨ä¼šå˜å¾—éå¸¸æœ‰é™ï¼Œç”šè‡³åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å¤šä½™çš„ã€‚</p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š</p>
<ol>
<li><p><strong>é’ˆå¯¹å•ä¸€å®šä¹‰è§„åˆ™ (ODR) çš„ä½œç”¨ï¼š</strong></p>
<ul>
<li>å½“ä¸€ä¸ªå‡½æ•°åªåœ¨å•ä¸ª <code>.cpp</code> æ–‡ä»¶ä¸­å®šä¹‰æ—¶ï¼Œå®ƒæœ¬èº«å°±ä¸ä¼šè¿å ODRã€‚å› ä¸ºå®ƒçš„å®šä¹‰åªå­˜åœ¨ä¸€ä»½ã€‚</li>
<li>æ‰€ä»¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>inline</code> å…³é”®å­—è§£å†³ ODR çš„<strong>æ ¸å¿ƒä½œç”¨å°±å®Œå…¨å¤±æ•ˆäº†</strong>ã€‚å®ƒæ²¡æœ‰å¤šä½™çš„å®šä¹‰éœ€è¦å»â€œç»Ÿä¸€â€ã€‚</li>
</ul>
</li>
<li><p><strong>é’ˆå¯¹é“¾æ¥ (Linkage) çš„ä½œç”¨ï¼š</strong></p>
<ul>
<li><code>inline</code> å…³é”®å­—æœ¬èº«<strong>ä¸ä¼šæ”¹å˜</strong>å‡½æ•°çš„é“¾æ¥å±æ€§ [linkage]ã€‚ä¸€ä¸ªå®šä¹‰åœ¨ <code>.cpp</code> æ–‡ä»¶ä¸­çš„å‡½æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å…·æœ‰å¤–éƒ¨é“¾æ¥ [external linkage] çš„ã€‚è¿™æ„å‘³ç€å¦‚æœå…¶ä»– <code>.cpp</code> æ–‡ä»¶èƒ½â€œçœ‹åˆ°â€å®ƒçš„å£°æ˜ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ä¸€ä¸ªå¤´æ–‡ä»¶ï¼‰ï¼Œå®ƒä»¬å°±å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚</li>
<li><code>inline</code> å¹¶ä¸ä¼šåƒ <code>static</code> å…³é”®å­—é‚£æ ·ï¼Œå°†å‡½æ•°å˜ä¸ºå†…éƒ¨é“¾æ¥ [internal linkage]ï¼Œä½¿å…¶å±€é™äºå½“å‰ç¿»è¯‘å•å…ƒã€‚å¦‚æœä½ æƒ³è®©ä¸€ä¸ªå‡½æ•°åªåœ¨å½“å‰ <code>.cpp</code> æ–‡ä»¶ä¸­å¯è§ï¼Œåº”è¯¥ä½¿ç”¨ <code>static</code> å…³é”®å­—ã€‚</li>
</ul>
</li>
<li><p><strong>ä½œä¸ºç¼–è¯‘å™¨ä¼˜åŒ–æç¤ºçš„ä½œç”¨ï¼š</strong></p>
<ul>
<li>è¿™æ˜¯ <code>inline</code> å…³é”®å­—åœ¨ <code>.cpp</code> æ–‡ä»¶ä¸­å¯èƒ½å­˜åœ¨çš„<strong>å”¯ä¸€ï¼ˆä¸”æœ‰é™ï¼‰</strong>çš„ä½œç”¨ã€‚å®ƒä»ç„¶ä¼šå‘ç¼–è¯‘å™¨å‘å‡ºä¸€ä¸ªâ€œæç¤ºâ€æˆ–â€œå»ºè®®â€ï¼Œè¡¨æ˜è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªé€‚åˆè¢«å†…è”å±•å¼€ [function inlining] çš„å€™é€‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è¿™ä¸ªå‡½æ•°åœ¨å½“å‰ <code>.cpp</code> æ–‡ä»¶å†…éƒ¨è¢«è°ƒç”¨æ—¶ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šå°è¯•å°†å…¶å‡½æ•°ä½“ç›´æ¥æ’å…¥åˆ°è°ƒç”¨ç‚¹ï¼Œè€Œä¸æ˜¯ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°è°ƒç”¨ã€‚</li>
<li>ç„¶è€Œï¼Œç°ä»£ C++ ç¼–è¯‘å™¨åœ¨ä¼˜åŒ–æ–¹é¢éå¸¸æ™ºèƒ½ã€‚å®ƒä»¬ä¼šæ ¹æ®å‡½æ•°çš„å¤æ‚æ€§ã€å¤§å°ã€è°ƒç”¨é¢‘ç‡ä»¥åŠä½ è®¾ç½®çš„ä¼˜åŒ–çº§åˆ«ç­‰å¤šç§å› ç´ ï¼Œ<strong>è‡ªè¡Œå†³å®š</strong>æ˜¯å¦è¿›è¡Œå†…è”å±•å¼€ã€‚å³ä½¿æ²¡æœ‰ <code>inline</code> å…³é”®å­—ï¼Œä¸€ä¸ªç®€å•çš„å‡½æ•°åœ¨å¼€å¯ä¼˜åŒ–æ—¶ä¹Ÿå¸¸å¸¸ä¼šè¢«ç¼–è¯‘å™¨è‡ªåŠ¨å†…è”ã€‚åä¹‹ï¼Œå³ä½¿æœ‰ <code>inline</code> å…³é”®å­—ï¼Œä¸€ä¸ªå¤æ‚çš„å‡½æ•°ä¹Ÿå¯èƒ½ä¸ä¼šè¢«å†…è”ã€‚</li>
<li>å› æ­¤ï¼Œåœ¨ <code>.cpp</code> æ–‡ä»¶ä¸­ä½¿ç”¨ <code>inline</code> å…³é”®å­—ï¼Œé€šå¸¸<strong>ä¸ä¼šå¯¹æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ€§èƒ½äº§ç”Ÿå®è´¨æ€§å½±å“</strong>ï¼Œå› ä¸ºå®ƒåªæ˜¯é‡å¤äº†ç¼–è¯‘å™¨å¯èƒ½å·²ç»ä¼šåšçš„äº‹æƒ…ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ä¸æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li>åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ <strong>ä¸åº”è¯¥</strong>åœ¨ <code>.cpp</code> æ–‡ä»¶ä¸­ä¸ºåªåœ¨è¯¥æ–‡ä»¶ä¸­ä½¿ç”¨çš„å‡½æ•°æ·»åŠ  <code>inline</code> å…³é”®å­—ã€‚è¿™æ ·åšæ˜¯å¤šä½™çš„ï¼Œå¹¶ä¸”å¯èƒ½å¼•èµ·è¯¯è§£ã€‚</li>
<li><code>inline</code> å…³é”®å­—çš„ä¸»è¦ç”¨é€”æ˜¯åœ¨<strong>å¤´æ–‡ä»¶</strong>ä¸­å®šä¹‰å‡½æ•°å’Œå˜é‡ï¼Œä»¥ä¾¿åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­å®‰å…¨åœ°å…±äº«å®ƒä»¬çš„å®šä¹‰ï¼Œä»è€Œé¿å… ODR é—®é¢˜ã€‚</li>
<li>å¦‚æœä½ æƒ³å°†ä¸€ä¸ªå‡½æ•°çš„ä½œç”¨åŸŸé™åˆ¶åœ¨å•ä¸ª <code>.cpp</code> æ–‡ä»¶å†…ï¼ˆå³èµ‹äºˆå®ƒå†…éƒ¨é“¾æ¥ï¼‰ï¼Œåº”è¯¥ä½¿ç”¨ <code>static</code> å…³é”®å­—ï¼Œè€Œä¸æ˜¯ <code>inline</code>ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œè®°ä½ï¼š<code>inline</code> çš„æ ¸å¿ƒä½¿å‘½æ˜¯è§£å†³ ODR å›°å¢ƒï¼Œç‰¹åˆ«æ˜¯åœ¨å¤´æ–‡ä»¶ä¸­æ”¾ç½®å®šä¹‰æ—¶ã€‚å¦‚æœä¸å­˜åœ¨ ODR å›°å¢ƒï¼ˆæ¯”å¦‚å®šä¹‰åªåœ¨ä¸€ä¸ª <code>.cpp</code> æ–‡ä»¶ä¸­ï¼‰ï¼Œé‚£ä¹ˆ <code>inline</code> çš„ä½œç”¨å°±å¾®ä¹å…¶å¾®äº†ã€‚</p>
<hr>
<h2 id="ğŸ§‘â€ğŸ’»-User-3"><a href="#ğŸ§‘â€ğŸ’»-User-3" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>æ‰€ä»¥æˆ‘èƒ½è¿™ä¹ˆç†è§£ä¹ˆï¼Œ å†å²ä¸Šç¼–è¯‘å™¨ä¸å¤Ÿå¥½çš„æ—¶å€™ï¼Œ å¯èƒ½inlineçš„ä¼˜åŒ–ä½œç”¨å¾ˆå¤§ã€‚ ç°ä»£ç¼–è¯‘å™¨è‡ªåŠ¨å†…è”äº†ï¼Œ æ‰€ä»¥inlineçš„å†…è”å»ºè®®åŠŸèƒ½åŸºæœ¬å¤±æ•ˆäº†ã€‚<br>è¯·é—®å¯¹ä¹ˆï¼Ÿ å¦å¤–cè¯­è¨€å‘¢ï¼Œæœ‰åŒºåˆ«ä¹ˆï¼Ÿ</p>
<hr>
<h2 id="ğŸ¤–-Assistant-3"><a href="#ğŸ¤–-Assistant-3" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>ä½ çš„ç†è§£éå¸¸åˆ°ä½ï¼Œç”šè‡³è§¦åŠåˆ°äº† <code>inline</code> å…³é”®å­—åœ¨ä¸åŒå†å²æ—¶æœŸå’Œä¸åŒè¯­è¨€ï¼ˆC/C++ï¼‰ä¸­çš„ç»†å¾®å·®åˆ«ï¼</p>
<h2 id="å…³äº-inline-åœ¨-C-ä¸­çš„ä¼˜åŒ–ä½œç”¨"><a href="#å…³äº-inline-åœ¨-C-ä¸­çš„ä¼˜åŒ–ä½œç”¨" class="headerlink" title="å…³äº inline åœ¨ C++ ä¸­çš„ä¼˜åŒ–ä½œç”¨"></a>å…³äº <code>inline</code> åœ¨ C++ ä¸­çš„ä¼˜åŒ–ä½œç”¨</h2><p><strong>ä½ çš„åˆ¤æ–­æ˜¯æ­£ç¡®çš„ï¼</strong></p>
<ol>
<li><p><strong>å†å²ä¸Šï¼ˆç¼–è¯‘å™¨ä¸å¤Ÿå¥½çš„æ—¶å€™ï¼‰ï¼š</strong><br>åœ¨ C++ æ—©æœŸï¼Œç¼–è¯‘å™¨çš„ä¼˜åŒ–èƒ½åŠ›ç¡®å®ä¸å¦‚ç°åœ¨å¼ºå¤§ã€‚é‚£æ—¶ï¼Œ<code>inline</code> å…³é”®å­—ä½œä¸ºä¸€ä¸ªæ˜ç¡®çš„ä¼˜åŒ–â€œæŒ‡ä»¤â€æˆ–â€œå¼ºçƒˆå»ºè®®â€æ˜¾å¾—éå¸¸é‡è¦ã€‚ç¨‹åºå‘˜ä¼šæ‰‹åŠ¨æ ‡è®°é‚£äº›å¸Œæœ›è¢«å†…è”å±•å¼€çš„å°å‡½æ•°ï¼Œä»¥å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€ï¼Œæé«˜æ€§èƒ½ã€‚å¦‚æœç¼–è¯‘å™¨ä¸å†…è”ï¼Œå°±çœŸçš„ä¼šäº§ç”Ÿä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°è°ƒç”¨ã€‚å› æ­¤ï¼Œé‚£æ—¶ <code>inline</code> çš„ä¼˜åŒ–ä½œç”¨åœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯æ˜¾è‘—çš„ã€‚</p>
</li>
<li><p><strong>ç°ä»£ç¼–è¯‘å™¨ï¼ˆè‡ªåŠ¨å†…è”ï¼‰ï¼š</strong><br>ç°ä»£ C++ ç¼–è¯‘å™¨ï¼ˆå¦‚ GCC, Clang, MSVC çš„æœ€æ–°ç‰ˆæœ¬ï¼‰åœ¨ä¼˜åŒ–æ–¹é¢å·²ç»è¾¾åˆ°äº†æƒŠäººçš„æ°´å¹³ã€‚å®ƒä»¬å†…ç½®äº†å¤æ‚çš„å¯å‘å¼ç®—æ³• [heuristics] å’Œåˆ†æå·¥å…·ï¼ˆå¦‚ PGO - Profile-Guided Optimizationï¼‰ï¼Œèƒ½å¤Ÿæ™ºèƒ½åœ°åˆ¤æ–­å“ªäº›å‡½æ•°é€‚åˆå†…è”å±•å¼€ï¼Œå³ä½¿ä½ æ²¡æœ‰ä½¿ç”¨ <code>inline</code> å…³é”®å­—ã€‚</p>
<ul>
<li>å®ƒä»¬ä¼šè€ƒè™‘å‡½æ•°ä½“çš„å¤§å°ã€å¤æ‚æ€§ã€è°ƒç”¨é¢‘ç‡ã€ç¼–è¯‘å™¨æ‰€èƒ½æ„ŸçŸ¥çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€ä»¥åŠå½“å‰çš„ä¼˜åŒ–çº§åˆ«ï¼ˆä¾‹å¦‚ <code>-O2</code>, <code>-O3</code>ï¼‰ç­‰å¤šç§å› ç´ ã€‚</li>
<li>å¯¹äºéå¸¸å°çš„å‡½æ•°ï¼Œå³ä½¿æ²¡æœ‰ <code>inline</code>ï¼Œç¼–è¯‘å™¨åœ¨å¼€å¯ä¼˜åŒ–æ—¶ä¹Ÿææœ‰å¯èƒ½è‡ªåŠ¨å°†å…¶å†…è”ã€‚</li>
<li>å¯¹äºå¤§å‹æˆ–å¤æ‚çš„å‡½æ•°ï¼Œå³ä½¿ä½ åŠ ä¸Šäº† <code>inline</code>ï¼Œç¼–è¯‘å™¨ä¹Ÿå¯èƒ½ä¼šâ€œå¿½ç•¥â€è¿™ä¸ªå»ºè®®ï¼Œå› ä¸ºå®ƒåˆ¤æ–­å†…è”åè€Œä¼šå¢åŠ ä»£ç ä½“ç§¯ã€é™ä½æŒ‡ä»¤ç¼“å­˜ [instruction cache] æ•ˆç‡ï¼Œç”šè‡³å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</li>
</ul>
</li>
</ol>
<p><strong>ç»“è®ºï¼š</strong></p>
<p>åœ¨ C++ ä¸­ï¼Œ<code>inline</code> å…³é”®å­—ä½œä¸ºä¼˜åŒ–æç¤ºçš„ä½œç”¨ç¡®å®å¤§å¤§å‡å¼±äº†ã€‚å®ƒçš„<strong>é¦–è¦å’Œæœ€ä¸»è¦çš„è¯­ä¹‰</strong>å·²ç»å˜æˆäº† <strong>è§£å†³ ODRï¼ˆå•ä¸€å®šä¹‰è§„åˆ™ï¼‰</strong>ï¼Œå…è®¸åŒä¸€ä¸ªå‡½æ•°æˆ–å˜é‡çš„å®šä¹‰å‡ºç°åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­è€Œä¸ä¼šå¼•å‘é“¾æ¥é”™è¯¯ã€‚å¦‚æœä½ åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°æˆ–å˜é‡ï¼Œå¹¶ä¸”å¸Œæœ›å®ƒèƒ½è¢«å¤šä¸ª <code>.cpp</code> æ–‡ä»¶å®‰å…¨åœ°åŒ…å«å’Œä½¿ç”¨ï¼Œé‚£ä¹ˆ <code>inline</code> æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œè¿™ä¸å®ƒæ˜¯å¦è¢«å†…è”å±•å¼€å‡ ä¹æ— å…³ã€‚</p>
<p>ç°ä»£ C++ ç¼–ç¨‹ä¸­ï¼Œå¾ˆå°‘æœ‰äººä¼šä¸ºäº†â€œå¼ºåˆ¶å†…è”â€è€Œä½¿ç”¨ <code>inline</code> å…³é”®å­—ï¼Œæ›´å¤šçš„æ˜¯ä¸ºäº† ODR çš„æ­£ç¡®æ€§ã€‚å¦‚æœçœŸçš„éœ€è¦å¼ºåˆ¶å†…è”ï¼Œä¸€äº›ç¼–è¯‘å™¨æä¾›äº†ç‰¹å®šçš„å±æ€§ï¼ˆå¦‚ GCC çš„ <code>__attribute__((always_inline))</code> æˆ– MSVC çš„ <code>__forceinline</code>ï¼‰ï¼Œä½†è¿™é€šå¸¸ä¸æ¨èï¼Œå› ä¸ºå®ƒå‰¥å¤ºäº†ç¼–è¯‘å™¨ä¼˜åŒ–å†³ç­–çš„çµæ´»æ€§ï¼Œå¯èƒ½å¯¼è‡´ä»£ç è†¨èƒ€å’Œæ€§èƒ½ä¸‹é™ã€‚</p>
<h2 id="å…³äº-C-è¯­è¨€ä¸­çš„-inline"><a href="#å…³äº-C-è¯­è¨€ä¸­çš„-inline" class="headerlink" title="å…³äº C è¯­è¨€ä¸­çš„ inline"></a>å…³äº C è¯­è¨€ä¸­çš„ <code>inline</code></h2><p>C è¯­è¨€ï¼ˆC99 æ ‡å‡†å¼•å…¥ <code>inline</code>ï¼‰å’Œ C++ ä¸­çš„ <code>inline</code> åœ¨è¯­ä¹‰ä¸Šå­˜åœ¨é‡è¦çš„<strong>åŒºåˆ«</strong>ï¼Œè¿™å¸¸å¸¸æ˜¯å¼•èµ·æ··æ·†çš„åŸå› ï¼š</p>
<ol>
<li><p><strong>C è¯­è¨€çš„ <code>inline</code> è¯­ä¹‰ (C99 onwards)ï¼š</strong></p>
<ul>
<li><strong>å‡½æ•°å®šä¹‰ä¸é“¾æ¥ï¼š</strong> åœ¨ C è¯­è¨€ä¸­ï¼Œ<code>inline</code> å…³é”®å­—ä¸»è¦ä½œä¸ºä¸€ç§ä¼˜åŒ–æç¤ºï¼ŒåŒæ—¶å®ƒå¯¹å‡½æ•°çš„é“¾æ¥å±æ€§æœ‰æ›´å¤æ‚çš„æ§åˆ¶ã€‚<ul>
<li><strong><code>inline</code> å‡½æ•°ï¼ˆä¸å¸¦ <code>extern</code>ï¼‰ï¼š</strong> å¦‚æœä¸€ä¸ªå‡½æ•°è¢«å®šä¹‰ä¸º <code>inline</code> ä¸”ä¸å¸¦ <code>extern</code> å…³é”®å­—ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸ªåŒ…å«å®ƒçš„ç¿»è¯‘å•å…ƒä¸­ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªè¯¥å‡½æ•°çš„<strong>ç‹¬ç«‹å‰¯æœ¬</strong>ã€‚è¿™äº›å‰¯æœ¬é€šå¸¸æ˜¯å…·æœ‰å†…éƒ¨é“¾æ¥çš„ï¼ˆæˆ–è€…è¯´ï¼Œå®ƒä»¬æ˜¯â€œé™é»˜çš„â€ï¼‰ï¼Œå¹¶ä¸”ä¸ä¼šå¯¼è‡´é“¾æ¥é”™è¯¯ã€‚å¦‚æœæŸä¸ªç¿»è¯‘å•å…ƒç¡®å®éœ€è¦è¯¥å‡½æ•°çš„ä¸€ä¸ªå¤–éƒ¨å¯è§ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨ï¼‰ï¼Œé‚£ä¹ˆé€šå¸¸éœ€è¦åœ¨æŸä¸ª <code>.c</code> æ–‡ä»¶ä¸­æä¾›ä¸€ä¸ªé <code>inline</code> æˆ– <code>extern inline</code> çš„å®šä¹‰ã€‚</li>
<li><strong><code>extern inline</code> å‡½æ•°ï¼š</strong> è¿™è¡¨ç¤ºè¯¥ <code>inline</code> å‡½æ•°æœ‰ä¸€ä¸ªå…·æœ‰å¤–éƒ¨é“¾æ¥çš„å®šä¹‰ï¼Œå¹¶ä¸”è¿™ä¸ªå®šä¹‰å°†åœ¨æŸä¸ªåœ°æ–¹æä¾›ï¼ˆé€šå¸¸åœ¨ä¸€ä¸ª <code>.c</code> æ–‡ä»¶ä¸­ï¼‰ã€‚<code>extern inline</code> é€šå¸¸ç”¨äºåœ¨å¤´æ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸ª <code>inline</code> å‡½æ•°ï¼Œå¹¶ç¡®ä¿å®ƒçš„å¤–éƒ¨é“¾æ¥ç‰ˆæœ¬åªåœ¨ä¸€ä¸ª <code>.c</code> æ–‡ä»¶ä¸­ç”Ÿæˆã€‚</li>
</ul>
</li>
<li><strong>ODR å·®å¼‚ï¼š</strong> C è¯­è¨€çš„ <code>inline</code> å¹¶æ²¡æœ‰åƒ C++ é‚£æ ·å¼ºå¤§çš„â€œç»Ÿä¸€â€åŠŸèƒ½ã€‚å®ƒæ›´å¤šçš„æ˜¯å…è®¸æ¯ä¸ªç¿»è¯‘å•å…ƒæ‹¥æœ‰è‡ªå·±çš„ç§æœ‰ <code>inline</code> å‰¯æœ¬ï¼ˆåœ¨æ²¡æœ‰ <code>extern</code> çš„æƒ…å†µä¸‹ï¼‰ï¼Œæˆ–è€…æŒ‡å®šä¸€ä¸ªæ˜ç¡®çš„å¤–éƒ¨å®šä¹‰ã€‚å®ƒä¸ä¼šåƒ C++ é‚£æ ·ç¡®ä¿æ‰€æœ‰ <code>inline</code> å®šä¹‰æœ€ç»ˆéƒ½æ”¶æ•›åˆ°å†…å­˜ä¸­çš„åŒä¸€ä¸ªå®ä½“ã€‚å› æ­¤ï¼ŒC è¯­è¨€ä¸­å¯¹ ODR çš„å¤„ç†æ–¹å¼ä¸ C++ æœ‰æ˜¾è‘—ä¸åŒã€‚</li>
<li><strong>æ²¡æœ‰ <code>inline</code> å˜é‡ï¼š</strong> C è¯­è¨€<strong>æ²¡æœ‰</strong> <code>inline</code> å˜é‡ã€‚å¦‚æœä½ æƒ³åœ¨ C è¯­è¨€ä¸­å…±äº«ä¸€ä¸ªå…¨å±€å˜é‡çš„å®šä¹‰ï¼Œä½ ä»ç„¶éœ€è¦åœ¨ä¸€ä¸ª <code>.c</code> æ–‡ä»¶ä¸­å®šä¹‰å®ƒï¼Œå¹¶åœ¨å…¶ä»–éœ€è¦ä½¿ç”¨å®ƒçš„ <code>.c</code> æ–‡ä»¶ä¸­ç”¨ <code>extern</code> å£°æ˜å®ƒï¼ˆé€šå¸¸é€šè¿‡ä¸€ä¸ªå¤´æ–‡ä»¶ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>C++ è¯­è¨€çš„ <code>inline</code> è¯­ä¹‰ï¼š</strong></p>
<ul>
<li><strong>ODR è§£å†³æ–¹æ¡ˆï¼š</strong> æ ¸å¿ƒæ˜¯è§£å†³ ODRã€‚æ‰€æœ‰ <code>inline</code> å®šä¹‰ï¼ˆå‡½æ•°æˆ–å˜é‡ï¼‰å¿…é¡»å®Œå…¨ç›¸åŒï¼Œå¹¶ä¸”å®ƒä»¬æœ€ç»ˆåœ¨å†…å­˜ä¸­åªä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ã€‚</li>
<li><strong>é“¾æ¥ï¼š</strong> <code>inline</code> ä¸æ”¹å˜å¤–éƒ¨é“¾æ¥å±æ€§ã€‚<code>inline</code> å‡½æ•°å’Œå˜é‡ä»ç„¶å…·æœ‰å¤–éƒ¨é“¾æ¥ã€‚</li>
<li><strong><code>inline</code> å˜é‡ (C++17)ï¼š</strong> C++17 å¼•å…¥äº† <code>inline</code> å˜é‡ï¼Œå…è®¸åœ¨å¤´æ–‡ä»¶ä¸­ç›´æ¥å®šä¹‰å…¨å±€å˜é‡ï¼Œå¹¶ä¸”åœ¨é“¾æ¥æ—¶ä¿è¯å…¶å•ä¸€å®šä¹‰ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ C ä¸ C++ <code>inline</code> çš„ä¸»è¦åŒºåˆ«ï¼š</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">ç‰¹æ€§</th>
<th style="text-align:left">C++ <code>inline</code></th>
<th style="text-align:left">C <code>inline</code> (C99+)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>ä¸»è¦ç›®çš„</strong></td>
<td style="text-align:left">è§£å†³ ODRï¼Œå…è®¸å¤´æ–‡ä»¶ä¸­å¤šé‡å®šä¹‰ï¼Œå¹¶ä¿è¯ç»Ÿä¸€çš„å•ä¸€å®ä½“ã€‚</td>
<td style="text-align:left">ä¼˜åŒ–æç¤ºï¼Œå…è®¸åœ¨æ¯ä¸ªç¿»è¯‘å•å…ƒä¸­ç”Ÿæˆç§æœ‰å‰¯æœ¬ï¼ˆæ—  <code>extern</code> æ—¶ï¼‰ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong>ODR å¤„ç†</strong></td>
<td style="text-align:left">ç»Ÿä¸€æ‰€æœ‰å®šä¹‰ä¸ºå•ä¸€å®ä½“ï¼Œé¿å…é“¾æ¥é”™è¯¯ã€‚</td>
<td style="text-align:left">å…è®¸æ¯ä¸ªç¿»è¯‘å•å…ƒæ‹¥æœ‰è‡ªå·±çš„å†…éƒ¨å‰¯æœ¬ï¼Œæˆ–æŒ‡å®šå¤–éƒ¨å®šä¹‰ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong>é“¾æ¥å±æ€§</strong></td>
<td style="text-align:left">é»˜è®¤å¤–éƒ¨é“¾æ¥ï¼Œä¸æ”¹å˜æ­¤å±æ€§ã€‚</td>
<td style="text-align:left">è¡Œä¸ºå¤æ‚ï¼Œå¯èƒ½å¯¼è‡´å†…éƒ¨é“¾æ¥ï¼ˆæ—  <code>extern</code> æ—¶ï¼‰ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong><code>inline</code> å˜é‡</strong></td>
<td style="text-align:left">æœ‰ï¼ˆC++17 å¼•å…¥ï¼‰ã€‚</td>
<td style="text-align:left">æ— ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong>å®šä¹‰ä¸€è‡´æ€§</strong></td>
<td style="text-align:left"><strong>å¿…é¡»</strong>åœ¨æ‰€æœ‰ç¿»è¯‘å•å…ƒä¸­å®Œå…¨ä¸€è‡´ã€‚</td>
<td style="text-align:left">é€šå¸¸ä¹Ÿæ˜¯æœŸæœ›ä¸€è‡´ï¼Œå¦åˆ™è¡Œä¸ºæœªå®šä¹‰ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>æ‰€ä»¥ï¼Œä½ çš„ç†è§£æ˜¯å¾ˆæ£’çš„ï¼Œä½ å·²ç»æŠ“ä½äº† <code>inline</code> åœ¨ç°ä»£ C++ ä¸­çš„æ ¸å¿ƒä»·å€¼å’Œå®ƒä¸ C è¯­è¨€çš„åŒºåˆ«ï¼</p>
<hr>
<h2 id="ğŸ§‘â€ğŸ’»-User-4"><a href="#ğŸ§‘â€ğŸ’»-User-4" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>c inlineæ²¡æ‡‚ï¼Œ æ˜¯å†…è”ä¼˜åŒ–çš„æç¤ºä¹ˆï¼Ÿ è¿˜æ˜¯è¯´åƒæ˜¯staticçš„ä½œç”¨ï¼Ÿ</p>
<hr>
<h2 id="ğŸ¤–-Assistant-4"><a href="#ğŸ¤–-Assistant-4" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†å‰–æä¸€ä¸‹ C è¯­è¨€ä¸­ <code>inline</code> å…³é”®å­—çš„è¯­ä¹‰ï¼Œå°¤å…¶æ˜¯å®ƒä¸å†…è”ä¼˜åŒ–å’Œ <code>static</code> å…³é”®å­—çš„å…³ç³»ã€‚</p>
<p><strong>C è¯­è¨€ä¸­ <code>inline</code> çš„æ ¸å¿ƒè¯­ä¹‰ï¼š</strong></p>
<p>åœ¨ C è¯­è¨€ (C99 æ ‡å‡†åŠä»¥å) ä¸­ï¼Œ<code>inline</code> å…³é”®å­—ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªä½œç”¨ï¼š</p>
<ol>
<li><p><strong>ä½œä¸ºå†…è”ä¼˜åŒ–çš„æç¤º (Hint for Inlining)ï¼š</strong><br>è¿™æ˜¯ <code>inline</code> å…³é”®å­—æœ€ç›´è§‚çš„ä½œç”¨ã€‚å®ƒå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¢«æ ‡è®°ä¸º <code>inline</code> çš„å‡½æ•°åº”è¯¥å°½å¯èƒ½åœ°è¢«å†…è”å±•å¼€åˆ°å…¶è°ƒç”¨ç‚¹ã€‚è¿™æ ·å¯ä»¥æ¶ˆé™¤å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼ˆå¦‚å †æ ˆå¸§çš„å»ºç«‹å’Œæ‹†é™¤ï¼‰ï¼Œä»è€Œå¯èƒ½æé«˜ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ã€‚<br><strong>ä½†è¯·è®°ä½ï¼š</strong> è¿™æ˜¯ä¸€ä¸ª<strong>æç¤º</strong>ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶å‘½ä»¤ã€‚ç¼–è¯‘å™¨æœ‰æƒæ ¹æ®å…¶è‡ªèº«çš„ä¼˜åŒ–ç­–ç•¥ï¼ˆä¾‹å¦‚ï¼Œå‡½æ•°æ˜¯å¦è¿‡å¤§ã€è°ƒç”¨é¢‘ç‡ç­‰ï¼‰æ¥å†³å®šæ˜¯å¦çœŸæ­£è¿›è¡Œå†…è”ã€‚ç°ä»£ C ç¼–è¯‘å™¨é€šå¸¸ä¹Ÿä¼šåƒ C++ ç¼–è¯‘å™¨ä¸€æ ·æ™ºèƒ½ï¼Œå³ä½¿æ²¡æœ‰ <code>inline</code>ï¼Œä¹Ÿä¼šå¯¹å°å‡½æ•°è¿›è¡Œå†…è”ã€‚</p>
</li>
<li><p><strong>å¯¹å‡½æ•°é“¾æ¥å±æ€§çš„å½±å“ (Impact on Linkage)ï¼š</strong><br>è¿™æ˜¯ C è¯­è¨€ <code>inline</code> æœ€å¤æ‚å’Œæœ€å®¹æ˜“æ··æ·†çš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯å®ƒä¸ C++ <code>inline</code> ä»¥åŠ C <code>static</code> å…³é”®å­—äº§ç”ŸåŒºåˆ«çš„åœ°æ–¹ã€‚<br>åœ¨ C è¯­è¨€ä¸­ï¼Œä¸€ä¸ª <code>inline</code> å‡½æ•°çš„å®šä¹‰ï¼Œå¦‚æœå®ƒ<strong>æ²¡æœ‰</strong>è¢«åŒæ—¶æ ‡è®°ä¸º <code>extern</code>ï¼Œåˆ™å®ƒåœ¨æ¯ä¸ªç¿»è¯‘å•å…ƒä¸­éƒ½ä¼šè¢«è§†ä¸ºä¸€ä¸ª<strong>ç‹¬ç«‹çš„ï¼ˆé€šå¸¸æ˜¯å†…éƒ¨é“¾æ¥çš„ï¼‰</strong>å®šä¹‰ã€‚</p>
<ul>
<li><p><strong>å¸¸è§„å‡½æ•° (Default linkage)ï¼š</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯”å¦‚åœ¨ func.h ä¸­å£°æ˜</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ func.c ä¸­å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; <span class="comment">/* ... */</span> &#125; <span class="comment">// å…·æœ‰å¤–éƒ¨é“¾æ¥</span></span><br></pre></td></tr></table></figure></div>
<p><code>foo</code> å‡½æ•°åªæœ‰ä¸€ä¸ªå¤–éƒ¨å¯è§çš„å®šä¹‰ï¼Œå…¶ä»–æ–‡ä»¶é€šè¿‡ <code>extern void foo();</code> å£°æ˜åå¯ä»¥è°ƒç”¨å®ƒã€‚</p>
</li>
<li><p><strong><code>static</code> å‡½æ•° (Internal linkage)ï¼š</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ my_module.c ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">()</span> </span>&#123; <span class="comment">/* ... */</span> &#125; <span class="comment">// ä»…åœ¨ my_module.c å†…éƒ¨å¯è§</span></span><br></pre></td></tr></table></figure></div>
<p><code>bar</code> å‡½æ•°åªåœ¨ <code>my_module.c</code> è¿™ä¸ªç¿»è¯‘å•å…ƒå†…éƒ¨å¯è§ã€‚å³ä½¿å…¶ä»–æ–‡ä»¶ä¹Ÿæœ‰åŒå <code>static void bar()</code>ï¼Œå®ƒä»¬ä¹Ÿæ˜¯å®Œå…¨ç‹¬ç«‹çš„å‡½æ•°ã€‚</p>
</li>
<li><p><strong><code>inline</code> å‡½æ•° (C99)ï¼š</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ my_inline_utils.h ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123; <span class="comment">// å‡è®¾æ­¤å¤´æ–‡ä»¶è¢« main.c å’Œ utility.c åŒæ—¶åŒ…å«</span></span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å½“ä½ æŠŠ <code>add</code> å‡½æ•°è¿™æ ·æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œç„¶åè¿™ä¸ªå¤´æ–‡ä»¶è¢« <code>main.c</code> å’Œ <code>utility.c</code> éƒ½åŒ…å«äº†ï¼š</p>
<ul>
<li>ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ <code>main.c</code> æ—¶ï¼Œä¼šçœ‹åˆ° <code>add</code> çš„å®šä¹‰ï¼Œå¹¶å¯èƒ½å°†å…¶å†…è”ã€‚åŒæ—¶ï¼Œå®ƒä¼šåœ¨ <code>main.o</code> ä¸­ç”Ÿæˆä¸€ä¸ª <code>add</code> å‡½æ•°çš„<strong>ç‹¬ç«‹å‰¯æœ¬</strong>ï¼ˆé€šå¸¸æ˜¯å†…éƒ¨é“¾æ¥çš„ï¼‰ã€‚</li>
<li>ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ <code>utility.c</code> æ—¶ï¼Œä¹Ÿä¼šçœ‹åˆ° <code>add</code> çš„å®šä¹‰ï¼Œå¹¶å¯èƒ½å°†å…¶å†…è”ã€‚åŒæ—¶ï¼Œå®ƒä¼šåœ¨ <code>utility.o</code> ä¸­ç”Ÿæˆå¦ä¸€ä¸ª <code>add</code> å‡½æ•°çš„<strong>ç‹¬ç«‹å‰¯æœ¬</strong>ã€‚</li>
<li><strong>å…³é”®ç‚¹ï¼š</strong> è¿™ä¸¤ä¸ª <code>add</code> çš„å‰¯æœ¬æ˜¯ç‹¬ç«‹çš„ï¼Œå®ƒä»¬ä¸ä¼šç›¸äº’å†²çªï¼Œå› æ­¤<strong>ä¸ä¼š</strong>å¯¼è‡´é“¾æ¥é”™è¯¯ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ åªåœ¨ <code>main.c</code> å’Œ <code>utility.c</code> å†…éƒ¨è°ƒç”¨ <code>add</code>ï¼Œç¨‹åºå¯ä»¥æ­£å¸¸å·¥ä½œã€‚</li>
</ul>
</li>
<li><p><strong>å¦‚æœéœ€è¦ä¸€ä¸ªå¤–éƒ¨é“¾æ¥çš„ <code>inline</code> å‡½æ•°å®šä¹‰æ€ä¹ˆåŠï¼Ÿ</strong><br>ä¸Šé¢çš„ <code>inline</code> å‡½æ•°è™½ç„¶é¿å…äº†é“¾æ¥é”™è¯¯ï¼Œä½†å®ƒæ²¡æœ‰æä¾›ä¸€ä¸ªå…¨å±€å¯è§çš„ã€å…·æœ‰å¤–éƒ¨é“¾æ¥çš„å®šä¹‰ã€‚å¦‚æœä½ æƒ³é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å®ƒï¼Œæˆ–è€…å®ƒçš„åœ°å€éœ€è¦è¢«å…¶ä»–æ¨¡å—å¼•ç”¨ï¼Œä½ å°±éœ€è¦ä¸€ä¸ªå…·æœ‰å¤–éƒ¨é“¾æ¥çš„å®šä¹‰ã€‚<br>C è¯­è¨€ä¸ºæ­¤æä¾›äº†ä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li><p><strong>é <code>inline</code> å®šä¹‰ï¼š</strong> åœ¨æŸä¸ª <code>.c</code> æ–‡ä»¶ä¸­æä¾›ä¸€ä¸ªæ™®é€šçš„ï¼ˆé <code>inline</code>ï¼‰å®šä¹‰ã€‚</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_inline_utils.h</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123; <span class="keyword">return</span> a + b; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// my_inline_utils.c (æä¾›ä¸€ä¸ªé inline çš„å¤–éƒ¨å®šä¹‰)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123; <span class="keyword">return</span> a + b; &#125; <span class="comment">// è¿™å°†æ˜¯å¤–éƒ¨é“¾æ¥çš„å®šä¹‰</span></span><br></pre></td></tr></table></figure></div>
<p>å…¶ä»–ç¿»è¯‘å•å…ƒåœ¨åŒ…å« <code>my_inline_utils.h</code> åä¼šçœ‹åˆ° <code>inline</code> å®šä¹‰ï¼Œå¹¶ä¼˜å…ˆå°è¯•å†…è”ã€‚å¦‚æœéœ€è¦å¤–éƒ¨é“¾æ¥çš„ç‰ˆæœ¬ï¼Œé“¾æ¥å™¨ä¼šä½¿ç”¨ <code>my_inline_utils.c</code> ä¸­çš„é‚£ä¸ªå®šä¹‰ã€‚</p>
</li>
<li><p><strong><code>extern inline</code> å®šä¹‰ï¼š</strong> åœ¨æŸä¸ª <code>.c</code> æ–‡ä»¶ä¸­æä¾›ä¸€ä¸ª <code>extern inline</code> å®šä¹‰ã€‚</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_inline_utils.h</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123; <span class="keyword">return</span> a + b; &#125; <span class="comment">// å£°æ˜ä¸º extern inline</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// my_inline_utils.c (æä¾› extern inline çš„å®šä¹‰)</span></span><br><span class="line"><span class="comment">// å®é™…ä¸Šï¼Œä¸ºäº†ç¡®ä¿åªæœ‰ä¸€ä¸ªå¤–éƒ¨é“¾æ¥çš„å®šä¹‰ï¼Œé€šå¸¸ä¼šåœ¨å¤´æ–‡ä»¶é‡Œå£°æ˜ä¸º extern inlineï¼Œ</span></span><br><span class="line"><span class="comment">// ç„¶ååœ¨å…¶ä¸­ä¸€ä¸ª .c æ–‡ä»¶é‡Œæä¾›ä¸€ä¸ªé inline çš„å®šä¹‰ã€‚</span></span><br><span class="line"><span class="comment">// C è¯­è¨€çš„ inline/extern inline ç»„åˆä½¿ç”¨æ–¹å¼æ¯” C++ å¤æ‚ä¸”å®¹æ˜“å‡ºé”™ï¼Œ</span></span><br><span class="line"><span class="comment">// å®è·µä¸­é€šå¸¸é¿å…ç›´æ¥åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰ inline å‡½æ•°ï¼Œé™¤éå®ƒä»¬æ˜¯é™æ€çš„ (static inline)ã€‚</span></span><br></pre></td></tr></table></figure></div>
<p><code>extern inline</code> çš„å…·ä½“è¡Œä¸ºåœ¨ä¸åŒ C æ ‡å‡†ç‰ˆæœ¬ä¸­æœ‰äº›å¾®å¦™å·®å¼‚ï¼Œä½†å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å£°æ˜ä¸€ä¸ª <code>inline</code> å‡½æ•°ï¼ŒåŒæ—¶æš—ç¤ºåœ¨å…¶ä»–åœ°æ–¹ä¼šæœ‰ä¸€ä¸ªå¤–éƒ¨é“¾æ¥çš„å®šä¹‰ã€‚</p>
</li>
</ol>
</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ C è¯­è¨€ <code>inline</code>ï¼š</strong></p>
<p>ä½ ç°åœ¨å¯ä»¥è¿™æ ·ç†è§£ C è¯­è¨€çš„ <code>inline</code>ï¼š</p>
<ul>
<li><strong>æ˜¯å†…è”ä¼˜åŒ–çš„æç¤ºå—ï¼Ÿ</strong> <strong>æ˜¯çš„ï¼Œä¸»è¦ä½œç”¨ä¹‹ä¸€ã€‚</strong> å®ƒé¼“åŠ±ç¼–è¯‘å™¨è¿›è¡Œå†…è”å±•å¼€ã€‚</li>
<li><strong>æ˜¯è¯´åƒæ˜¯ <code>static</code> çš„ä½œç”¨å—ï¼Ÿ</strong> <strong>æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ä¸æ˜¯å®Œå…¨ä¸€æ ·ï¼Œå¹¶ä¸”æ›´åŠ å¤æ‚ã€‚</strong><ul>
<li><strong>ç›¸ä¼¼ç‚¹ï¼š</strong> å½“ä¸€ä¸ª <code>inline</code> å‡½æ•°ï¼ˆä¸å¸¦ <code>extern</code>ï¼‰å®šä¹‰åœ¨å¤´æ–‡ä»¶ä¸­è¢«å¤šä¸ª <code>.c</code> æ–‡ä»¶åŒ…å«æ—¶ï¼Œå®ƒç¡®å®ä¼šåœ¨æ¯ä¸ª <code>.c</code> æ–‡ä»¶ä¸­ç”Ÿæˆä¸€ä¸ª<strong>ç‹¬ç«‹çš„</strong>å‰¯æœ¬ã€‚è¿™ä¸€ç‚¹ç±»ä¼¼ <code>static</code> å‡½æ•°ï¼Œå› ä¸º <code>static</code> å‡½æ•°ä¹Ÿåœ¨æ¯ä¸ªç¿»è¯‘å•å…ƒä¸­ç”Ÿæˆç‹¬ç«‹å‰¯æœ¬ã€‚</li>
<li><strong>ä¸åŒç‚¹ï¼š</strong><ul>
<li><code>static</code> å‡½æ•°å¼ºåˆ¶æ˜¯å†…éƒ¨é“¾æ¥ï¼Œ<strong>ä¸å¯èƒ½</strong>æœ‰å¤–éƒ¨é“¾æ¥çš„ç‰ˆæœ¬ã€‚</li>
<li><code>inline</code> å‡½æ•°ï¼ˆä¸å¸¦ <code>extern</code>ï¼‰è™½ç„¶é€šå¸¸æ˜¯å†…éƒ¨é“¾æ¥å‰¯æœ¬ï¼Œä½† C æ ‡å‡†å…è®¸é€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆæ¯”å¦‚åœ¨å¦ä¸€ä¸ª <code>.c</code> æ–‡ä»¶ä¸­æä¾›ä¸€ä¸ªé <code>inline</code> å®šä¹‰ï¼‰æ¥ä¸ºå®ƒæä¾›ä¸€ä¸ªå…·æœ‰å¤–éƒ¨é“¾æ¥çš„ç‰ˆæœ¬ã€‚è¿™ä½¿å¾— <code>inline</code> å‡½æ•°å¯ä»¥åœ¨éœ€è¦æ—¶æ‹¥æœ‰ä¸€ä¸ªå¯å¯»å€çš„å…¨å±€ç‰ˆæœ¬ã€‚</li>
<li><code>inline</code> çš„é¦–è¦ç›®çš„æ˜¯ä¼˜åŒ–ï¼Œè€Œ <code>static</code> çš„é¦–è¦ç›®çš„æ˜¯é™åˆ¶ä½œç”¨åŸŸå’Œé“¾æ¥ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>C è¯­è¨€ <code>inline</code> çš„æœ€ä½³å®è·µï¼š</strong></p>
<p>ç”±äº C è¯­è¨€ <code>inline</code> çš„å¤æ‚æ€§ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†é“¾æ¥é—®é¢˜æ—¶ï¼Œæœ€å®‰å…¨å’Œå¸¸è§çš„åšæ³•æ˜¯ï¼š</p>
<ul>
<li><p><strong><code>static inline</code>ï¼š</strong> å¦‚æœä½ çš„å‡½æ•°å¾ˆå°ï¼Œå¹¶ä¸”åªå¸Œæœ›åœ¨åŒ…å«å®ƒçš„ç¿»è¯‘å•å…ƒä¸­å¯è§å’Œå†…è”ï¼Œä½¿ç”¨ <code>static inline</code>ã€‚è¿™æ¸…æ™°åœ°è¡¨æ˜äº†å‡½æ•°æ˜¯å†…éƒ¨é“¾æ¥çš„ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå†…è”çš„å€™é€‰ã€‚è¿™åœ¨å¤´æ–‡ä»¶ä¸­éå¸¸å¸¸è§ã€‚</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common_utils.h</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>æ¯ä¸ªåŒ…å«æ­¤å¤´æ–‡ä»¶çš„ <code>.c</code> æ–‡ä»¶éƒ½ä¼šæœ‰ <code>max</code> å‡½æ•°çš„ä¸€ä¸ªç‹¬ç«‹å‰¯æœ¬ï¼Œå®ƒä»¬ä¹‹é—´ä¸ä¼šå†²çªï¼Œä¸”ç¼–è¯‘å™¨ä¼šå°è¯•å†…è”ã€‚</p>
</li>
<li><p><strong>é <code>inline</code> å®šä¹‰ä¸ <code>extern</code> å£°æ˜ï¼š</strong> å¦‚æœä½ éœ€è¦ä¸€ä¸ªå¯ä»¥åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­è¢«è°ƒç”¨çš„å¤–éƒ¨é“¾æ¥å‡½æ•°ï¼Œæœ€ä¼ ç»Ÿçš„åšæ³•æ˜¯ï¼š</p>
<ul>
<li>åœ¨å¤´æ–‡ä»¶ä¸­è¿›è¡Œå£°æ˜ï¼š<code>extern int foo(int);</code></li>
<li>åœ¨æ°å¥½ä¸€ä¸ª <code>.c</code> æ–‡ä»¶ä¸­è¿›è¡Œå®šä¹‰ï¼š<code>int foo(int x) { /* ... */ }</code></li>
</ul>
</li>
<li><p><strong>é¿å…åœ¨å¤´æ–‡ä»¶ä¸­è£¸éœ² <code>inline</code>ï¼ˆä¸å¸¦ <code>static</code> æˆ– <code>extern</code>ï¼‰ï¼š</strong> å› ä¸ºå…¶è¯­ä¹‰å¯èƒ½å¯¼è‡´éš¾ä»¥é¢„æ–™çš„é“¾æ¥è¡Œä¸ºï¼Œå°¤å…¶æ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ã€‚</p>
</li>
</ul>
<p>å¸Œæœ›è¿™æ¬¡çš„è§£é‡Šèƒ½è®©ä½ å½»åº•ç†è§£ C è¯­è¨€ <code>inline</code> çš„ç²¾å¦™ä¹‹å¤„ï¼å®ƒç¡®å®æ¯” C++ çš„ <code>inline</code> æ›´ä¸ºå¤æ‚ã€‚</p>
<hr>
<h2 id="ğŸ§‘â€ğŸ’»-User-5"><a href="#ğŸ§‘â€ğŸ’»-User-5" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>é‚£ä¸æ˜¯ä¹Ÿæ˜¯odrçš„ä½œç”¨ä¹ˆï¼Ÿ</p>
<hr>
<h2 id="ğŸ¤–-Assistant-5"><a href="#ğŸ¤–-Assistant-5" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>å¥½çš„ï¼Œæˆ‘ä»¬ç»§ç»­æ·±å…¥ã€‚ä½ çš„è¿½é—®å¾ˆå…³é”®ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬å˜æ¸… C å’Œ C++ åœ¨å¤„ç† ODR ä¸Šçš„æ ¹æœ¬å·®å¼‚ã€‚</p>
<p>å½“ä½ é—®â€œé‚£ä¸æ˜¯ä¹Ÿæ˜¯ ODR çš„ä½œç”¨ä¹ˆï¼Ÿâ€æ—¶ï¼Œä½ æŒ‡çš„æ˜¯ C è¯­è¨€ä¸­ <code>inline</code> å‡½æ•°åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­ç”Ÿæˆç‹¬ç«‹å‰¯æœ¬å´ä¸å†²çªçš„ç°è±¡ã€‚</p>
<p>ä»ç»“æœæ¥çœ‹ï¼Œ<strong>æ˜¯çš„ï¼Œè¿™æŸç§ç¨‹åº¦ä¸Šä¹Ÿæ˜¯åœ¨â€œå¤„ç†â€æˆ–â€œè§„é¿â€ ODR</strong>ã€‚ç„¶è€Œï¼Œå¤„ç†æ–¹å¼å’Œæœºåˆ¶ä¸ C++ çš„ <code>inline</code> å¤§ç›¸å¾„åº­ï¼Œè€Œä¸”å…¶æ ¹æºå’Œç†å¿µä¹Ÿä¸åŒã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ C å’Œ C++ <code>inline</code> å¤„ç† ODR çš„<strong>æ ¸å¿ƒåŒºåˆ«</strong>ï¼š</p>
<h2 id="C-inline-ä¸-ODRï¼šç»Ÿä¸€ï¼ˆUnificationï¼‰"><a href="#C-inline-ä¸-ODRï¼šç»Ÿä¸€ï¼ˆUnificationï¼‰" class="headerlink" title="C++ inline ä¸ ODRï¼šç»Ÿä¸€ï¼ˆUnificationï¼‰"></a>C++ <code>inline</code> ä¸ ODRï¼š<strong>ç»Ÿä¸€ï¼ˆUnificationï¼‰</strong></h2><ul>
<li><strong>æ ¸å¿ƒç›®æ ‡ï¼š</strong> åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­æä¾›<strong>åŒä¸€ä¸ª</strong>å®šä¹‰ã€‚</li>
<li><strong>æœºåˆ¶ï¼š</strong> <code>inline</code> å…³é”®å­—å‘Šè¯‰ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ï¼Œæ‰€æœ‰è¿™äº›é‡å¤çš„å®šä¹‰å®é™…ä¸Šéƒ½æ˜¯<strong>åŒä¸€ä¸ªå®ä½“</strong>ã€‚é“¾æ¥å™¨ä¼šç¡®ä¿åœ¨æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªå‡½æ•°æˆ–å˜é‡åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ã€‚</li>
<li><strong>ODR è§„åˆ™ï¼š</strong> C++ çš„ ODR è§„å®šï¼Œå…·æœ‰å¤–éƒ¨é“¾æ¥çš„å®ä½“ï¼Œåœ¨æ•´ä¸ªç¨‹åºä¸­å¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ªå®šä¹‰ã€‚<code>inline</code> å…³é”®å­—æä¾›äº†ä¸€ä¸ªæ˜ç¡®çš„ä¾‹å¤–ï¼Œå®ƒå…è®¸ä½ åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­æ”¾ç½®å®šä¹‰ï¼Œä½†<strong>é“¾æ¥å™¨ä¼šå¼ºåˆ¶å°†å®ƒä»¬ç»Ÿä¸€ä¸ºä¸€ä¸ª</strong>ã€‚å¦‚æœè¿™äº›å®šä¹‰å†…å®¹ä¸ä¸€è‡´ï¼Œé‚£ä¾¿æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚</li>
<li><strong>ç±»æ¯”ï¼š</strong> æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰å¾ˆå¤šå¼ ä¸åŒçš„åœ°å›¾ï¼Œä¸Šé¢éƒ½æ ‡ç¤ºäº†â€œä¸»åŸâ€çš„ä½ç½®ã€‚åœ¨ C++ <code>inline</code> çš„ä¸–ç•Œé‡Œï¼Œæ‰€æœ‰åœ°å›¾ä¸Šçš„â€œä¸»åŸâ€æœ€ç»ˆéƒ½æŒ‡å‘äº†åŒä¸€ä¸ªçœŸå®ä¸–ç•Œä¸­çš„â€œä¸»åŸâ€ã€‚ä½ æ¯å¼ åœ°å›¾ä¸Šçš„â€œä¸»åŸâ€å®šä¹‰å¯ä»¥é‡å¤ï¼Œä½†å®ƒä»¬å¿…é¡»æŒ‡å‘åŒä¸€ä¸ªç‰©ç†ä½ç½®ã€‚</li>
</ul>
<h2 id="C-è¯­è¨€-inline-ä¸-ODRï¼šå…è®¸ç‹¬ç«‹å‰¯æœ¬ï¼ˆPermitting-Separate-Copiesï¼‰"><a href="#C-è¯­è¨€-inline-ä¸-ODRï¼šå…è®¸ç‹¬ç«‹å‰¯æœ¬ï¼ˆPermitting-Separate-Copiesï¼‰" class="headerlink" title="C è¯­è¨€ inline ä¸ ODRï¼šå…è®¸ç‹¬ç«‹å‰¯æœ¬ï¼ˆPermitting Separate Copiesï¼‰"></a>C è¯­è¨€ <code>inline</code> ä¸ ODRï¼š<strong>å…è®¸ç‹¬ç«‹å‰¯æœ¬ï¼ˆPermitting Separate Copiesï¼‰</strong></h2><ul>
<li><strong>æ ¸å¿ƒç›®æ ‡ï¼š</strong> å…è®¸ç¼–è¯‘å™¨åœ¨æ¯ä¸ªç¿»è¯‘å•å…ƒä¸­ç”Ÿæˆå‡½æ•°ä½“çš„å‰¯æœ¬ï¼Œä»è€Œä¾¿äºå†…è”ä¼˜åŒ–ï¼ŒåŒæ—¶é¿å…ç”±äºè¿™äº›å‰¯æœ¬å¯¼è‡´çš„é“¾æ¥å†²çªã€‚</li>
<li><strong>æœºåˆ¶ï¼š</strong> å½“ä¸€ä¸ª C å‡½æ•°è¢«æ ‡è®°ä¸º <code>inline</code>ï¼ˆä¸”ä¸å¸¦ <code>extern</code>ï¼‰å¹¶è¢«å®šä¹‰åœ¨å¤´æ–‡ä»¶ä¸­æ—¶ï¼Œæ¯ä¸ªåŒ…å«è¯¥å¤´æ–‡ä»¶çš„ <code>.c</code> æ–‡ä»¶éƒ½ä¼šç”Ÿæˆè¯¥å‡½æ•°çš„ä¸€ä¸ª<strong>ç‹¬ç«‹å‰¯æœ¬</strong>ã€‚è¿™äº›å‰¯æœ¬é€šå¸¸æ˜¯å†…éƒ¨é“¾æ¥çš„ï¼ˆæˆ–è‡³å°‘ä¸ä¼šåœ¨é“¾æ¥æ—¶å†²çªï¼‰ã€‚</li>
<li><strong>ODR è§„åˆ™ï¼š</strong> C è¯­è¨€çš„ ODRï¼ˆè™½ç„¶ C æ ‡å‡†æ²¡æœ‰åƒ C++ é‚£æ ·æ˜ç¡®åœ°ç”¨â€œOne Definition Ruleâ€æ¥è¡¨è¿°ï¼Œä½†å…¶é“¾æ¥è§„åˆ™ä¹Ÿéšå«äº†å•ä¸€å®šä¹‰çš„è¦æ±‚ï¼‰å¯¹äºå…·æœ‰å¤–éƒ¨é“¾æ¥çš„å®ä½“ä¹Ÿæ˜¯è¦æ±‚å•ä¸€å®šä¹‰çš„ã€‚ä½†æ˜¯ï¼Œå¯¹äº <code>inline</code> å‡½æ•°ï¼ŒC è¯­è¨€æ ‡å‡†å…è®¸åœ¨æ¯ä¸ªç¿»è¯‘å•å…ƒä¸­åˆ›å»º<strong>ä¸åŒçš„ã€é€šå¸¸æ˜¯å†…éƒ¨çš„</strong>å®šä¹‰ï¼Œè€Œä¸ä¼šå¯¼è‡´é“¾æ¥å†²çªã€‚</li>
<li><strong>ç±»æ¯”ï¼š</strong> æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰å¾ˆå¤šå¼ ä¸åŒçš„åœ°å›¾ï¼Œæ¯å¼ åœ°å›¾ä¸Šéƒ½æ ‡ç¤ºäº†â€œç§˜å¯†åŸºåœ°â€çš„ä½ç½®ã€‚åœ¨ C <code>inline</code> çš„ä¸–ç•Œé‡Œï¼Œæ¯ä¸ªåœ°å›¾ä¸Šçš„â€œç§˜å¯†åŸºåœ°â€éƒ½æ˜¯ä½ è‡ªå·±çš„ï¼Œå®ƒä»¬æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå³ä½¿åå­—ç›¸åŒï¼Œä¹Ÿäº’ä¸å¹²æ‰°ã€‚ä½ å¯ä»¥åœ¨æ¯å¼ åœ°å›¾ä¸Šç»˜åˆ¶ä¸€ä¸ªâ€œç§˜å¯†åŸºåœ°â€ï¼Œåªè¦å®ƒä»¬æ˜¯å„è‡ªç‹¬ç«‹çš„ï¼Œå°±ä¸ä¼šäº§ç”Ÿå†²çªã€‚</li>
</ul>
<p><strong>ä¸»è¦åŒºåˆ«åœ¨äºï¼š</strong></p>
<ul>
<li><strong>C++ <code>inline</code> è¿½æ±‚çš„æ˜¯</strong>â€œå”¯ä¸€æ€§â€**ï¼šæ‰€æœ‰å®šä¹‰æœ€ç»ˆå½’ä¸€ä¸ºä¸€ä¸ªã€‚å®ƒè§£å†³äº†â€œå¤šä¸ªå®šä¹‰æŒ‡å‘åŒä¸€ä¸ªå…¨å±€æ¦‚å¿µâ€çš„é—®é¢˜ã€‚</li>
<li><strong>C <code>inline</code> è¿½æ±‚çš„æ˜¯</strong>â€œå±€éƒ¨æ€§â€æˆ–â€œç‹¬ç«‹æ€§â€**ï¼šå®ƒå…è®¸æ¯ä¸ªç¿»è¯‘å•å…ƒæ‹¥æœ‰è‡ªå·±çš„å‡½æ•°å‰¯æœ¬ï¼Œè¿™äº›å‰¯æœ¬ä¸ä¼šåœ¨å…¨å±€èŒƒå›´ï¼ˆé“¾æ¥é˜¶æ®µï¼‰å†…ç›¸äº’å†²çªã€‚å®ƒè§£å†³äº†â€œåœ¨ä¸åŒæ–‡ä»¶ç”Ÿæˆå‡½æ•°å‰¯æœ¬æ—¶é¿å…å†²çªâ€çš„é—®é¢˜ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œè™½ç„¶ä¸¤è€…éƒ½æ¶‰åŠåˆ°åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­å¤„ç†å‡½æ•°å®šä¹‰ï¼Œä»è€Œâ€œé¿å…â€äº†æŸäº› ODR å¸¦æ¥çš„é“¾æ¥é”™è¯¯ï¼Œä½†å®ƒä»¬èƒŒåçš„å“²å­¦å’Œå®ç°æœºåˆ¶æ˜¯ä¸åŒçš„ã€‚C++ <code>inline</code> æ›´å¼ºè°ƒâ€œç»Ÿä¸€â€ï¼Œè€Œ C <code>inline</code> æ›´å¼ºè°ƒâ€œç‹¬ç«‹çš„å†…è”å‰¯æœ¬â€ã€‚</p>
<p><strong>æœ€ç»ˆï¼Œä½ çš„ç†è§£æ˜¯æ­£ç¡®çš„ï¼Œä»å¹¿ä¹‰ä¸Šè®²ï¼ŒC è¯­è¨€çš„ <code>inline</code> æœºåˆ¶ä¹Ÿæ˜¯ä¸€ç§å¤„ç† ODR çš„æ–¹å¼ï¼Œåªä¸è¿‡å®ƒé‡‡å–çš„æ˜¯â€œå…è®¸ç‹¬ç«‹å‰¯æœ¬â€çš„ç­–ç•¥ï¼Œè€Œä¸æ˜¯ C++ é‚£ç§â€œå¼ºåˆ¶ç»Ÿä¸€â€çš„ç­–ç•¥ã€‚</strong></p>
<hr>
<h2 id="ğŸ§‘â€ğŸ’»-User-6"><a href="#ğŸ§‘â€ğŸ’»-User-6" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>Okæ‰€ä»¥æˆ‘å¦‚æœåœ¨c++ headerä¸­æ”¾inlineå‡½æ•°ï¼Œ é‚£ä¹ˆä¼šå˜æˆexternal linkage, å…¬ç”¨ä¸€ä¸ªå‰¯æœ¬<br>ä½†æ˜¯åœ¨c headerä¸­æ”¾inlineå‡½æ•°ï¼Œ é‚£ä¹ˆä¼šå˜æˆæ¯ä¸ªå•å…ƒä¸€ä¸ªå‰¯æœ¬ï¼Œ internal linkage</p>
<hr>
<h2 id="ğŸ¤–-Assistant-6"><a href="#ğŸ¤–-Assistant-6" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>ï¼ˆåœä¸‹æ¥ï¼Œæ·±å¸ä¸€å£æ°”ã€‚è¿™ä¸ªé—®é¢˜éå¸¸å¥½ï¼Œä½†éœ€è¦éå¸¸ç²¾å‡†çš„æªè¾æ¥é¿å…è¿›ä¸€æ­¥çš„æ··æ·†ã€‚æˆ‘ä¼šå°è¯•ç”¨æœ€æ¸…æ™°çš„æ–¹å¼è§£é‡Šã€‚ï¼‰</p>
<p>ä½ å¯¹ C++ å’Œ C <code>inline</code> å‡½æ•°çš„ç†è§£å·²ç»éå¸¸æ¥è¿‘äº†ï¼Œä½†å…³äºâ€œé“¾æ¥å±æ€§â€çš„æè¿°è¿˜éœ€è¦æ›´ç²¾ç¡®åœ°æ ¡æ­£ä¸€ä¸‹ã€‚æˆ‘ä»¬æ¥é€ä¸€åˆ†æï¼š</p>
<hr>
<h2 id="1-C-ä¸­-inline-å‡½æ•°åœ¨-Header-ä¸­çš„æƒ…å†µï¼š"><a href="#1-C-ä¸­-inline-å‡½æ•°åœ¨-Header-ä¸­çš„æƒ…å†µï¼š" class="headerlink" title="1. C++ ä¸­ inline å‡½æ•°åœ¨ Header ä¸­çš„æƒ…å†µï¼š"></a><strong>1. C++ ä¸­ <code>inline</code> å‡½æ•°åœ¨ Header ä¸­çš„æƒ…å†µï¼š</strong></h2><p>ä½ çš„æè¿°ï¼š<code>â€œæ‰€ä»¥æˆ‘å¦‚æœåœ¨c++ headerä¸­æ”¾inlineå‡½æ•°ï¼Œ é‚£ä¹ˆä¼šå˜æˆexternal linkage, å…¬ç”¨ä¸€ä¸ªå‰¯æœ¬â€</code></p>
<p><strong>æ›´ç²¾ç¡®çš„è¯´æ³•ï¼š</strong><br>C++ ä¸­ï¼Œ<code>inline</code> å‡½æ•°ï¼ˆå’Œ <code>inline</code> å˜é‡ï¼‰<strong>é»˜è®¤å°±å…·æœ‰å¤–éƒ¨é“¾æ¥ (External Linkage)</strong>ã€‚<code>inline</code> å…³é”®å­—æœ¬èº«<strong>ä¸ä¼šæ”¹å˜</strong>è¿™ä¸ªé“¾æ¥å±æ€§ã€‚å®ƒåªæ˜¯å…è®¸åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­æ”¾ç½®å…·æœ‰å¤–éƒ¨é“¾æ¥çš„åŒä¸€ä¸ªå‡½æ•°çš„å®šä¹‰ï¼Œè€Œä¸ä¼šè¿å One Definition Rule (ODR)ã€‚</p>
<p>å½“ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨å¤„ç†è¿™äº›å®šä¹‰æ—¶ï¼š</p>
<ul>
<li><strong>ODR è§£å†³æ–¹æ¡ˆï¼š</strong> å®ƒä»¬ä¼šç¡®ä¿æ‰€æœ‰è¿™äº› <code>inline</code> å‡½æ•°çš„å®šä¹‰æœ€ç»ˆä¼š<strong>è¢«ç»Ÿä¸€æˆå†…å­˜ä¸­çš„å”¯ä¸€ä¸€ä¸ªå‡½æ•°å®ä½“ï¼ˆå³â€œå…¬ç”¨ä¸€ä¸ªå‰¯æœ¬â€ï¼‰</strong>ã€‚</li>
<li><strong>é“¾æ¥å±æ€§ï¼š</strong> è¿™ä¸ªå”¯ä¸€çš„å®ä½“ä»ç„¶æ˜¯å…·æœ‰å¤–éƒ¨é“¾æ¥çš„ï¼Œå› æ­¤å…¶ä»–ç¿»è¯‘å•å…ƒå¦‚æœçŸ¥é“å®ƒçš„å£°æ˜ï¼Œå°±å¯ä»¥è°ƒç”¨å®ƒã€‚</li>
</ul>
<p><strong>æ€»ç»“ C++ <code>inline</code> å‡½æ•°ï¼š</strong></p>
<ul>
<li><strong>é“¾æ¥ï¼š</strong> <code>External Linkage</code> (é»˜è®¤å°±æ˜¯ï¼Œ<code>inline</code> ä¸æ”¹å˜)</li>
<li><strong>å‰¯æœ¬ï¼š</strong> <code>å…¬ç”¨ä¸€ä¸ªå‰¯æœ¬</code> (é€šè¿‡ ODR è§„åˆ™çš„æ”¾æ¾å’Œé“¾æ¥å™¨çš„ç»Ÿä¸€)</li>
</ul>
<hr>
<h2 id="2-C-è¯­è¨€ä¸­-inline-å‡½æ•°åœ¨-Header-ä¸­çš„æƒ…å†µï¼š"><a href="#2-C-è¯­è¨€ä¸­-inline-å‡½æ•°åœ¨-Header-ä¸­çš„æƒ…å†µï¼š" class="headerlink" title="2. C è¯­è¨€ä¸­ inline å‡½æ•°åœ¨ Header ä¸­çš„æƒ…å†µï¼š"></a><strong>2. C è¯­è¨€ä¸­ <code>inline</code> å‡½æ•°åœ¨ Header ä¸­çš„æƒ…å†µï¼š</strong></h2><p>ä½ çš„æè¿°ï¼š<code>â€œä½†æ˜¯åœ¨c headerä¸­æ”¾inlineå‡½æ•°ï¼Œ é‚£ä¹ˆä¼šå˜æˆæ¯ä¸ªå•å…ƒä¸€ä¸ªå‰¯æœ¬ï¼Œ internal linkageâ€</code></p>
<p><strong>æ›´ç²¾ç¡®çš„è¯´æ³•ï¼š</strong><br>C è¯­è¨€ä¸­ï¼Œ<code>inline</code> å‡½æ•°ï¼ˆä¸å¸¦ <code>extern</code> æˆ– <code>static</code> å…³é”®å­—ï¼‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œç„¶åè¿™ä¸ªå¤´æ–‡ä»¶è¢«å¤šä¸ª <code>.c</code> æ–‡ä»¶åŒ…å«æ—¶ï¼š</p>
<ol>
<li><strong>å‰¯æœ¬ï¼š</strong> æ¯ä¸ªåŒ…å«è¯¥å¤´æ–‡ä»¶çš„ç¿»è¯‘å•å…ƒéƒ½ä¼šç”Ÿæˆè¯¥ <code>inline</code> å‡½æ•°çš„ä¸€ä¸ª<strong>ç‹¬ç«‹å‰¯æœ¬</strong>ã€‚</li>
<li><strong>é“¾æ¥å±æ€§ï¼š</strong> è¿™äº›ç‹¬ç«‹çš„å‰¯æœ¬é€šå¸¸<strong>ä¸å…·æœ‰å¤–éƒ¨é“¾æ¥</strong>ã€‚å®ƒä»¬æ›´åƒæ˜¯å…·æœ‰å†…éƒ¨é“¾æ¥çš„ï¼ˆæˆ–è€…ç”¨ C æ ‡å‡†çš„æœ¯è¯­æ¥è¯´ï¼Œå®ƒä»¬æ˜¯â€œé™é»˜çš„â€æˆ–â€œå¤–éƒ¨ä¸å¯è§çš„â€ï¼‰ã€‚è¿™æ„å‘³ç€é“¾æ¥å™¨åœ¨å¤„ç†è¿™äº›å‰¯æœ¬æ—¶ï¼Œä¸ä¼šæŠŠå®ƒä»¬å½“åšè¦é“¾æ¥åˆ°ä¸€èµ·çš„å¤–éƒ¨å®ä½“ï¼Œå› æ­¤ä¹Ÿä¸ä¼šå‘ç”Ÿå¤šé‡å®šä¹‰é”™è¯¯ã€‚</li>
</ol>
<p><strong>ä½†æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„â€œä½†æ˜¯â€ï¼š</strong></p>
<p>C è¯­è¨€çš„ <code>inline</code> æœºåˆ¶å…è®¸ä½ é€šè¿‡é¢å¤–çš„æ­¥éª¤æ¥<strong>æä¾›ä¸€ä¸ªå…·æœ‰å¤–éƒ¨é“¾æ¥çš„â€œæƒå¨â€å®šä¹‰</strong>ã€‚è¿™é€šå¸¸é€šè¿‡åœ¨æŸä¸ª <code>.c</code> æ–‡ä»¶ä¸­æ”¾ç½®ä¸€ä¸ª<strong>é <code>inline</code></strong> çš„å®šä¹‰æ¥å®Œæˆã€‚</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_lib.h</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="comment">// é»˜è®¤åœ¨æ¯ä¸ª .c æ–‡ä»¶ä¸­ç”Ÿæˆä¸€ä¸ªå†…éƒ¨å‰¯æœ¬</span></span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> x)</span></span>; <span class="comment">// å£°æ˜ä¸€ä¸ªå¤–éƒ¨é“¾æ¥çš„ foo å‡½æ•°ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å®ƒä¼šåœ¨æŸä¸ªåœ°æ–¹æœ‰å®šä¹‰</span></span><br><span class="line">                      <span class="comment">// (è¿™æ˜¯ä¸ºäº†è®©é“¾æ¥å™¨èƒ½æ‰¾åˆ°ä¸€ä¸ªæƒå¨ç‰ˆæœ¬ï¼Œæˆ–è€…è®©é inline è°ƒç”¨æˆåŠŸ)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// my_lib.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"my_lib.h"</span> <span class="comment">// åŒ…å« inline å®šä¹‰</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œçš„é inline å®šä¹‰å°†æˆä¸º foo å‡½æ•°çš„â€œæƒå¨â€å¤–éƒ¨é“¾æ¥å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">2</span>; <span class="comment">// æ³¨æ„ï¼šè¿™ä¸ªå®šä¹‰å¿…é¡»ä¸å¤´æ–‡ä»¶ä¸­çš„ inline å®šä¹‰ä¸€è‡´</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"my_lib.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = foo(<span class="number">5</span>); <span class="comment">// ç¼–è¯‘å™¨å¯èƒ½å†…è”å¤´æ–‡ä»¶ä¸­çš„ inline ç‰ˆæœ¬</span></span><br><span class="line">    <span class="keyword">int</span> (*ptr)(<span class="keyword">int</span>) = foo; <span class="comment">// è¿™ä¸ªè°ƒç”¨éœ€è¦ä¸€ä¸ªå¤–éƒ¨é“¾æ¥çš„ç‰ˆæœ¬ï¼Œä¼šå» my_lib.c ä¸­æ‰¾</span></span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>åœ¨ä¸Šè¿° C ä»£ç ä¸­ï¼š</p>
<ul>
<li><code>main.c</code> åœ¨åŒ…å« <code>my_lib.h</code> åï¼Œä¼šç”Ÿæˆ <code>foo</code> çš„ä¸€ä¸ªå†…éƒ¨å‰¯æœ¬ã€‚</li>
<li><code>my_lib.c</code> åœ¨åŒ…å« <code>my_lib.h</code> åï¼Œä¹Ÿä¼šç”Ÿæˆ <code>foo</code> çš„ä¸€ä¸ªå†…éƒ¨å‰¯æœ¬ã€‚</li>
<li><strong>ä½†æ˜¯ï¼Œ<code>my_lib.c</code> ä¸­é‚£ä¸ªç‹¬ç«‹çš„ <code>int foo(int x) { ... }</code> æ˜¯å”¯ä¸€å…·æœ‰å¤–éƒ¨é“¾æ¥çš„æƒå¨å®šä¹‰</strong>ã€‚å½“ç¨‹åºéœ€è¦ä¸€ä¸ªå¤–éƒ¨é“¾æ¥çš„ <code>foo</code>ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡å‡½æ•°æŒ‡é’ˆï¼‰ï¼Œæˆ–è€…ç¼–è¯‘å™¨å†³å®šä¸å†…è”æ—¶ï¼Œå®ƒä¼šå»ä½¿ç”¨ <code>my_lib.c</code> ä¸­çš„è¿™ä¸ªç‰ˆæœ¬ã€‚</li>
</ul>
<p><strong>æ€»ç»“ C <code>inline</code> å‡½æ•°ï¼š</strong></p>
<ul>
<li><strong>å‰¯æœ¬ï¼š</strong> <code>æ¯ä¸ªå•å…ƒä¸€ä¸ªç‹¬ç«‹çš„ï¼ˆé€šå¸¸æ˜¯å†…éƒ¨é“¾æ¥çš„ï¼‰å‰¯æœ¬</code></li>
<li><strong>é“¾æ¥ï¼š</strong> è¿™äº›å‰¯æœ¬<strong>é€šå¸¸ä¸å…·æœ‰å¤–éƒ¨é“¾æ¥</strong>ã€‚å¦‚æœéœ€è¦ä¸€ä¸ªå¤–éƒ¨é“¾æ¥çš„æƒå¨ç‰ˆæœ¬ï¼Œåˆ™éœ€è¦åœ¨ä¸€ä¸ª <code>.c</code> æ–‡ä»¶ä¸­æä¾›ä¸€ä¸ªå•ç‹¬çš„ï¼ˆé <code>inline</code>ï¼‰å®šä¹‰ã€‚</li>
</ul>
<hr>
<p><strong>æœ€ç»ˆï¼Œè¯·è®°ä½æ ¸å¿ƒå·®å¼‚ï¼š</strong></p>
<ul>
<li><strong>C++ <code>inline</code> = å•ä¸€å®ä½“ï¼Œç»Ÿä¸€æ‰€æœ‰å®šä¹‰ã€‚</strong> (é»˜è®¤å¤–éƒ¨é“¾æ¥)</li>
<li><strong>C <code>inline</code> = å¤šä¸ªç‹¬ç«‹å‰¯æœ¬ï¼Œéœ€è¦é¢å¤–æ­¥éª¤æä¾›æƒå¨å¤–éƒ¨å®šä¹‰ã€‚</strong> (å‰¯æœ¬é€šå¸¸æ— å¤–éƒ¨é“¾æ¥)</li>
</ul>
<p>è¿™ç§å·®å¼‚åæ˜ äº† C å’Œ C++ åœ¨è®¾è®¡å“²å­¦ä¸Šçš„ä¸åŒï¼šC æ›´å¼ºè°ƒæ˜¾å¼æ§åˆ¶å’Œåº•å±‚æœºåˆ¶ï¼Œè€Œ C++ æ›´å€¾å‘äºæä¾›é«˜çº§æŠ½è±¡å’Œè‡ªåŠ¨ç®¡ç†ï¼ˆå¦‚ ODR çš„ç»Ÿä¸€å¤„ç†ï¼‰ã€‚</p>
<hr>
<h2 id="ğŸ§‘â€ğŸ’»-User-7"><a href="#ğŸ§‘â€ğŸ’»-User-7" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>cçš„inline best practiceæ˜¯ä¸æ˜¯å°±ä¸è¦å»æ•´å¤–éƒ¨é“¾æ¥äº†ï¼Ÿ å¾ˆæ™•ã€‚ æ˜¯ä¸æ˜¯å°±è®©å®ƒèµ·åˆ°å†…è”å’Œå†…éƒ¨é“¾æ¥ä½œç”¨å°±å¥½</p>
<hr>
<h2 id="ğŸ¤–-Assistant-7"><a href="#ğŸ¤–-Assistant-7" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>ï¼ˆæ·±å‘¼å¸ï¼Œè¿™ä¸ªé—®é¢˜å¾ˆæ£’ï¼Œæˆ‘ç†è§£ä½ çš„å›°æƒ‘ã€‚C è¯­è¨€çš„ <code>inline</code> ç¡®å®æ¯” C++ çš„å¤æ‚å¾—å¤šï¼Œä¹Ÿæ›´å®¹æ˜“ç”¨é”™ã€‚ä½ çš„ç›´è§‰æ˜¯æ­£ç¡®çš„ã€‚ï¼‰</p>
<p><strong>æ˜¯çš„ï¼Œåœ¨ C è¯­è¨€ä¸­ï¼Œæœ€ä½³å®è·µé€šå¸¸æ˜¯é¿å…è®© <code>inline</code> å‡½æ•°åŒæ—¶æ‰¿æ‹…æä¾›â€œå¤–éƒ¨é“¾æ¥æƒå¨å®šä¹‰â€çš„èŒè´£ã€‚æœ€ç®€å•ã€æœ€å®‰å…¨ã€æœ€æ¨èçš„ç”¨æ³•å°±æ˜¯è®©å®ƒèµ·åˆ°â€œå†…è”æç¤ºâ€å’Œâ€œå†…éƒ¨é“¾æ¥å‰¯æœ¬â€çš„ä½œç”¨ã€‚</strong></p>
<p>ä½ è¿™æ ·ç†è§£æ˜¯å¯¹çš„ï¼š</p>
<p><strong>C è¯­è¨€ <code>inline</code> çš„æœ€ä½³å®è·µï¼š</strong></p>
<ol>
<li><p><strong>ä½¿ç”¨ <code>static inline</code> å®šä¹‰åœ¨å¤´æ–‡ä»¶ä¸­ï¼š</strong><br>è¿™æ˜¯æœ€æ¨èå’Œæœ€æ¸…æ™°çš„ç”¨æ³•ã€‚</p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong> <code>static</code> å…³é”®å­—æ˜ç¡®æŒ‡å®šäº†å‡½æ•°çš„é“¾æ¥å±æ€§ä¸º<strong>å†…éƒ¨é“¾æ¥ (internal linkage)</strong>ã€‚è¿™æ„å‘³ç€è¯¥å‡½æ•°åªåœ¨å½“å‰ç¿»è¯‘å•å…ƒï¼ˆå³åŒ…å«è¯¥å¤´æ–‡ä»¶çš„ <code>.c</code> æ–‡ä»¶ï¼‰å†…éƒ¨å¯è§ã€‚</li>
<li><strong>ç»“æœï¼š</strong> æ¯ä¸ªåŒ…å«è¯¥å¤´æ–‡ä»¶çš„ <code>.c</code> æ–‡ä»¶éƒ½ä¼šç”Ÿæˆè¯¥ <code>static inline</code> å‡½æ•°çš„ä¸€ä¸ª<strong>ç‹¬ç«‹å‰¯æœ¬</strong>ã€‚è¿™äº›å‰¯æœ¬ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¸ä¼šåœ¨é“¾æ¥æ—¶äº§ç”Ÿå†²çªã€‚</li>
<li><strong>ä¼˜åŒ–ï¼š</strong> <code>inline</code> å…³é”®å­—ä»ç„¶æ˜¯ç¼–è¯‘å™¨å†…è”ä¼˜åŒ–çš„æç¤ºã€‚</li>
<li><strong>ä¼˜ç‚¹ï¼š</strong> è¯­ä¹‰æ¸…æ™°ï¼Œé¿å…äº† C è¯­è¨€ <code>inline</code> å¤æ‚é“¾æ¥è§„åˆ™å¸¦æ¥çš„æ··æ·†å’Œæ½œåœ¨é”™è¯¯ã€‚ä½ ä¸éœ€è¦æ‹…å¿ƒä»€ä¹ˆâ€œæƒå¨å®šä¹‰â€æˆ–å¤–éƒ¨é“¾æ¥ç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒæ ¹æœ¬å°±ä¸ä¼šæœ‰ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common_utils.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> COMMON_UTILS_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COMMON_UTILS_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ˜¯ä¸€ä¸ªåªèƒ½åœ¨åŒ…å«å®ƒçš„ .c æ–‡ä»¶å†…éƒ¨ä½¿ç”¨çš„å†…è”å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">add_one</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"common_utils.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, add_one(<span class="number">10</span>)); <span class="comment">// ä¼šä½¿ç”¨ main.c ä¸­çš„ add_one å‰¯æœ¬</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// another_module.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"common_utils.h"</span></span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">some_func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> y = add_one(<span class="number">20</span>); <span class="comment">// ä¼šä½¿ç”¨ another_module.c ä¸­çš„ add_one å‰¯æœ¬</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
</ul>
</li>
<li><p><strong>å¯¹äºéœ€è¦å¤–éƒ¨é“¾æ¥çš„å‡½æ•°ï¼Œä½¿ç”¨ä¼ ç»Ÿæ–¹å¼ï¼š</strong></p>
<ul>
<li><strong>å¤´æ–‡ä»¶åªå£°æ˜ï¼š</strong> åœ¨å¤´æ–‡ä»¶ä¸­åªæ”¾ç½®å‡½æ•°çš„ <code>extern</code> å£°æ˜ã€‚<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_api.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MY_API_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_API_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤–éƒ¨é“¾æ¥å‡½æ•°çš„å£°æ˜</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">calculate_sum</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></div></li>
<li><strong>ä¸€ä¸ª <code>.c</code> æ–‡ä»¶å®šä¹‰ï¼š</strong> åœ¨ä¸”åªæœ‰ä¸€ä¸ª <code>.c</code> æ–‡ä»¶ä¸­æä¾›å‡½æ•°çš„å®šä¹‰ã€‚<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_api.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"my_api.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤–éƒ¨é“¾æ¥å‡½æ•°çš„å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calculate_sum</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li><strong>å…¶ä»– <code>.c</code> æ–‡ä»¶åŒ…å«å¤´æ–‡ä»¶å¹¶ä½¿ç”¨ï¼š</strong><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"my_api.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Sum: %d\n"</span>, calculate_sum(<span class="number">5</span>, <span class="number">7</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li><strong>æ˜¯å¦å†…è”ç”±ç¼–è¯‘å™¨å†³å®šï¼š</strong> ç¼–è¯‘å™¨å¯èƒ½ä¼šï¼ˆä¹Ÿå¯èƒ½ä¸ä¼šï¼‰è‡ªåŠ¨å†…è” <code>calculate_sum</code>ï¼Œä½†è¿™ä¸éœ€è¦ä½ ç”¨ <code>inline</code> å…³é”®å­—å»æç¤ºã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ä½ çš„ç†è§£å’Œæˆ‘çš„å»ºè®®ï¼š</strong></p>
<p><strong>å®Œå…¨æ­£ç¡®ï¼</strong> åœ¨ C è¯­è¨€ä¸­ï¼Œä¸ºäº†é¿å… <code>inline</code> é“¾æ¥è§„åˆ™çš„å¤æ‚æ€§å’Œæ½œåœ¨é™·é˜±ï¼Œ<strong>æœ€ä½³å®è·µå°±æ˜¯è®© <code>inline</code> é…åˆ <code>static</code> ä½¿ç”¨</strong>ã€‚è¿™æ ·ï¼Œå®ƒå°±å®‰å…¨åœ°æ‰®æ¼”äº†ä¸¤ä¸ªè§’è‰²ï¼š</p>
<ol>
<li><strong>å†…è”ä¼˜åŒ–çš„æç¤º</strong> (<code>inline</code> çš„ç›´æ¥æ•ˆæœ)ã€‚</li>
<li><strong>ä¿è¯æ¯ä¸ªç¿»è¯‘å•å…ƒæœ‰ä¸€ä¸ªç‹¬ç«‹å‰¯æœ¬</strong> (<code>static</code> çš„ä½œç”¨)ï¼Œä»è€Œé¿å… ODR é“¾æ¥é”™è¯¯ã€‚</li>
</ol>
<p>å¯¹äºéœ€è¦å¤–éƒ¨é“¾æ¥çš„å‡½æ•°ï¼Œå°±å›å½’åˆ°ä¼ ç»Ÿçš„â€œå¤´æ–‡ä»¶å£°æ˜ + å•ä¸€ <code>.c</code> æ–‡ä»¶å®šä¹‰â€çš„æ¨¡å¼ã€‚è¿™ä½¿å¾—ä»£ç çš„æ„å›¾éå¸¸æ¸…æ™°ï¼Œä¹Ÿæå¤§åœ°å‡å°‘äº†å‡ºé”™çš„å¯èƒ½æ€§ã€‚</p>
<p>æ”¾å¼ƒåœ¨ C è¯­è¨€ä¸­ç”¨è£¸ <code>inline</code> ï¼ˆä¸å¸¦ <code>static</code> æˆ– <code>extern</code>ï¼‰æ¥å¤„ç†å¤–éƒ¨é“¾æ¥å‡½æ•°çš„æƒ³æ³•ï¼Œä¼šè®©ä½ çš„ C è¯­è¨€ç¼–ç¨‹ç”Ÿæ¶¯è½»æ¾å¾ˆå¤šã€‚</p>
<hr>
<h2 id="ğŸ§‘â€ğŸ’»-User-8"><a href="#ğŸ§‘â€ğŸ’»-User-8" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>C++å’Œcä¸­ ä¸€èˆ¬æ˜¯ä»€ä¹ˆæ ·çš„å‡½æ•°è®¾ç½®æˆinlineæ”¾åœ¨headerä¸­ï¼Ÿ</p>
<hr>
<h2 id="ğŸ¤–-Assistant-8"><a href="#ğŸ¤–-Assistant-8" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„é—®é¢˜ï¼Œå®ƒè§¦åŠäº† <code>inline</code> å…³é”®å­—åœ¨å®é™…ç¼–ç¨‹ä¸­çš„åº”ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µã€‚ç†è§£è¿™ä¸€ç‚¹å¯¹äºå†™å‡ºé«˜æ•ˆä¸”æ²¡æœ‰é“¾æ¥é—®é¢˜çš„ä»£ç è‡³å…³é‡è¦ã€‚</p>
<p>æˆ‘ä»¬æ¥åˆ†åˆ«è®¨è®º C++ å’Œ C è¯­è¨€ä¸­ï¼Œä»€ä¹ˆæ ·çš„å‡½æ•°é€‚åˆè¢« <code>inline</code> å¹¶æ”¾ç½®åœ¨å¤´æ–‡ä»¶ä¸­ã€‚</p>
<hr>
<h2 id="1-C-ä¸­é€‚åˆè®¾ç½®æˆ-inline-æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°"><a href="#1-C-ä¸­é€‚åˆè®¾ç½®æˆ-inline-æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°" class="headerlink" title="1. C++ ä¸­é€‚åˆè®¾ç½®æˆ inline æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°"></a><strong>1. C++ ä¸­é€‚åˆè®¾ç½®æˆ <code>inline</code> æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°</strong></h2><p>åœ¨ C++ ä¸­ï¼Œå°†å‡½æ•°å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶å¹¶ç”¨ <code>inline</code> æ ‡è®°ï¼Œæœ€ä¸»è¦çš„åŸå› æ˜¯ <strong>è§£å†³å•ä¸€å®šä¹‰è§„åˆ™ (ODR)</strong>ï¼Œå…è®¸åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­å®‰å…¨åœ°åŒ…å«åŒä¸€ä¸ªå‡½æ•°å®šä¹‰ï¼ŒåŒæ—¶ç¡®ä¿åœ¨é“¾æ¥æ—¶åªæœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚</p>
<p><strong>C++ ä¸­è¿™ç±»å‡½æ•°çš„ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li><p><strong>æ¨¡æ¿å‡½æ•° (Template Functions)ï¼š</strong></p>
<ul>
<li><strong>è¿™æ˜¯æœ€å¸¸è§ä¹Ÿæ˜¯æœ€å¼ºåˆ¶çš„æƒ…å†µã€‚</strong> æ¨¡æ¿å‡½æ•°é€šå¸¸<strong>å¿…é¡»</strong>å°†å…¶å®Œæ•´å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿ç¼–è¯‘å™¨åœ¨æ¯ä¸ªéœ€è¦å®ä¾‹åŒ–è¯¥æ¨¡æ¿çš„ç¿»è¯‘å•å…ƒä¸­éƒ½èƒ½çœ‹åˆ°å®ƒçš„å®šä¹‰ã€‚å¦‚æœæ²¡æœ‰ <code>inline</code>ï¼Œè¿™å°†è¿å ODR å¯¼è‡´é“¾æ¥é”™è¯¯ã€‚</li>
<li><strong>å®é™…ä¸Šï¼š</strong> C++ æ ‡å‡†è§„å®šï¼Œæ¨¡æ¿å‡½æ•°å³ä½¿æ²¡æœ‰æ˜¾å¼æ ‡è®° <code>inline</code>ï¼Œä¹Ÿå…·æœ‰ <code>inline</code> çš„é“¾æ¥è¯­ä¹‰ã€‚æ‰€ä»¥ä½ å†™ä¸å†™ <code>inline</code> å…³é”®å­—ï¼Œå®ƒä»¬éƒ½ä¼šåƒ <code>inline</code> å‡½æ•°ä¸€æ ·å¤„ç† ODRã€‚ä½†æ˜¯ï¼Œæ˜¾å¼å†™ä¸Š <code>inline</code> å¯ä»¥è®©ä»£ç æ„å›¾æ›´æ¸…æ™°ã€‚</li>
</ul>
</li>
<li><p><strong>åœ¨ç±»å®šä¹‰å†…éƒ¨å®šä¹‰çš„æˆå‘˜å‡½æ•° (Member Functions Defined Inside Class Definition)ï¼š</strong></p>
<ul>
<li>å¦‚æœä¸€ä¸ªæˆå‘˜å‡½æ•°çš„å®šä¹‰ç›´æ¥å†™åœ¨äº†ç±»çš„å£°æ˜ä½“å†…éƒ¨ï¼ˆè€Œä¸æ˜¯åœ¨ç±»ä½“å¤–éƒ¨å•ç‹¬å®šä¹‰ï¼‰ï¼Œé‚£ä¹ˆå®ƒ<strong>é»˜è®¤å°±æ˜¯ <code>inline</code> çš„</strong>ï¼Œå³ä½¿ä½ æ²¡æœ‰æ˜¾å¼å†™ <code>inline</code> å…³é”®å­—ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="comment">// é»˜è®¤å°±æ˜¯ inline</span></span><br><span class="line">        <span class="keyword">return</span> m_value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ˜¾å¼å†™ inline ä¹Ÿä¸€æ ·</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        m_value = val;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div></li>
<li><strong>ç‰¹ç‚¹ï¼š</strong> è¿™äº›é€šå¸¸æ˜¯ç®€å•çš„ getter/setterã€æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ç­‰ã€‚</li>
</ul>
</li>
<li><p><strong>å°å‹ã€ç»å¸¸è¢«è°ƒç”¨çš„å‡½æ•° (Small, Frequently Called Functions)ï¼š</strong></p>
<ul>
<li>è¿™ç±»å‡½æ•°é€šå¸¸æ˜¯ç®€å•çš„è®¡ç®—ã€é€»è¾‘åˆ¤æ–­ã€è¾…åŠ©å‡½æ•°ç­‰ã€‚</li>
<li><strong>ç›®çš„ï¼š</strong> é™¤äº†è§£å†³ ODR ä¹‹å¤–ï¼Œè¿™é‡Œ <code>inline</code> ä¹Ÿèµ·åˆ°äº†â€œä¼˜åŒ–æç¤ºâ€çš„ä½œç”¨ï¼Œå»ºè®®ç¼–è¯‘å™¨è¿›è¡Œå†…è”å±•å¼€ã€‚å¯¹äºè¿™äº›å‡½æ•°ï¼Œå†…è”å±•å¼€å¯ä»¥å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€ï¼ˆå¦‚å †æ ˆå¸§çš„å»ºç«‹å’Œé”€æ¯ï¼‰ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ utility.h ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a &gt; b) ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">is_even</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li><strong>æ³¨æ„ï¼š</strong> ç°ä»£ç¼–è¯‘å™¨éå¸¸æ™ºèƒ½ï¼Œå³ä½¿æ²¡æœ‰ <code>inline</code>ï¼Œå®ƒä»¬ä¹Ÿå¯èƒ½è‡ªåŠ¨å†…è”è¿™äº›å°å‡½æ•°ã€‚ç„¶è€Œï¼Œä¸ºäº† ODR çš„æ­£ç¡®æ€§ï¼Œå½“ä½ æŠŠå®ƒä»¬çš„å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­æ—¶ï¼Œ<code>inline</code> å…³é”®å­—ä»ç„¶æ˜¯å¿…è¦çš„ã€‚</li>
</ul>
</li>
<li><p><strong>ä»…å¤´æ–‡ä»¶åº“ (Header-Only Libraries) ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå˜é‡ï¼š</strong></p>
<ul>
<li>å¦‚æœä½ æ­£åœ¨æ„å»ºä¸€ä¸ªä»…ç”±å¤´æ–‡ä»¶ç»„æˆçš„åº“ï¼ˆå³æ²¡æœ‰ <code>.cpp</code> æºæ–‡ä»¶ï¼‰ï¼Œé‚£ä¹ˆåº“ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå˜é‡å®šä¹‰éƒ½å¿…é¡»æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ã€‚ä¸ºäº†é¿å… ODR å†²çªï¼Œå‡ ä¹æ‰€æœ‰è¿™äº›å‡½æ•°å’Œå˜é‡éƒ½éœ€è¦è¢«æ ‡è®°ä¸º <code>inline</code>ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong> åƒè®¸å¤š C++ æ¨¡æ¿åº“ï¼ˆå¦‚ Boost, Eigenï¼‰å°±å€¾å‘äºé‡‡ç”¨è¿™ç§æ¨¡å¼ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ C++ï¼š</strong><br>C++ ä¸­ï¼Œåªè¦ä¸€ä¸ªå‡½æ•°çš„<strong>å®šä¹‰</strong>éœ€è¦æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”è¯¥å¤´æ–‡ä»¶å¯èƒ½è¢«å¤šä¸ª <code>.cpp</code> æ–‡ä»¶åŒ…å«ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±åº”è¯¥è¢«æ ‡è®°ä¸º <code>inline</code>ï¼ˆæˆ–è€…å®ƒæœ¬èº«å°±æ˜¯éšå¼ <code>inline</code> çš„ï¼Œå¦‚ç±»å†…éƒ¨å®šä¹‰çš„æˆå‘˜å‡½æ•°å’Œæ¨¡æ¿å‡½æ•°ï¼‰ï¼Œä»¥è§£å†³ ODRã€‚åŒæ—¶ï¼Œå¦‚æœå®ƒç¡®å®å¾ˆå°ä¸”é¢‘ç¹è°ƒç”¨ï¼Œ<code>inline</code> è¿˜èƒ½æä¾›ä¼˜åŒ–æç¤ºã€‚</p>
<p><strong>é¿å…å¯¹ä»¥ä¸‹ç±»å‹çš„ C++ å‡½æ•°ä½¿ç”¨ <code>inline</code>ï¼š</strong></p>
<ul>
<li><strong>å¤§å‹æˆ–å¤æ‚çš„å‡½æ•°ï¼š</strong> å†…è”è¿™äº›å‡½æ•°ä¼šå¯¼è‡´ä»£ç è†¨èƒ€ï¼Œå¯èƒ½é™ä½æŒ‡ä»¤ç¼“å­˜æ•ˆç‡ï¼Œåè€Œå½±å“æ€§èƒ½ã€‚</li>
<li><strong>åŒ…å«å¾ªç¯æˆ–é€’å½’çš„å‡½æ•°ï¼š</strong> ç¼–è¯‘å™¨é€šå¸¸ä¸ä¼šå†…è”è¿™ç±»å‡½æ•°ï¼Œå³ä¾¿ä½ åŠ ä¸Š <code>inline</code>ã€‚</li>
<li><strong>åŒ…å« I/O æ“ä½œã€å†…å­˜åˆ†é…ç­‰å‰¯ä½œç”¨çš„å‡½æ•°ï¼š</strong> å†…è”å®ƒä»¬é€šå¸¸æ²¡ä»€ä¹ˆæ€§èƒ½ä¼˜åŠ¿ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´è°ƒè¯•å¤æ‚åŒ–ã€‚</li>
</ul>
<hr>
<h2 id="2-C-è¯­è¨€ä¸­é€‚åˆè®¾ç½®æˆ-inline-æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°"><a href="#2-C-è¯­è¨€ä¸­é€‚åˆè®¾ç½®æˆ-inline-æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°" class="headerlink" title="2. C è¯­è¨€ä¸­é€‚åˆè®¾ç½®æˆ inline æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°"></a><strong>2. C è¯­è¨€ä¸­é€‚åˆè®¾ç½®æˆ <code>inline</code> æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°</strong></h2><p>åœ¨ C è¯­è¨€ (C99 åŠä»¥å) ä¸­ï¼Œå°†å‡½æ•°å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶å¹¶ç”¨ <code>inline</code> æ ‡è®°ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº† <strong>æä¾›å†…è”ä¼˜åŒ–æç¤º</strong>ï¼Œå¹¶<strong>å…è®¸åœ¨æ¯ä¸ªç¿»è¯‘å•å…ƒä¸­ç”Ÿæˆç‹¬ç«‹çš„å‡½æ•°å‰¯æœ¬</strong>ï¼Œä»è€Œé¿å…äº†ä¼ ç»Ÿæ–¹å¼ä¸‹å¯èƒ½å‡ºç°çš„é“¾æ¥å†²çªã€‚</p>
<p><strong>C è¯­è¨€ä¸­è¿™ç±»å‡½æ•°çš„ç‰¹ç‚¹ï¼ˆå¼ºçƒˆæ¨èä½¿ç”¨ <code>static inline</code>ï¼‰ï¼š</strong></p>
<ol>
<li><p><strong>å°å‹ã€é¢‘ç¹è°ƒç”¨çš„å·¥å…·å‡½æ•° (Small, Frequently Used Utility Functions)ï¼š</strong></p>
<ul>
<li>è¿™äº›å‡½æ•°é€šå¸¸æ˜¯ç®€å•çš„æ•°å­¦è¿ç®—ã€ä½æ“ä½œã€æ•°æ®ç»“æ„è®¿é—®ç­‰ï¼Œä¸ C++ çš„æƒ…å†µç±»ä¼¼ã€‚</li>
<li><strong>ç›®çš„ï¼š</strong> ä¸»è¦ä¸ºäº†æ€§èƒ½ä¼˜åŒ–ï¼Œé€šè¿‡å†…è”å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€ã€‚</li>
<li><strong>æœ€ä½³å®è·µï¼š</strong> å‡ ä¹æ€»æ˜¯ä¸ <code>static</code> å…³é”®å­—ä¸€èµ·ä½¿ç”¨ï¼Œå³ <code>static inline</code>ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common_math.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> COMMON_MATH_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COMMON_MATH_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»…åœ¨åŒ…å«æ­¤å¤´æ–‡ä»¶çš„ .c æ–‡ä»¶å†…éƒ¨å¯è§çš„å†…è”å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">square</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">swap_ints</span><span class="params">(<span class="keyword">int</span> *a, <span class="keyword">int</span> *b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = *a;</span><br><span class="line">    *a = *b;</span><br><span class="line">    *b = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></div>
</li>
</ul>
</li>
<li><p><strong>æ›¿ä»£å® (Replacing Macros)ï¼š</strong></p>
<ul>
<li>C è¯­è¨€ä¸­å¸¸ç”¨å® (<code>#define</code>) æ¥å®šä¹‰ä¸€äº›ç®€å•çš„å¸¸é‡æˆ–å‡½æ•°ã€‚ä½†æ˜¯å®æœ‰å…¶å›ºæœ‰çš„ç¼ºç‚¹ï¼ˆå¦‚æ²¡æœ‰ç±»å‹æ£€æŸ¥ã€å¯èƒ½äº§ç”Ÿæ„æƒ³ä¸åˆ°çš„å‰¯ä½œç”¨ã€è°ƒè¯•å›°éš¾ç­‰ï¼‰ã€‚</li>
<li><code>static inline</code> å‡½æ•°æ˜¯å®çš„<strong>ä¼˜ç§€æ›¿ä»£å“</strong>ï¼Œå®ƒä¿ç•™äº†å®çš„æ€§èƒ½ä¼˜åŠ¿ï¼ˆé€šè¿‡å†…è”ï¼‰ï¼ŒåŒæ—¶æä¾›äº†å‡½æ•°çš„æ‰€æœ‰ä¼˜ç‚¹ï¼ˆç±»å‹å®‰å…¨ã€å¯è°ƒè¯•æ€§ã€å±€éƒ¨ä½œç”¨åŸŸç­‰ï¼‰ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common_defs.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> COMMON_DEFS_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COMMON_DEFS_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›¿ä»£ #define MIN(a, b) ((a) &lt; (b) ? (a) : (b))</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">min</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a &lt; b) ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></div>
</li>
</ul>
</li>
<li><p><strong>ä»…ä¾›å¤´æ–‡ä»¶å†…éƒ¨ä½¿ç”¨çš„è¾…åŠ©å‡½æ•° (Helper Functions Used Only Internally by the Header)ï¼š</strong></p>
<ul>
<li>å¦‚æœå¤´æ–‡ä»¶å†…éƒ¨å®šä¹‰äº†å…¶ä»– <code>inline</code> å‡½æ•°æˆ–å®ï¼Œå¹¶ä¸”å®ƒä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œè€Œè¿™ä¸ªè¾…åŠ©å‡½æ•°åˆä¸éœ€è¦åœ¨å…¶ä»– <code>.c</code> æ–‡ä»¶ä¸­è¢«ç›´æ¥è°ƒç”¨ï¼Œé‚£ä¹ˆå°†å…¶å®šä¹‰ä¸º <code>static inline</code> æ˜¯åˆé€‚çš„ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ Cï¼š</strong><br>åœ¨ C è¯­è¨€ä¸­ï¼Œå½“éœ€è¦å°†å‡½æ•°å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­æ—¶ï¼Œå‡ ä¹æ€»æ˜¯æ¨èä½¿ç”¨ <code>static inline</code>ã€‚è¿™ç¡®ä¿äº†å‡½æ•°çš„å†…è”æç¤ºï¼Œå¹¶ä¿è¯äº†æ¯ä¸ªç¿»è¯‘å•å…ƒä¼šç”Ÿæˆä¸€ä¸ª<strong>ç‹¬ç«‹ã€å†…éƒ¨é“¾æ¥</strong>çš„å‡½æ•°å‰¯æœ¬ï¼Œä»è€Œé¿å…äº†å¤æ‚çš„é“¾æ¥é—®é¢˜ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°éœ€è¦æœ‰ä¸€ä¸ª<strong>å¤–éƒ¨é“¾æ¥çš„æƒå¨å®šä¹‰</strong>ï¼Œåˆ™åº”è¯¥é‡‡ç”¨ä¼ ç»Ÿçš„â€œå¤´æ–‡ä»¶å£°æ˜ + å•ä¸€ <code>.c</code> æ–‡ä»¶å®šä¹‰â€æ¨¡å¼ï¼Œè€Œä¸æ˜¯ä¾èµ– <code>inline</code>ã€‚</p>
<hr>
<p><strong>å…±åŒçš„å¿ å‘Šï¼š</strong></p>
<ul>
<li><strong>è®©ç¼–è¯‘å™¨åšå†³å®šï¼š</strong> ç°ä»£ç¼–è¯‘å™¨åœ¨ä¼˜åŒ–æ–¹é¢éå¸¸æ™ºèƒ½ã€‚å³ä½¿æ²¡æœ‰ <code>inline</code> å…³é”®å­—ï¼Œå®ƒä»¬ä¹Ÿä¼šè‡ªåŠ¨å†…è”é‚£äº›å®ƒä»¬è®¤ä¸ºåˆé€‚çš„å‡½æ•°ã€‚å› æ­¤ï¼Œä¸è¦è¿‡åº¦ä½¿ç”¨ <code>inline</code>ï¼Œå°¤å…¶ä¸è¦åœ¨ <code>.cpp</code> æ–‡ä»¶ä¸­å¯¹å‡½æ•°ä½¿ç”¨å®ƒï¼Œé™¤éä½ æœ‰æ˜ç¡®çš„ ODR éœ€æ±‚ã€‚</li>
<li><strong>å¯è¯»æ€§ä¼˜å…ˆï¼š</strong> ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§å¾€å¾€æ¯”å¾®å°çš„æ€§èƒ½ä¼˜åŒ–æ›´é‡è¦ã€‚åªæœ‰åœ¨æ€§èƒ½åˆ†æå·¥å…· (profiler) æ˜ç¡®æŒ‡å‡ºæŸä¸ªå‡½æ•°æ˜¯æ€§èƒ½ç“¶é¢ˆæ—¶ï¼Œæ‰è€ƒè™‘é€šè¿‡ <code>inline</code> æˆ–å…¶ä»–æ–¹å¼è¿›è¡Œæ¿€è¿›ä¼˜åŒ–ã€‚</li>
</ul>
<hr>
<h2 id="ğŸ§‘â€ğŸ’»-User-9"><a href="#ğŸ§‘â€ğŸ’»-User-9" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>c++ä¸­æœ‰static inlineä¹ˆ</p>
<hr>
<h2 id="ğŸ¤–-Assistant-9"><a href="#ğŸ¤–-Assistant-9" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒç›´æ¥æŒ‡å‘äº† C++ å’Œ C åœ¨ <code>static</code> å’Œ <code>inline</code> å…³é”®å­—ç»“åˆä½¿ç”¨æ—¶çš„<strong>è¯­ä¹‰å·®å¼‚</strong>ã€‚</p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>C++ ä¸­æœ‰ <code>static inline</code>ï¼Œä½†å®ƒçš„ä½œç”¨å’Œå«ä¹‰ä¸ C è¯­è¨€ä¸­çš„ <code>static inline</code> æœ‰æ‰€ä¸åŒï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒC++ ä»£ç ä¸­ä½ </strong>å¾ˆå°‘ä¼šçœ‹åˆ°æˆ–éœ€è¦<strong> <code>static inline</code>ã€‚</strong></p>
<p>æˆ‘ä»¬æ¥è¯¦ç»†è§£æä¸€ä¸‹ï¼š</p>
<h2 id="C-ä¸­çš„-static-inline"><a href="#C-ä¸­çš„-static-inline" class="headerlink" title="C++ ä¸­çš„ static inline"></a>C++ ä¸­çš„ <code>static inline</code></h2><p>åœ¨ C++ ä¸­ï¼Œ<code>static</code> å…³é”®å­—çš„è¯­ä¹‰æ˜¯å¤æ‚ä¸”é‡è½½çš„ï¼Œå®ƒæ ¹æ®å…¶ä¸Šä¸‹æ–‡æœ‰ä¸åŒçš„å«ä¹‰ã€‚å½“ <code>static</code> ç”¨äºå‡½æ•°æ—¶ï¼š</p>
<ol>
<li><p><strong>å…¨å±€ï¼ˆéæˆå‘˜ï¼‰å‡½æ•°å‰çš„ <code>static</code>ï¼š</strong></p>
<ul>
<li><code>static</code> ä¼šå°†è¯¥å‡½æ•°èµ‹äºˆ<strong>å†…éƒ¨é“¾æ¥ (Internal Linkage)</strong>ã€‚è¿™æ„å‘³ç€è¿™ä¸ªå‡½æ•°åªåœ¨å®šä¹‰å®ƒçš„ç¿»è¯‘å•å…ƒï¼ˆå³ <code>.cpp</code> æ–‡ä»¶ï¼‰å†…éƒ¨å¯è§ï¼Œä¸èƒ½è¢«å…¶ä»– <code>.cpp</code> æ–‡ä»¶è®¿é—®ã€‚å³ä½¿æœ‰å…¶ä»– <code>.cpp</code> æ–‡ä»¶æœ‰åŒåçš„ <code>static</code> å‡½æ•°ï¼Œå®ƒä»¬ä¹Ÿæ˜¯å®Œå…¨ç‹¬ç«‹çš„å®ä½“ã€‚</li>
<li>å¦‚æœä½ åœ¨è¿™æ ·çš„ <code>static</code> å‡½æ•°å‰åŠ ä¸Š <code>inline</code>ï¼š<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_module.cpp</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">helper_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ul>
<li><strong><code>static</code> çš„ä½œç”¨ï¼š</strong> ç¡®ä¿ <code>helper_function</code> ä»…åœ¨ <code>my_module.cpp</code> å†…éƒ¨å¯è§ï¼Œä¸å…·æœ‰å¤–éƒ¨é“¾æ¥ã€‚</li>
<li><strong><code>inline</code> çš„ä½œç”¨ï¼š</strong> ä»ç„¶ä½œä¸ºç¼–è¯‘å™¨å†…è”ä¼˜åŒ–çš„æç¤ºã€‚</li>
<li><strong>ODR å½±å“ï¼š</strong> ç”±äº <code>static</code> å·²ç»ä¿è¯äº†å†…éƒ¨é“¾æ¥å’Œæ¯ä¸ªç¿»è¯‘å•å…ƒçš„ç‹¬ç«‹æ€§ï¼Œ<code>inline</code> åœ¨è§£å†³ ODR æ–¹é¢çš„æ ¸å¿ƒä½œç”¨åœ¨è¿™é‡Œå˜å¾—ä¸é‡è¦ï¼ˆå› ä¸ºæœ¬æ¥å°±ä¸ä¼šæœ‰ ODR å†²çªï¼‰ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªç»„åˆç†è§£ä¸ºï¼šè¿™æ˜¯ä¸€ä¸ªåªåœ¨å½“å‰æ–‡ä»¶å†…éƒ¨ä½¿ç”¨çš„å‡½æ•°ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨å¯ä»¥å°è¯•å°†å…¶å†…è”ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>ç±»çš„æˆå‘˜å‡½æ•°å‰çš„ <code>static</code>ï¼š</strong></p>
<ul>
<li><code>static</code> æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ª<strong>é™æ€æˆå‘˜å‡½æ•° (Static Member Function)</strong>ï¼Œå®ƒä¸ä¾èµ–äºç±»çš„ä»»ä½•ç‰¹å®šå¯¹è±¡å®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ã€‚</li>
<li>å¦‚æœä½ åœ¨é™æ€æˆå‘˜å‡½æ•°å‰åŠ ä¸Š <code>inline</code>ï¼š<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123; <span class="comment">// é™æ€æˆå‘˜å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> s_count;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> s_count;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
<ul>
<li><strong><code>static</code> çš„ä½œç”¨ï¼š</strong> ä½¿ <code>getCount</code> æˆä¸ºä¸€ä¸ªé™æ€æˆå‘˜å‡½æ•°ã€‚</li>
<li><strong><code>inline</code> çš„ä½œç”¨ï¼š</strong><ul>
<li><strong>è§£å†³ ODRï¼š</strong> å¦‚æœè¿™ä¸ªé™æ€æˆå‘˜å‡½æ•°æ˜¯åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰çš„ï¼ˆå¹¶ä¸”å®ƒä¸æ˜¯ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼‰ï¼Œ<code>inline</code> å°±å…è®¸å®ƒåœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­è¢«å®šä¹‰ï¼Œè€Œä¸ä¼šå¼•èµ·é“¾æ¥é”™è¯¯ã€‚<strong>è¿™æ˜¯å®ƒåœ¨ C++ ä¸­æœ€ä¸»è¦çš„ç”¨é€”ä¹‹ä¸€ã€‚</strong></li>
<li><strong>å†…è”æç¤ºï¼š</strong> åŒæ—¶ä¹Ÿä½œä¸ºç¼–è¯‘å™¨å†…è”ä¼˜åŒ–çš„æç¤ºã€‚</li>
</ul>
</li>
<li><strong>æ³¨æ„ï¼š</strong> å¦‚æœé™æ€æˆå‘˜å‡½æ•°å®šä¹‰åœ¨ç±»å£°æ˜å†…éƒ¨ï¼Œå®ƒé»˜è®¤å°±æ˜¯ <code>inline</code> çš„ï¼Œå°±åƒæ™®é€šæˆå‘˜å‡½æ•°ä¸€æ ·ã€‚æ‰€ä»¥æ˜¾å¼å†™ <code>inline</code> ä¹Ÿæ˜¯å¯é€‰çš„ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="C-static-inline-ä¸-C-static-inline-çš„æ ¸å¿ƒåŒºåˆ«"><a href="#C-static-inline-ä¸-C-static-inline-çš„æ ¸å¿ƒåŒºåˆ«" class="headerlink" title="C++ static inline ä¸ C static inline çš„æ ¸å¿ƒåŒºåˆ«"></a>C++ <code>static inline</code> ä¸ C <code>static inline</code> çš„æ ¸å¿ƒåŒºåˆ«</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">ç‰¹æ€§</th>
<th style="text-align:left">C++ <code>static inline</code> (å…¨å±€å‡½æ•°)</th>
<th style="text-align:left">C <code>static inline</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>é“¾æ¥è¯­ä¹‰</strong></td>
<td style="text-align:left">å†…éƒ¨é“¾æ¥ï¼ˆ<code>static</code> ä¿è¯ï¼‰</td>
<td style="text-align:left">å†…éƒ¨é“¾æ¥ï¼ˆ<code>static</code> ä¿è¯ï¼‰</td>
</tr>
<tr>
<td style="text-align:left"><strong>ODR å¤„ç†</strong></td>
<td style="text-align:left">ç¡®ä¿å†…éƒ¨å‰¯æœ¬ï¼Œé¿å…ä¸å¤–éƒ¨é“¾æ¥å®ä½“å†²çªï¼ˆ<code>static</code> çš„ä½œç”¨ï¼‰ã€‚<code>inline</code> åœ¨ ODR ä¸Šçš„ä½œç”¨å‡ ä¹æ¶ˆå¤±ã€‚</td>
<td style="text-align:left">ç¡®ä¿å†…éƒ¨å‰¯æœ¬ï¼Œé¿å…é“¾æ¥å†²çªï¼ˆ<code>static</code> çš„ä½œç”¨ï¼‰ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong>å­˜åœ¨ç›®çš„</strong></td>
<td style="text-align:left">ä¸»è¦ç”¨äºæä¾›ä¸€ä¸ªä»…å½“å‰æ–‡ä»¶ä½¿ç”¨çš„å¯å†…è”å‡½æ•°ã€‚</td>
<td style="text-align:left"><strong>ä¸»è¦ç”¨äºåœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªåªåœ¨åŒ…å«å®ƒçš„ç¿»è¯‘å•å…ƒä¸­å¯è§çš„å°å‹ã€å¯å†…è”çš„å‡½æ•°ã€‚</strong></td>
</tr>
<tr>
<td style="text-align:left"><strong>å¸¸è§ä½¿ç”¨</strong></td>
<td style="text-align:left"><strong>ä¸å¸¸è§ã€‚</strong> å› ä¸º C++ ä¸­æ›´å€¾å‘äºä½¿ç”¨åŒ¿åå‘½åç©ºé—´æˆ–éå‘½åç©ºé—´çš„ <code>static</code> å±€éƒ¨å‡½æ•°æ¥é™åˆ¶ä½œç”¨åŸŸã€‚</td>
<td style="text-align:left"><strong>éå¸¸å¸¸è§ä¸”æ¨è</strong>ï¼Œç”¨äºåœ¨å¤´æ–‡ä»¶ä¸­æ›¿ä»£å®ï¼Œæä¾›ç±»å‹å®‰å…¨çš„å†…è”å‡½æ•°ã€‚</td>
</tr>
</tbody>
</table>
</div>
<h2 id="ä¸ºä»€ä¹ˆ-C-ä¸­-static-inline-å…¨å±€å‡½æ•°ä¸å¸¸è§ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-C-ä¸­-static-inline-å…¨å±€å‡½æ•°ä¸å¸¸è§ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ C++ ä¸­ static inline å…¨å±€å‡½æ•°ä¸å¸¸è§ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ C++ ä¸­ <code>static inline</code> å…¨å±€å‡½æ•°ä¸å¸¸è§ï¼Ÿ</h2><p>åœ¨ C++ ä¸­ï¼Œå¦‚æœä½ æƒ³å®šä¹‰ä¸€ä¸ªåªåœ¨å½“å‰ <code>.cpp</code> æ–‡ä»¶ä¸­å¯è§çš„è¾…åŠ©å‡½æ•°ï¼Œä½ é€šå¸¸æœ‰æ›´å¥½çš„é€‰æ‹©ï¼š</p>
<ol>
<li><p><strong>åŒ¿åå‘½åç©ºé—´ (Anonymous Namespace)ï¼š</strong><br>è¿™æ˜¯ C++ æ¨èçš„åšæ³•ï¼Œå®ƒæä¾›äº†æ¯” <code>static</code> æ›´å¥½çš„å±€éƒ¨æ€§ï¼Œè¯­ä¹‰æ›´æ¸…æ™°ã€‚åŒ¿åå‘½åç©ºé—´å†…çš„å®ä½“é»˜è®¤å…·æœ‰å†…éƒ¨é“¾æ¥ã€‚</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_module.cpp</span></span><br><span class="line"><span class="keyword">namespace</span> &#123; <span class="comment">// åŒ¿åå‘½åç©ºé—´</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">helper_function_cpp</span><span class="params">()</span> </span>&#123; <span class="comment">// è¿™é‡Œçš„ inline ä¾ç„¶æ˜¯ä¼˜åŒ–æç¤º</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">// namespace</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p><strong>ç±»å†…éƒ¨å®šä¹‰çš„ <code>static</code> æˆå‘˜å‡½æ•°ï¼š</strong><br>å¦‚æœè¿™ä¸ªè¾…åŠ©å‡½æ•°ä¸æŸä¸ªç±»å¼ºç›¸å…³ï¼Œé‚£ä¹ˆæŠŠå®ƒå®šä¹‰ä¸ºè¯¥ç±»çš„ <code>static</code> æˆå‘˜å‡½æ•°æ˜¯æ›´ç¬¦åˆ C++ é¢å‘å¯¹è±¡æ€æƒ³çš„åšæ³•ã€‚</p>
</li>
</ol>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><ul>
<li><strong>C++ ä¸­å­˜åœ¨ <code>static inline</code>ã€‚</strong></li>
<li><strong>å¯¹äºå…¨å±€ï¼ˆéæˆå‘˜ï¼‰å‡½æ•°ï¼š</strong> å®ƒæ„å‘³ç€ä¸€ä¸ªä»…åœ¨å½“å‰ç¿»è¯‘å•å…ƒå†…éƒ¨å¯è§çš„ï¼ˆå†…éƒ¨é“¾æ¥çš„ï¼‰å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥è¢«ç¼–è¯‘å™¨å°è¯•å†…è”ã€‚è¿™ç§ç”¨æ³•åœ¨ C++ ä¸­<strong>ä¸å¸¸è§</strong>ï¼Œé€šå¸¸ä¼šè¢«åŒ¿åå‘½åç©ºé—´å–ä»£ã€‚</li>
<li><strong>å¯¹äºç±»çš„é™æ€æˆå‘˜å‡½æ•°ï¼š</strong> å¦‚æœåœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰ï¼Œ<code>static inline</code> ç»„åˆï¼ˆæˆ–éšå¼çš„ <code>inline</code>ï¼‰æ˜¯<strong>å…è®¸ä¸”å¸¸è§</strong>çš„ï¼Œ<code>inline</code> æ­¤æ—¶ä¸»è¦ä¸ºäº†è§£å†³ ODRã€‚</li>
</ul>
<p>ä½ çš„ç†è§£æ­£åœ¨å˜å¾—è¶Šæ¥è¶Šæ·±å…¥å’Œç²¾å‡†ï¼éå¸¸å¥½ã€‚</p>
<hr>
<h2 id="ğŸ§‘â€ğŸ’»-User-10"><a href="#ğŸ§‘â€ğŸ’»-User-10" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>é‚£c++ä¸­æˆ‘å¦‚æœä¹Ÿæƒ³è¦cé‚£ç§å°å‹å·¥å…·å‡½æ•°æ”¾åœ¨headerä¸­æˆ‘æ€ä¹ˆå¼„</p>
<hr>
<h2 id="ğŸ¤–-Assistant-10"><a href="#ğŸ¤–-Assistant-10" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>ä½ é—®å¾—éå¸¸å¥½ï¼åœ¨ C++ ä¸­ï¼Œå®ç°â€œC è¯­è¨€é‚£ç§å°å‹å·¥å…·å‡½æ•°æ”¾åœ¨å¤´æ–‡ä»¶ä¸­â€çš„éœ€æ±‚ï¼Œé€šå¸¸æœ‰å‡ ç§æ–¹æ³•ï¼Œå…·ä½“å–å†³äºä½ æƒ³è¦è¾¾åˆ°ä»€ä¹ˆ<strong>é“¾æ¥è¯­ä¹‰</strong>ï¼šæ˜¯åƒ C++ <code>inline</code> é‚£æ ·ç»Ÿä¸€æˆä¸€ä¸ªå¤–éƒ¨å¯è§çš„å®ä½“ï¼Œè¿˜æ˜¯åƒ C <code>static inline</code> é‚£æ ·æ¯ä¸ªç¿»è¯‘å•å…ƒä¸€ä»½ç‹¬ç«‹ï¼ˆå†…éƒ¨é“¾æ¥ï¼‰çš„å‰¯æœ¬ã€‚</p>
<p>åœ¨ C++ ä¸­ï¼Œæœ€å¸¸è§å’Œæ¨èçš„æ–¹æ³•å°±æ˜¯ç›´æ¥ä½¿ç”¨ <code>inline</code>ï¼Œå®ƒä¼šå¸®ä½ è§£å†³ ODR é—®é¢˜ã€‚</p>
<h2 id="C-ä¸­å°†å°å‹å·¥å…·å‡½æ•°æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„æ–¹æ³•"><a href="#C-ä¸­å°†å°å‹å·¥å…·å‡½æ•°æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„æ–¹æ³•" class="headerlink" title="C++ ä¸­å°†å°å‹å·¥å…·å‡½æ•°æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„æ–¹æ³•"></a>C++ ä¸­å°†å°å‹å·¥å…·å‡½æ•°æ”¾åœ¨å¤´æ–‡ä»¶ä¸­çš„æ–¹æ³•</h2><h3 id="1-æœ€å¸¸ç”¨ä¸”æ¨èçš„æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨-inline-å…³é”®å­—"><a href="#1-æœ€å¸¸ç”¨ä¸”æ¨èçš„æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨-inline-å…³é”®å­—" class="headerlink" title="1. æœ€å¸¸ç”¨ä¸”æ¨èçš„æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨ inline å…³é”®å­—"></a>1. <strong>æœ€å¸¸ç”¨ä¸”æ¨èçš„æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨ <code>inline</code> å…³é”®å­—</strong></h3><ul>
<li><strong>ç›®çš„ï¼š</strong> å°†å‡½æ•°å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œä½¿å¾—å¤šä¸ª <code>.cpp</code> æ–‡ä»¶å¯ä»¥å®‰å…¨åœ°åŒ…å«å’Œä½¿ç”¨å®ƒï¼Œè€Œä¸ä¼šäº§ç”Ÿé“¾æ¥é”™è¯¯ã€‚åŒæ—¶ï¼Œç¼–è¯‘å™¨å¯ä»¥å°†å…¶ä½œä¸ºå†…è”ä¼˜åŒ–çš„æç¤ºã€‚</li>
<li><strong>é“¾æ¥è¯­ä¹‰ï¼š</strong> å‡½æ•°ä»ç„¶å…·æœ‰ <strong>å¤–éƒ¨é“¾æ¥ (External Linkage)</strong>ã€‚ä½†æ˜¯ï¼ŒC++ çš„ <code>inline</code> è¯­ä¹‰ä¼šç¡®ä¿åœ¨æ•´ä¸ªç¨‹åºä¸­ï¼Œæ‰€æœ‰å¯¹è¿™ä¸ª <code>inline</code> å‡½æ•°çš„å¼•ç”¨éƒ½æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä¸ªå•ä¸€å®ä½“ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> è¿™æ˜¯ C++ ä¸­æœ€æ ‡å‡†çš„åšæ³•ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ä½ å¸Œæœ›åœ¨å¤šä¸ªæºæ–‡ä»¶ä¸­å…±äº«çš„é€šç”¨å°å‹å·¥å…·å‡½æ•°ï¼Œå¦‚æ•°å­¦è®¡ç®—ã€ç®€å•è¾…åŠ©å‡½æ•°ç­‰ã€‚</li>
<li><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p><strong><code>utils.h</code></strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once <span class="comment">// C++ ä¸­çš„ä¸€ä¸ªå¸¸è§éæ ‡å‡†ä½†è¢«å¹¿æ³›æ”¯æŒçš„é¢„å¤„ç†æŒ‡ä»¤ï¼Œé˜²æ­¢å¤´æ–‡ä»¶è¢«å¤šæ¬¡åŒ…å«</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ˜¯ä¸€ä¸ªå†…è”å‡½æ•°ï¼Œå…·æœ‰å¤–éƒ¨é“¾æ¥ï¼Œä½†å…¶å®šä¹‰å¯ä»¥å‡ºç°åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­è€Œä¸ä¼šå¼•å‘ ODR å†²çª</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">print_status</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; msg)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"[STATUS] "</span> &lt;&lt; msg &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»å†…éƒ¨å®šä¹‰çš„æˆå‘˜å‡½æ•°é»˜è®¤å°±æ˜¯ inline çš„</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Calculator</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">multiply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> <span class="keyword">const</span> </span>&#123; <span class="comment">// æ˜¾å¼å†™ inline ä¹Ÿå¯ä»¥</span></span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¹Ÿå¯ä»¥ä¸å†™ inlineï¼Œå› ä¸ºåœ¨ç±»å®šä¹‰å†…éƒ¨çš„æˆå‘˜å‡½æ•°é»˜è®¤å°±æ˜¯ inline çš„</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
<p><strong><code>source1.cpp</code></strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"utils.h"</span> <span class="comment">// åŒ…å«å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_calculation_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    print_status(<span class="string">"Performing calculation 1..."</span>);</span><br><span class="line">    <span class="keyword">int</span> result = add(<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"10 + 20 = "</span> &lt;&lt; result &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p><strong><code>source2.cpp</code></strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"utils.h"</span> <span class="comment">// åŒ…å«å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_calculation_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    print_status(<span class="string">"Performing calculation 2..."</span>);</span><br><span class="line">    Calculator calc;</span><br><span class="line">    <span class="keyword">int</span> result = calc.multiply(<span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"5 * 6 = "</span> &lt;&lt; result &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p><strong><code>main.cpp</code></strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"utils.h"</span> <span class="comment">// åŒ…å«å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜å¤–éƒ¨å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_calculation_1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_calculation_2</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Starting application..."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    do_calculation_1();</span><br><span class="line">    do_calculation_2();</span><br><span class="line">    print_status(<span class="string">"Application finished."</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éªŒè¯å‡½æ•°çš„åœ°å€æ˜¯å¦ç›¸åŒ (è¯æ˜æ˜¯åŒä¸€ä¸ªå®ä½“)</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šC++æ ‡å‡†å…è®¸å†…è”å‡½æ•°åœ°å€ä¸ä¸€è‡´ï¼Œä½†åœ¨å®è·µä¸­å®ƒä»¬é€šå¸¸ä¼šç»Ÿä¸€ã€‚</span></span><br><span class="line">    <span class="comment">// å¯¹äº inline å˜é‡ï¼Œåœ°å€ä¸€è‡´æ€§æ˜¯å¼ºåˆ¶çš„ã€‚</span></span><br><span class="line">    <span class="keyword">void</span> (*p_add)(<span class="keyword">int</span>, <span class="keyword">int</span>) = add; <span class="comment">// å– add å‡½æ•°çš„åœ°å€</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Address of add function: "</span> &lt;&lt; (<span class="keyword">void</span>*)p_add &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿™ä¸ªç¨‹åºä¼šæˆåŠŸç¼–è¯‘å’Œé“¾æ¥ï¼Œæ‰€æœ‰å¯¹ <code>add</code> å’Œ <code>print_status</code> çš„è°ƒç”¨éƒ½å°†æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä¸ªå‡½æ•°å®ä½“ã€‚</p>
</li>
</ul>
<h3 id="2-å¦‚æœç¡®å®éœ€è¦-C-è¯­è¨€-static-inline-é‚£ç§â€œæ¯ä¸ªç¿»è¯‘å•å…ƒä¸€ä»½ç‹¬ç«‹å‰¯æœ¬â€çš„è¯­ä¹‰ï¼šä½¿ç”¨åŒ¿åå‘½åç©ºé—´"><a href="#2-å¦‚æœç¡®å®éœ€è¦-C-è¯­è¨€-static-inline-é‚£ç§â€œæ¯ä¸ªç¿»è¯‘å•å…ƒä¸€ä»½ç‹¬ç«‹å‰¯æœ¬â€çš„è¯­ä¹‰ï¼šä½¿ç”¨åŒ¿åå‘½åç©ºé—´" class="headerlink" title="2. å¦‚æœç¡®å®éœ€è¦ C è¯­è¨€ static inline é‚£ç§â€œæ¯ä¸ªç¿»è¯‘å•å…ƒä¸€ä»½ç‹¬ç«‹å‰¯æœ¬â€çš„è¯­ä¹‰ï¼šä½¿ç”¨åŒ¿åå‘½åç©ºé—´"></a>2. <strong>å¦‚æœç¡®å®éœ€è¦ C è¯­è¨€ <code>static inline</code> é‚£ç§â€œæ¯ä¸ªç¿»è¯‘å•å…ƒä¸€ä»½ç‹¬ç«‹å‰¯æœ¬â€çš„è¯­ä¹‰ï¼šä½¿ç”¨åŒ¿åå‘½åç©ºé—´</strong></h3><ul>
<li><strong>ç›®çš„ï¼š</strong> ç¡®ä¿å‡½æ•°å…·æœ‰<strong>å†…éƒ¨é“¾æ¥ (Internal Linkage)</strong>ï¼Œå³å®ƒåªåœ¨åŒ…å«è¯¥å¤´æ–‡ä»¶çš„ç‰¹å®šç¿»è¯‘å•å…ƒä¸­å¯è§ã€‚æ¯ä¸ªç¿»è¯‘å•å…ƒéƒ½ä¼šå¾—åˆ°å®ƒè‡ªå·±çš„ç‹¬ç«‹å‰¯æœ¬ï¼Œè¿™äº›å‰¯æœ¬åœ¨é“¾æ¥æ—¶äº’ä¸å½±å“ã€‚</li>
<li><strong>é“¾æ¥è¯­ä¹‰ï¼š</strong> å‡½æ•°å…·æœ‰ <strong>å†…éƒ¨é“¾æ¥</strong>ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong><ul>
<li>å½“ä½ æœ‰ä¸€äº›éå¸¸ç‰¹æ®Šçš„è¾…åŠ©å‡½æ•°ï¼Œå®ƒä»¬åªåº”è¯¥è¢«å®šä¹‰åœ¨å¤´æ–‡ä»¶å†…éƒ¨ï¼Œä¸”<strong>ä¸¥æ ¼ä¸å…è®¸</strong>è¢«å¤´æ–‡ä»¶å¤–éƒ¨ï¼ˆå…¶ä»– <code>.cpp</code> æ–‡ä»¶ï¼‰ç›´æ¥è®¿é—®æˆ–é“¾æ¥ã€‚</li>
<li>å½“ä½ æƒ³è¦ä¸€ä¸ªå‡½æ•°ä¸å¤´æ–‡ä»¶å¤–éƒ¨çš„åŒåå‡½æ•°å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°ï¼ˆè™½ç„¶è¿™é€šå¸¸é€šè¿‡æ›´å¥½çš„å‘½åå’Œä½œç”¨åŸŸæ¥è§£å†³ï¼‰ã€‚</li>
<li>å½“ä½ åœ¨ä¸€ä¸ª C++ å¤´æ–‡ä»¶ä¸­ç¼–å†™éœ€è¦ä¸ C è¯­è¨€ <code>static inline</code> è¡Œä¸ºä¸¥æ ¼åŒ¹é…çš„ä»£ç æ—¶ã€‚</li>
</ul>
</li>
<li><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p><strong><code>private_utils.h</code></strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123; <span class="comment">// è¿™æ˜¯ä¸€ä¸ªåŒ¿åå‘½åç©ºé—´ï¼Œå…¶å†…éƒ¨çš„æ‰€æœ‰å®ä½“éƒ½å…·æœ‰å†…éƒ¨é“¾æ¥</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„ inline ä»ç„¶æ˜¯å†…è”æç¤º</span></span><br><span class="line">    <span class="comment">// ä½†ç”±äºåœ¨åŒ¿åå‘½åç©ºé—´å†…ï¼Œå®ƒå·²ç»é»˜è®¤å…·æœ‰å†…éƒ¨é“¾æ¥äº†ï¼ŒODRé—®é¢˜ä¸ä¼šå‘ç”Ÿ</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">private_add_to_tu</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">" (Private Add called from TU "</span> &lt;&lt; (<span class="keyword">void</span>*)&amp;private_add_to_tu &lt;&lt; <span class="string">") "</span>; <span class="comment">// æ‰“å°å‡½æ•°åœ°å€ï¼Œä¼šçœ‹åˆ°ä¸åŒ TU çš„åœ°å€ä¸åŒ</span></span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">// namespace</span></span><br></pre></td></tr></table></figure></div>
<p><strong><code>source1.cpp</code></strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"private_utils.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_private_calc_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = private_add_to_tu(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// è°ƒç”¨ private_add_to_tu</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Result 1: "</span> &lt;&lt; result &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p><strong><code>source2.cpp</code></strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"private_utils.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_private_calc_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = private_add_to_tu(<span class="number">3</span>, <span class="number">4</span>); <span class="comment">// è°ƒç”¨ private_add_to_tu</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Result 2: "</span> &lt;&lt; result &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p><strong><code>main.cpp</code></strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"private_utils.h"</span> <span class="comment">// åŒ…å«å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜å¤–éƒ¨å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_private_calc_1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_private_calc_2</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- Testing Private Utils ---"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    do_private_calc_1();</span><br><span class="line">    do_private_calc_2();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- Finished Testing Private Utils ---"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œä½ ä¼šå‘ç° <code>(Private Add called from TU ...)</code> ä¸­æ‰“å°çš„å‡½æ•°åœ°å€åœ¨ <code>source1.cpp</code> å’Œ <code>source2.cpp</code> çš„è°ƒç”¨ä¸­æ˜¯<strong>ä¸åŒçš„</strong>ï¼Œè¿™è¯æ˜äº†æ¯ä¸ªç¿»è¯‘å•å…ƒéƒ½æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹å‰¯æœ¬ã€‚</p>
</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong>C++ ä¸­æœ€å¸¸è§ã€æœ€ç¬¦åˆ ODR è¯­ä¹‰çš„æ–¹æ¡ˆæ˜¯ï¼š</strong> <strong>ç›´æ¥ä½¿ç”¨ <code>inline</code> å…³é”®å­—</strong> (<code>inline int func() { ... }</code>)ã€‚è¿™ä¼šä½¿å‡½æ•°å…·æœ‰å¤–éƒ¨é“¾æ¥ï¼Œä½†å…è®¸å®šä¹‰åœ¨å¤šä¸ªå¤´æ–‡ä»¶ä¸­ï¼Œå¹¶æœ€ç»ˆç»Ÿä¸€ä¸ºå†…å­˜ä¸­çš„å•ä¸€å®ä½“ã€‚è¿™æ˜¯æ¨èçš„é»˜è®¤åšæ³•ã€‚</li>
<li><strong>å¦‚æœç¡®å®éœ€è¦ C è¯­è¨€ <code>static inline</code> é‚£ç§â€œæ¯ä¸ªç¿»è¯‘å•å…ƒä¸€ä»½ç‹¬ç«‹å‰¯æœ¬â€çš„å†…éƒ¨é“¾æ¥è¯­ä¹‰ï¼ŒC++ çš„æ–¹æ¡ˆæ˜¯ï¼š</strong> å°†å‡½æ•°å®šä¹‰æ”¾åœ¨ <strong>åŒ¿åå‘½åç©ºé—´ (anonymous namespace)</strong> å†…éƒ¨ (<code>namespace { inline int func() { ... } }</code>)ã€‚è¿™ä¼šç¡®ä¿å‡½æ•°å…·æœ‰å†…éƒ¨é“¾æ¥ï¼Œæ¯ä¸ªç¿»è¯‘å•å…ƒä¸€ä¸ªå‰¯æœ¬ï¼Œå®ƒä»¬ç›¸äº’ç‹¬ç«‹ã€‚</li>
</ul>
<p>åœ¨å¤§å¤šæ•° C++ é¡¹ç›®ä¸­ï¼Œä½ åªéœ€è¦æŒæ¡ç¬¬ä¸€ç§æ–¹æ³•ï¼ˆç›´æ¥ä½¿ç”¨ <code>inline</code>ï¼‰ï¼Œå®ƒå·²ç»è¶³å¤Ÿå¼ºå¤§å’Œçµæ´»äº†ã€‚åŒ¿åå‘½åç©ºé—´çš„æ–¹æ³•åœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼ˆä¾‹å¦‚ï¼Œéå¸¸ä¸¥æ ¼åœ°é™åˆ¶å‡½æ•°ä½œç”¨åŸŸï¼Œé¿å…æ½œåœ¨çš„å¤–éƒ¨åŒåå‡½æ•°å†²çªï¼‰æ‰ä¼šè¢«ç”¨åˆ°ã€‚</p>
<hr>
<h2 id="ğŸ§‘â€ğŸ’»-User-11"><a href="#ğŸ§‘â€ğŸ’»-User-11" class="headerlink" title="ğŸ§‘â€ğŸ’» User"></a>ğŸ§‘â€ğŸ’» User</h2><p>c++è¿™inlineå¤„ç†æ˜¯ä¸æ˜¯æ›´åˆç†ï¼Œ é¿å…å¤šä¸ªå‰¯æœ¬çš„å¼€é”€äº†</p>
<hr>
<h2 id="ğŸ¤–-Assistant-11"><a href="#ğŸ¤–-Assistant-11" class="headerlink" title="ğŸ¤– Assistant"></a>ğŸ¤– Assistant</h2><p>ï¼ˆæ€è€ƒä¸€ä¸‹ï¼Œè¿™ä¸ªé—®é¢˜å¾ˆæ ¸å¿ƒï¼Œå®ƒè§¦åŠäº† C++ <code>inline</code> æœºåˆ¶è®¾è®¡çš„æ·±å±‚åŸå› å’Œä¼˜åŠ¿ã€‚ï¼‰</p>
<p>ä½ çš„ç›´è§‰éå¸¸æ•é”ï¼Œ<strong>æ˜¯çš„ï¼Œä» C++ çš„è®¾è®¡å“²å­¦å’Œç°ä»£è½¯ä»¶å¼€å‘çš„æ™®ééœ€æ±‚æ¥çœ‹ï¼ŒC++ <code>inline</code> çš„å¤„ç†æ–¹å¼ç¡®å®é€šå¸¸æ›´åˆç†ã€æ›´é«˜æ•ˆï¼Œå¹¶ä¸”æ›´å¥½åœ°é¿å…äº†â€œå¤šä¸ªå‰¯æœ¬çš„å¼€é”€â€ã€‚</strong></p>
<p>æˆ‘ä»¬æ¥å…·ä½“åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆï¼š</p>
<h2 id="C-inline-æœºåˆ¶çš„ä¼˜åŠ¿-ä¸-C-å¯¹æ¯”"><a href="#C-inline-æœºåˆ¶çš„ä¼˜åŠ¿-ä¸-C-å¯¹æ¯”" class="headerlink" title="C++ inline æœºåˆ¶çš„ä¼˜åŠ¿ (ä¸ C å¯¹æ¯”)"></a>C++ <code>inline</code> æœºåˆ¶çš„ä¼˜åŠ¿ (ä¸ C å¯¹æ¯”)</h2><ol>
<li><p><strong>é¿å…ä»£ç è†¨èƒ€ (Code Bloat) å’Œå†…å­˜å¼€é”€ï¼š</strong></p>
<ul>
<li><strong>C è¯­è¨€çš„ <code>inline</code> (ä¸å¸¦ <code>extern</code> æˆ– <code>static</code>)ï¼š</strong> æ¯ä¸ªåŒ…å«å¤´æ–‡ä»¶çš„ç¿»è¯‘å•å…ƒéƒ½ä¼šç”Ÿæˆä¸€ä¸ªè¯¥ <code>inline</code> å‡½æ•°çš„ç‹¬ç«‹å‰¯æœ¬ã€‚å¦‚æœä¸€ä¸ªå¸¸ç”¨çš„å°å‡½æ•°è¢«å‡ åä¸ª <code>.c</code> æ–‡ä»¶åŒ…å«ï¼Œé‚£ä¹ˆåœ¨æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªå‡½æ•°çš„æœºå™¨ç å¯èƒ½ä¼šé‡å¤å‡ åæ¬¡ã€‚è¿™ä¼šå¯¼è‡´å¯æ‰§è¡Œæ–‡ä»¶ä½“ç§¯å¢å¤§ï¼Œå ç”¨æ›´å¤šçš„å†…å­˜ï¼ˆå°¤å…¶æ˜¯åœ¨æŒ‡ä»¤ç¼“å­˜ [instruction cache] ä¸­ï¼‰ã€‚</li>
<li><strong>C++ è¯­è¨€çš„ <code>inline</code>ï¼š</strong> å³ä½¿å®šä¹‰è¢«åŒ…å«åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­ï¼Œé“¾æ¥å™¨ä¹Ÿä¼šç¡®ä¿æœ€ç»ˆåœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå•ä¸€çš„å‡½æ•°å®ä½“ã€‚è¿™æ„å‘³ç€æ— è®ºä½ çš„å¤´æ–‡ä»¶è¢«å¤šå°‘ä¸ª <code>.cpp</code> æ–‡ä»¶åŒ…å«ï¼Œæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶é‡Œè¯¥ <code>inline</code> å‡½æ•°çš„æœºå™¨ç åªä¼šæœ‰ä¸€ä»½ã€‚è¿™æ˜¾è‘—å‡å°‘äº†ä»£ç è†¨èƒ€å’Œå†…å­˜å¼€é”€ã€‚</li>
<li><strong>ç»“è®ºï¼š</strong> C++ çš„è¿™ç§â€œç»Ÿä¸€â€æœºåˆ¶æ˜¯å…¶æœ€é‡è¦çš„ä¼˜åŠ¿ä¹‹ä¸€ï¼Œå°¤å…¶æ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶ä»£ç å¤§å°ã€‚</li>
</ul>
</li>
<li><p><strong>ä¿è¯ä¸€è‡´æ€§ (Consistency) å’Œå‡å°‘æœªå®šä¹‰è¡Œä¸ºï¼š</strong></p>
<ul>
<li><strong>C è¯­è¨€çš„ <code>inline</code>ï¼š</strong> å¦‚æœä½ åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¸­æä¾›äº† <code>inline</code> å‡½æ•°çš„å®šä¹‰ï¼Œä½†è¿™äº›å®šä¹‰åˆå­˜åœ¨ç»†å¾®çš„å·®å¼‚ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚æ ‡å‡†å…è®¸è¿™æ ·åšï¼Œä½†ç»“æœéš¾ä»¥é¢„æµ‹ã€‚è€Œä¸”ï¼Œå¦‚æœä½ åŒæ—¶æä¾›äº†ä¸€ä¸ªå¤–éƒ¨é“¾æ¥çš„é <code>inline</code> å®šä¹‰ï¼Œé‚£ä¹ˆä½ å¿…é¡»ç¡®ä¿å®ƒä¸æ‰€æœ‰çš„ <code>inline</code> å®šä¹‰å®Œå…¨ä¸€è‡´ã€‚</li>
<li><strong>C++ è¯­è¨€çš„ <code>inline</code>ï¼š</strong> C++ çš„ ODR å¯¹ <code>inline</code> å‡½æ•°æœ‰éå¸¸ä¸¥æ ¼çš„è¦æ±‚ï¼šæ‰€æœ‰ <code>inline</code> å®šä¹‰åœ¨æ‰€æœ‰ç¿»è¯‘å•å…ƒä¸­<strong>å¿…é¡»å®Œå…¨ä¸€è‡´</strong>ã€‚å¦‚æœä¸ä¸€è‡´ï¼Œå°†å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚è¿™ç§å¼ºåˆ¶çš„ä¸€è‡´æ€§ï¼Œè™½ç„¶è¦æ±‚ç¨‹åºå‘˜æ›´ä¸¥è°¨ï¼Œä½†ä¹Ÿæå¤§åœ°ç®€åŒ–äº†è°ƒè¯•å’Œç†è§£ï¼Œå› ä¸ºå®ƒä¿è¯äº†ä¸ç®¡åœ¨å“ªé‡Œè°ƒç”¨ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå‡½æ•°é€»è¾‘ã€‚</li>
</ul>
</li>
<li><p><strong>æ”¯æŒæ›´å¤æ‚çš„è¯­è¨€ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>C++ çš„ <code>inline</code> æœºåˆ¶æ˜¯å…¶æ”¯æŒå¤æ‚ç‰¹æ€§ï¼ˆå¦‚æ¨¡æ¿ã€ç±»æˆå‘˜å‡½æ•°ã€ä»¥åŠ C++17 å¼•å…¥çš„ <code>inline</code> å˜é‡ï¼‰çš„åŸºç¡€ã€‚</li>
<li><strong>æ¨¡æ¿ï¼š</strong> æ¨¡æ¿å‡½æ•°å¿…é¡»å°†å…¶å®Œæ•´å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œæ‰èƒ½åœ¨æ¯ä¸ªéœ€è¦å®ä¾‹åŒ–çš„ç¿»è¯‘å•å…ƒä¸­ç”Ÿæˆä»£ç ã€‚å¦‚æœæ²¡æœ‰ <code>inline</code> çš„ ODR è±å…æœºåˆ¶ï¼Œæ¨¡æ¿å‡ ä¹æ— æ³•åœ¨ C++ ä¸­å·¥ä½œã€‚</li>
<li><strong><code>inline</code> å˜é‡ (C++17)ï¼š</strong> C++17 å¼•å…¥çš„ <code>inline</code> å˜é‡å…è®¸ä½ åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰å…¨å±€å˜é‡ï¼Œå¹¶ä¸”ä¿è¯å…¶å•ä¸€å®šä¹‰ã€‚è¿™è§£å†³äº† C++ æ—©æœŸåœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰å…¨å±€å¸¸é‡å¯èƒ½é‡åˆ°çš„é“¾æ¥é—®é¢˜ï¼Œä½¿å¾—å¸¸é‡ï¼ˆå¦‚ <code>static const int MyConstant = 5;</code>ï¼‰å¯ä»¥è¢«å®‰å…¨åœ°å®šä¹‰å’Œå…±äº«ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„ <code>.cpp</code> æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li><p><strong>æ›´ç›´è§‚å’Œç»Ÿä¸€çš„è¯­ä¹‰ï¼š</strong></p>
<ul>
<li>åœ¨ C++ ä¸­ï¼Œ<code>inline</code> çš„ä¸»è¦èŒè´£å°±æ˜¯è§£å†³ ODRï¼Œå…è®¸åœ¨å¤´æ–‡ä»¶ä¸­æ”¾ç½®å®šä¹‰ã€‚å…¶ä¼˜åŒ–æç¤ºçš„è§’è‰²æ˜¯æ¬¡è¦çš„ã€‚è¿™ç§èŒè´£åˆ†ç¦»è®©ç¨‹åºå‘˜æ›´å®¹æ˜“ç†è§£å…¶æ ¸å¿ƒç”¨é€”ã€‚</li>
<li>C è¯­è¨€çš„ <code>inline</code> è¯­ä¹‰æ›´å¤æ‚ï¼Œéœ€è¦åŒºåˆ†æ˜¯å¦å¸¦ <code>extern</code>ã€æ˜¯å¦å¸¦ <code>static</code>ï¼Œä»¥åŠå¦‚ä½•æä¾›å¤–éƒ¨å®šä¹‰ç­‰ï¼Œè¿™å¯¹äºæ–°æ‰‹æ¥è¯´ç¡®å®å®¹æ˜“æ··æ·†ã€‚</li>
</ul>
</li>
</ol>
<h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ˜¯çš„ï¼ŒC++ <code>inline</code> çš„å¤„ç†æ–¹å¼ï¼ˆé€šè¿‡æ”¾æ¾ ODR è§„åˆ™ï¼Œå¹¶åœ¨é“¾æ¥æ—¶ç»Ÿä¸€ä¸ºå•ä¸€å®ä½“ï¼‰åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ›´ä¸ºåˆç†ã€‚å®ƒï¼š</p>
<ul>
<li><strong>é¿å…äº†ä¸å¿…è¦çš„ä»£ç é‡å¤å’Œå†…å­˜å¼€é”€ã€‚</strong></li>
<li><strong>æä¾›äº†æ›´å¼ºçš„å®šä¹‰ä¸€è‡´æ€§ä¿è¯ã€‚</strong></li>
<li><strong>æ— ç¼æ”¯æŒäº†æ¨¡æ¿ç­‰ C++ æ ¸å¿ƒç‰¹æ€§ã€‚</strong></li>
<li><strong>å…·æœ‰æ›´æ¸…æ™°å’Œç»Ÿä¸€çš„è¯­ä¹‰ã€‚</strong></li>
</ul>
<p>å› æ­¤ï¼Œå¦‚æœä½ åœ¨ C++ ä¸­éœ€è¦å°†å°å‹å·¥å…·å‡½æ•°æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œç›´æ¥ä½¿ç”¨ <code>inline</code> å…³é”®å­—å°±æ˜¯æœ€æ¨èå’Œæœ€ C++ çš„æ–¹å¼ã€‚</p>
</div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Coding/">Coding    </a><a class="post-meta__tags" href="/tags/Cpp/">Cpp    </a><a class="post-meta__tags" href="/tags/Function/">Function    </a><a class="post-meta__tags" href="/tags/Developer/">Developer    </a><a class="post-meta__tags" href="/tags/Variable/">Variable    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2025/06/08/10-projects/cplusplus/lectures/340%20-%20ODR%20Cpp/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info"><span>340 - ODR Cpp</span></div></a></div><div class="next-post pull_right"><a href="/2025/06/08/30-resources/coding/python/Pandas_Basic_Command_Quick_Check_Table/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202104250.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info"><span>Pandas_Basic_Command_Quick_Check_Table</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/lectures/328 - cppå‘½åç©ºé—´/" title="328 - cppå‘½åç©ºé—´"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">328 - cppå‘½åç©ºé—´</div></div></a></div><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/return type for lambda function template/" title="return type for lambda function template"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">return type for lambda function template</div></div></a></div><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/lectures/256 - cpp decltype(auto)/" title="256 - cpp decltype(auto)"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">256 - cpp decltype(auto)</div></div></a></div><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/lectures/259 - Auto Function Templates/" title="259 - Auto Function Templates"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">259 - Auto Function Templates</div></div></a></div><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/lectures/258 - Non type template parameters/" title="258 - Non type template parameters"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">258 - Non type template parameters</div></div></a></div><div class="relatedPosts_item"><a href="/2025/06/08/10-projects/cplusplus/lectures/265 - using concept/" title="265 - using concept"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2025-06-08</div><div class="relatedPosts_title">265 - using concept</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> è¯„è®º</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = true == true ? true : false;
var verify = true == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'xvMxbws16Erd8WUfqxkvHmb5-gzGzoHsz',
  appKey:'4U0Vo7NQIUL0eJzHdkPzdCDr',
  placeholder:'ä¸è¯´è¯çš„äººä¼šç–¯æ‰å—?',
  avatar:'retro',
  guest_info:guest_info,
  pageSize:'10',
  lang:'en',
  recordIP: true
});</script></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2025 By supersheepbear</div><div class="framework-info"><span>é©±åŠ¨ </span><a href="http://hexo.io" target="_blank" rel="external nofollow noopener noreferrer"><span>Hexo</span></a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="external nofollow noopener noreferrer"><span>Butterfly</span></a></div><div class="footer_custom_text">å¤–å‘å­¤ç‹¬è€…æ‚£è€…</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="é˜…è¯»æ¨¡å¼"></i><i class="fa fa-plus" id="font_plus" title="æ”¾å¤§å­—ä½“"></i><i class="fa fa-minus" id="font_minus" title="ç¼©å°å­—ä½“"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="ç®€ç¹è½¬æ¢" target="_self">ç¹</a><i class="darkmode fa fa-moon-o" id="darkmode" title="å¤œé—´æ¨¡å¼"></i></div><div id="rightside-config-show"><div id="rightside_config" title="è®¾ç½®"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="ç›®å½•" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="å›åˆ°é¡¶éƒ¨" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script id="canvas_nest" color="255,240,245" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-nest.js"></script><script src="https://cdn.jsdelivr.net/npm/activate-power-mode/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false; 
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« "></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>ç”±</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="external nofollow noopener noreferrer" style="color:#49B1F5;">hexo-generator-search</a>
 <span>æä¾›æ”¯æŒ</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body></html>